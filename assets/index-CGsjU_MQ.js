import{r as ue}from"./rolldown-runtime-CjiBMUN4.js";import{a as ne,c as ie,d as Ee,i as le,l as oe,n as be,o as de,r as ce,s as fe,t as Le}from"./charting-mCjb7GWK.js";import{t as Ue}from"./react-dom-COd6vK1M.js";import{a as H,c as he,i as Pe,n as ge,o as Fe,r as we,s as Te,t as Re}from"./react-router-CShHLuBK.js";import{_ as Ie,a as Me,b as $e,c as q,d as Z,f as Oe,g as _e,h as ze,i as Be,l as Y,m as qe,n as _,o as Ge,p as X,r as W,s as He,t as Ke,u as K,v as Ve,y as We}from"./firebase--F1FTdnW.js";import{t as Ye}from"./react-xg8gCaOR.js";import{C as Qe,D as Xe,E as Je,O as Ze,S as es,T as ss,_ as ae,a as ts,b as te,c as as,d as rs,f as ns,g as ve,h as pe,i as is,l as ls,m as os,n as ds,o as ee,p as Se,r as De,s as cs,t as re,u as je,v as me,w as ms,x as xe,y as Ae}from"./lucide-icons-DuvOX9XH.js";(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))f(h);new MutationObserver(h=>{for(const m of h)if(m.type==="childList")for(const v of m.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&f(v)}).observe(document,{childList:!0,subtree:!0});function E(h){const m={};return h.integrity&&(m.integrity=h.integrity),h.referrerPolicy&&(m.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?m.credentials="include":h.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function f(h){if(h.ep)return;h.ep=!0;const m=E(h);fetch(h.href,m)}})();var xs=ue(Ue()),s=ue(Ee()),ke=$e({apiKey:"AIzaSyAGm3bzsCxYSARcgVn41ta_EOut9fauWr0",authDomain:"ecommerce-74229.firebaseapp.com",projectId:"ecommerce-74229",storageBucket:"ecommerce-74229.firebasestorage.app",messagingSenderId:"47160479095",appId:"1:47160479095:web:0dd3a844d5d5c3847ea572",measurementId:"G-47FYXTR59Z"}),se=ze(ke),L=Ge(ke),e=ue(Ye()),Ce=(0,s.createContext)();const J=()=>(0,s.useContext)(Ce),us=({children:i})=>{const[g,E]=(0,s.useState)(null),[f,h]=(0,s.useState)(!0),m=(c,x)=>qe(se,c,x),v=(c,x)=>Ve(se,c,x),N=()=>We(se);(0,s.useEffect)(()=>_e(se,c=>{E(c),h(!1)}),[]);const k={currentUser:g,signup:m,login:v,logout:N};return(0,e.jsx)(Ce.Provider,{value:k,children:f?(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):i})};function hs(){const i=(0,s.useRef)(),g=(0,s.useRef)(),{login:E}=J(),f=he(),[h,m]=(0,s.useState)(""),[v,N]=(0,s.useState)(!1),k=async c=>{c.preventDefault();try{m(""),N(!0),await E(i.current.value,g.current.value),f("/dashboard")}catch{m("Failed to sign in. Please check your credentials and try again.")}N(!1)};return(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-400 to-gray-100 p-4",children:(0,e.jsx)("div",{className:"w-full max-w-md",children:(0,e.jsxs)("form",{onSubmit:k,className:"bg-white p-8 rounded-2xl shadow-lg border border-gray-100",children:[(0,e.jsxs)("div",{className:"text-center mb-8",children:[(0,e.jsx)("div",{className:"mx-auto w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mb-4",children:(0,e.jsx)("span",{className:"text-white font-bold text-xl",children:"MB"})}),(0,e.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Welcome Back"}),(0,e.jsx)("p",{className:"text-gray-600 mt-2",children:"Sign in to your account"})]}),h&&(0,e.jsx)("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg mb-6 text-sm",children:h}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,e.jsx)("input",{type:"email",id:"email",ref:i,placeholder:"Enter your email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",ref:g,placeholder:"Enter your password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsx)("button",{disabled:v,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-lg transition-colors duration-200 disabled:opacity-50",children:v?"Signing In...":"Sign In"}),(0,e.jsxs)("p",{className:"mt-6 text-center text-gray-600",children:["Don't have an account?"," ",(0,e.jsx)(ge,{to:"/signup",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"Sign Up"})]})]})})})}function gs(){const i=(0,s.useRef)(),g=(0,s.useRef)(),E=(0,s.useRef)(),{signup:f}=J(),h=he(),[m,v]=(0,s.useState)(""),[N,k]=(0,s.useState)(!1),c=async x=>{if(x.preventDefault(),g.current.value!==E.current.value)return v("Passwords do not match");if(g.current.value.length<6)return v("Password should be at least 6 characters");try{v(""),k(!0),await f(i.current.value,g.current.value),h("/dashboard")}catch{v("Failed to create an account. Please try again.")}k(!1)};return(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-400 to-gray-100 p-4",children:(0,e.jsx)("div",{className:"w-full max-w-md",children:(0,e.jsxs)("form",{onSubmit:c,className:"bg-white p-8 rounded-2xl shadow-lg border border-gray-100",children:[(0,e.jsxs)("div",{className:"text-center mb-8",children:[(0,e.jsx)("div",{className:"mx-auto w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mb-4",children:(0,e.jsx)("span",{className:"text-white font-bold text-xl",children:"MB"})}),(0,e.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Create Account"}),(0,e.jsx)("p",{className:"text-gray-600 mt-2",children:"Sign up to get started"})]}),m&&(0,e.jsx)("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg mb-6 text-sm",children:m}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,e.jsx)("input",{type:"email",id:"email",ref:i,placeholder:"Enter your email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",ref:g,placeholder:"Create a password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),(0,e.jsx)("input",{type:"password",id:"confirmPassword",ref:E,placeholder:"Confirm your password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsx)("button",{disabled:N,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-lg transition-colors duration-200 disabled:opacity-50",children:N?"Creating Account...":"Sign Up"}),(0,e.jsxs)("p",{className:"mt-6 text-center text-gray-600",children:["Already have an account?"," ",(0,e.jsx)(ge,{to:"/login",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"Sign In"})]})]})})})}var ps=()=>(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{children:[(0,e.jsx)("h1",{children:"Create your porfile"}),(0,e.jsxs)("form",{action:"",children:[(0,e.jsx)("input",{type:"text",placeholder:"Your full name "}),(0,e.jsx)("input",{type:"email",placeholder:"Your email",name:"",id:""}),(0,e.jsx)("input",{type:"number",placeholder:"You phone number ",name:"",id:""}),(0,e.jsx)("input",{type:"number",placeholder:"You Age  ",name:"",id:""}),(0,e.jsxs)("option",{value:"",children:[(0,e.jsx)("select",{name:"male",id:"",children:"Male"}),(0,e.jsx)("select",{name:"female",id:"",children:"Female"})]}),(0,e.jsx)("input",{type:"file",placeholder:"Upload your photo"}),(0,e.jsx)("button",{type:"submit",children:"Create account"})]})]})}),fs=ps,js=()=>{const[i,g]=(0,s.useState)(0),[E,f]=(0,s.useState)(0),[h,m]=(0,s.useState)(0),[v,N]=(0,s.useState)(0),[k,c]=(0,s.useState)(!1),[x,F]=(0,s.useState)(!1),[j,U]=(0,s.useState)(!1),[T,R]=(0,s.useState)([]),[o,y]=(0,s.useState)([]),[b,S]=(0,s.useState)([]),[P,I]=(0,s.useState)(!0),O=n=>new Date(n).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",hour12:!0});(0,s.useEffect)(()=>{if(!L){U("Firestore instance not available"),I(!1);return}const n=K(_(L,"users"),Y("createdAt","desc")),p=q(n,a=>{try{const u=a.docs.map(w=>({id:w.id,...w.data()}));S(u),N(u.length),I(!1),U(!1)}catch(u){console.error("Error processing users snapshot:",u),U("Failed to process users data"),I(!1)}},a=>{console.error("Error fetching users:",a),a.code==="permission-denied"?U("Permission denied. Check Firestore rules."):U("Failed to load users: "+(a.message||"Unknown error")),I(!1)});return()=>p()},[]);const z=({active:n,payload:p,label:a})=>{if(n&&p&&p.length){const u=p[0].payload;return(0,e.jsxs)("div",{className:"bg-white p-4 border border-gray-200 shadow-lg rounded-md",children:[(0,e.jsx)("p",{className:"font-medium text-gray-900",children:O(u.timestamp)}),(0,e.jsxs)("p",{className:"text-indigo-600",children:["Deposits: $",u.deposits.toFixed(2)]}),(0,e.jsxs)("p",{className:"text-red-600",children:["loans: $",u.loans.toFixed(2)]})]})}return null},l=(n,p,a=20)=>{const u=[];return n.forEach(w=>{const M=w.timestamp?.toDate?.()||new Date(w.timestamp);u.push({timestamp:M,name:M.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),deposits:Number(w.amount)||0,loans:0})}),p.forEach(w=>{const M=w.timestamp?.toDate?.()||new Date(w.timestamp);u.push({timestamp:M,name:M.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),deposits:0,loans:Number(w.amount)||0})}),u.sort((w,M)=>w.timestamp-M.timestamp),u.slice(-a)};(0,s.useEffect)(()=>{if(!L){console.error("Firestore database instance not available"),c(!0),F(!0);return}let n=[],p=[];const a=K(_(L,"deposits"),Y("timestamp","desc")),u=q(a,$=>{try{let B=0;n=[],$.forEach(r=>{const A=r.data();A.amount&&(B+=parseFloat(A.amount)),n.push({id:r.id,...A,timestamp:A.timestamp})}),g(B),c(!1);const Q=l(n,p);R(Q),y(r=>[...n.slice(0,3).map(A=>({id:A.id,type:"deposit",userId:A.userId,amount:A.amount,timestamp:A.timestamp?.toDate?.()||new Date})),...r].slice(0,6))}catch(B){console.error("Error processing deposits data:",B),c(!0)}},$=>{console.error("Error fetching deposits:",$),c(!0)}),w=K(_(L,"loans"),Y("timestamp","desc")),M=q(w,$=>{try{let B=0,Q=0;p=[],$.forEach(A=>{const C=A.data();C.amount&&(B+=parseFloat(C.amount)),C.status==="pending"&&(Q+=1),p.push({id:A.id,...C,timestamp:C.timestamp})}),f(B),m(Q),F(!1);const r=l(n,p);R(r),y(A=>[...p.slice(0,3).map(C=>({id:C.id,type:"cashout",userId:C.userId,amount:C.amount,status:C.status,timestamp:C.timestamp?.toDate?.()||new Date})),...A].slice(0,6))}catch(B){console.error("Error processing loans data:",B),F(!0)}},$=>{console.error("Error fetching loans:",$),F(!0)});return()=>{u(),M()}},[]);const D=n=>`$${n.toFixed(2)}`,t=n=>new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),d=[{id:1,name:"Total Deposits",value:k?"N/A":D(i),change:"+12.5%",changeType:"positive",icon:ae,iconColor:"bg-indigo-500"},{id:2,name:"Total loans",value:x?"N/A":D(E),change:"+8.2%",changeType:"positive",icon:me,iconColor:"bg-red-500"},{id:3,name:"Pending loans",value:x?"N/A":h,change:"+3.1%",changeType:"negative",icon:Ze,iconColor:"bg-yellow-500"},{id:4,name:"Total Users",value:j?"N/A":v,change:"+5.4%",changeType:"positive",icon:De,iconColor:"bg-green-500"}];return P?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading dashboard..."})]})}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6",children:d.map(n=>(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 transition-all duration-200 hover:shadow-md",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:n.name}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:n.value})]}),(0,e.jsx)("div",{className:`p-3 rounded-full ${n.iconColor}`,children:(0,e.jsx)(n.icon,{className:"h-6 w-6 text-white"})})]}),(0,e.jsxs)("div",{className:"mt-4 flex items-center",children:[n.changeType==="positive"?(0,e.jsx)(Je,{className:"h-4 w-4 text-green-500"}):(0,e.jsx)(Xe,{className:"h-4 w-4 text-red-500"}),(0,e.jsx)("span",{className:`ml-1 text-sm font-medium ${n.changeType==="positive"?"text-green-500":"text-red-500"}`,children:n.change}),(0,e.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:"from last month"})]})]},n.id))}),(0,e.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Live Transactions"}),(0,e.jsx)("div",{className:"h-80 overflow-x-hidden",children:(0,e.jsx)(oe,{width:"100%",height:"100%",children:(0,e.jsxs)(Le,{data:T,margin:{top:5,right:30,left:20,bottom:5},children:[(0,e.jsx)(de,{strokeDasharray:"3 3"}),(0,e.jsx)(le,{dataKey:"name",tick:{fontSize:10},interval:0,minTickGap:15}),(0,e.jsx)(ce,{}),(0,e.jsx)(ie,{content:(0,e.jsx)(z,{})}),(0,e.jsx)(fe,{dataKey:"deposits",fill:"#4f46e5",name:"Deposits",isAnimationActive:!0,animationDuration:800,animationEasing:"ease-in-out"}),(0,e.jsx)(fe,{dataKey:"loans",fill:"#ef4444",name:"loans",isAnimationActive:!0,animationDuration:800,animationEasing:"ease-in-out"})]})})})]}),(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Transaction Trend"}),(0,e.jsx)("div",{className:"h-80 overflow-x-hidden",children:(0,e.jsx)(oe,{width:"100%",height:"100%",children:(0,e.jsxs)(be,{data:T,margin:{top:5,right:30,left:20,bottom:5},children:[(0,e.jsx)(de,{strokeDasharray:"3 3"}),(0,e.jsx)(le,{dataKey:"name",tick:{fontSize:10},interval:0,minTickGap:15}),(0,e.jsx)(ce,{}),(0,e.jsx)(ie,{content:(0,e.jsx)(z,{})}),(0,e.jsx)(ne,{type:"monotone",dataKey:"deposits",stroke:"#4f46e5",activeDot:{r:8},name:"Deposits",isAnimationActive:!0,animationDuration:800,animationEasing:"ease-in-out"}),(0,e.jsx)(ne,{type:"monotone",dataKey:"loans",stroke:"#ef4444",name:"loans",isAnimationActive:!0,animationDuration:800,animationEasing:"ease-in-out"})]})})})]})]}),(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Recent Activity"}),(0,e.jsx)("button",{className:"text-sm font-medium text-indigo-600 hover:text-indigo-800",children:"View all"})]}),(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User ID"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:o.length>0?o.map(n=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[n.type==="deposit"?(0,e.jsx)("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center",children:(0,e.jsx)(ae,{className:"h-4 w-4 text-indigo-600"})}):(0,e.jsx)("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:(0,e.jsx)(me,{className:"h-4 w-4 text-red-600"})}),(0,e.jsx)("span",{className:"ml-3 text-sm font-medium text-gray-900 capitalize",children:n.type})]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:n.userId||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:D(n.amount||0)}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:n.type==="deposit"?(0,e.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"Completed"}):(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${n.status==="Pending"?"bg-yellow-100 text-yellow-800":n.status==="Accepted"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:n.status||"Pending"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t(n.timestamp)})]},n.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"5",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No recent activity"})})})]})})]})]})},ye=js,ys=()=>{const{currentUser:i}=J(),[g,E]=(0,s.useState)([]),[f,h]=(0,s.useState)([]),[m,v]=(0,s.useState)(!0),[N,k]=(0,s.useState)(null),[c,x]=(0,s.useState)(""),[F,j]=(0,s.useState)(null),[U,T]=(0,s.useState)(!1),[R,o]=(0,s.useState)(new Set);(0,s.useEffect)(()=>{if(!i)return;const t=q(_(L,"users"),d=>{const n=[];d.forEach(p=>{n.push({id:p.id,...p.data()})}),h(n)},d=>{console.error("Error fetching users:",d)});return()=>t()},[i]),(0,s.useEffect)(()=>{if(!i)return;const t=q(_(L,"loans"),d=>{const n=[];d.forEach(p=>{n.push({id:p.id,...p.data()})}),n.sort((p,a)=>{const u=p.paymentTimestamp?.toDate?.()||new Date(0);return(a.paymentTimestamp?.toDate?.()||new Date(0))-u}),E(n),v(!1)},d=>{console.error("Error fetching paybacks:",d),v(!1)});return()=>t()},[i]);const y=g.map(t=>{const d=f.find(n=>n.uid===t.userId);return{...t,userName:d?.fullName||"Unknown User",userEmail:d?.email||"No email provided"}}),b=(t,d)=>{k({message:t,type:d}),setTimeout(()=>{k(null)},3e3)},S=async t=>{try{o(d=>new Set(d).add(t)),setTimeout(async()=>{const d=W(L,"loans",t);await X(d,{paymentStatus:"approved",adminReviewedAt:Z()}),setTimeout(()=>{o(n=>{const p=new Set(n);return p.delete(t),p})},300),b("Payment approved successfully!","success")},100)}catch(d){console.error("Error approving payment:",d),b("Failed to approve payment. Please try again.","error"),o(n=>{const p=new Set(n);return p.delete(t),p})}},P=async t=>{try{o(d=>new Set(d).add(t)),setTimeout(async()=>{const d=W(L,"loans",t);await X(d,{paymentStatus:"denied",adminReviewedAt:Z()}),setTimeout(()=>{o(n=>{const p=new Set(n);return p.delete(t),p})},300),b("Payment denied.","error")},100)}catch(d){console.error("Error denying payment:",d),b("Failed to deny payment. Please try again.","error"),o(n=>{const p=new Set(n);return p.delete(t),p})}},I=t=>{j(t),T(!0)},O=()=>{T(!1),j(null)},z=t=>{if(!t)return"N/A";const d=t.toDate(),n=d.getDate().toString().padStart(2,"0"),p=(d.getMonth()+1).toString().padStart(2,"0"),a=d.getFullYear(),u=d.getHours().toString().padStart(2,"0"),w=d.getMinutes().toString().padStart(2,"0");return`${n}/${p}/${a} ${u}:${w}`},l=y.filter(t=>{if(t.status!=="accepted")return!1;const d=t.userName||"",n=c.toLowerCase();return d.toLowerCase().includes(n)}),D=y.filter(t=>t.status==="accepted"&&t.paymentStatus==="pending").length;return(0,e.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8",children:[N&&(0,e.jsx)("div",{className:`fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg transform transition-all duration-300 ${N.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:N.message}),(0,e.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,e.jsxs)("div",{className:"mb-8",children:[(0,e.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Loan Repayment Management"}),(0,e.jsx)("p",{className:"mt-2 text-gray-600",children:"Review and manage loan repayments for accepted loans"})]}),(0,e.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6",children:(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ee,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by user name...",value:c,onChange:t=>x(t.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]})}),(0,e.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,e.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Accepted Loan Repayments"}),(0,e.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:[D," pending"]})]}),m?(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"}),(0,e.jsx)("p",{className:"text-gray-600",children:"Loading loan repayments..."})]}):l.length===0?(0,e.jsxs)("div",{className:"text-center py-12",children:[(0,e.jsx)("div",{className:"mx-auto h-16 w-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:(0,e.jsx)(ee,{className:"h-8 w-8 text-gray-400"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No accepted loans found"}),(0,e.jsx)("p",{className:"text-gray-500",children:"There are no accepted loans at the moment."})]}):(0,e.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(t=>{const d=R.has(t.id),n=!t.paymentStatus||t.paymentStatus==="pending";return(0,e.jsx)("div",{className:`bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden transition-all duration-300 hover:shadow-md ${d?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-indigo-800 font-medium",children:t.userName?.charAt(0)?.toUpperCase()||"U"})}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:t.userName||"Unknown User"}),(0,e.jsx)("p",{className:"text-sm text-gray-500",children:t.userEmail||"No email provided"})]})]}),(0,e.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                            ${t.paymentStatus==="approved"?"bg-green-100 text-green-800":t.paymentStatus==="denied"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.paymentStatus?.charAt(0)?.toUpperCase()+t.paymentStatus?.slice(1)||"Pending"})]}),(0,e.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Loan Amount"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",t.amount]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Interest (10%)"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",(t.amount*.1).toFixed(2)]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Payable"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",t.totalPayable?.toFixed(2)||(t.amount*1.1).toFixed(2)]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Paid Amount"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",t.paidAmount]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Payment Date"}),(0,e.jsx)("span",{className:"text-sm font-medium text-gray-900",children:z(t.paymentTimestamp)})]}),t.adminReviewedAt&&(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Reviewed At"}),(0,e.jsx)("span",{className:"text-sm font-medium text-gray-900",children:z(t.adminReviewedAt)})]})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("span",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proof of Payment"}),t.proofImageUrl?(0,e.jsxs)("div",{className:"relative w-full h-32 rounded-lg overflow-hidden cursor-pointer border border-gray-200",onClick:()=>I(t.proofImageUrl),children:[(0,e.jsx)("img",{src:t.proofImageUrl,alt:"Proof of payment",className:"w-full h-full object-cover"}),(0,e.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:(0,e.jsx)(pe,{className:"h-6 w-6 text-white"})})]}):(0,e.jsx)("div",{className:"w-full h-32 rounded-lg bg-gray-100 flex items-center justify-center border border-gray-200",children:(0,e.jsx)("span",{className:"text-gray-500 text-sm",children:"No proof provided"})})]}),(0,e.jsxs)("div",{className:"flex space-x-3",children:[(0,e.jsxs)("button",{className:`flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg transition-colors ${n?"text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500":"text-gray-400 bg-gray-100 cursor-not-allowed"}`,onClick:()=>S(t.id),disabled:!n,children:[(0,e.jsx)(es,{className:"-ml-1 mr-2 h-4 w-4"}),"Approve"]}),(0,e.jsxs)("button",{className:`flex-1 inline-flex items-center justify-center px-4 py-2 border text-sm font-medium rounded-lg transition-colors ${n?"text-gray-700 bg-white border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500":"text-gray-400 bg-gray-100 border-gray-200 cursor-not-allowed"}`,onClick:()=>P(t.id),disabled:!n,children:[(0,e.jsx)(re,{className:"-ml-1 mr-2 h-4 w-4"}),"Deny"]})]})]})},t.id)})})]})]}),U&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:O,children:(0,e.jsxs)("div",{className:"relative max-w-4xl max-h-full",onClick:t=>t.stopPropagation(),children:[(0,e.jsx)("button",{className:"absolute -top-12 right-0 text-white hover:text-gray-300 focus:outline-none",onClick:O,children:(0,e.jsx)(re,{className:"h-8 w-8"})}),(0,e.jsx)("img",{src:F,alt:"Proof of payment",className:"max-w-full max-h-screen rounded-lg"})]})})]})},Ns=ys,bs=()=>{const[i,g]=(0,s.useState)([]),[E,f]=(0,s.useState)([]),[h,m]=(0,s.useState)(!0),[v,N]=(0,s.useState)(null),[k,c]=(0,s.useState)(""),[x,F]=(0,s.useState)("All"),[j,U]=(0,s.useState)(null),[T,R]=(0,s.useState)(!1),[o,y]=(0,s.useState)({});(0,s.useEffect)(()=>{const a=K(_(L,"users")),u=q(a,w=>{const M=w.docs.map($=>({id:$.id,...$.data()}));f(M)},w=>{console.error("Error loading users:",w),N("Failed to load users: "+w.message)});return()=>u()},[]),(0,s.useEffect)(()=>{const a=K(_(L,"deposits"),Y("timestamp","desc")),u=q(a,w=>{try{const M=w.docs.map($=>({id:$.id,...$.data()})).map($=>{const B=E.find(Q=>Q.uid===$.userId);return{...$,userName:B?B.fullName||"Unnamed User":"Unknown User"}});g(M),m(!1)}catch(M){console.error("Error merging deposit data:",M),N("Error processing deposit data: "+M.message),m(!1)}},w=>{console.error("Firestore error:",w),N("Failed to load deposits: "+w.message),m(!1)});return()=>u()},[E]);const b=a=>{switch(a){case"accepted":return"bg-green-100 text-green-800";case"denied":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},S=async(a,u)=>{try{const w=W(L,"deposits",a);await X(w,{status:u}),console.log(`Deposit ${a} status updated to ${u}`)}catch(w){console.error("Error updating deposit status:",w),N("Failed to update deposit status: "+w.message)}},P=a=>{if(!a)return"N/A";if(a.seconds){const u=new Date(a.seconds*1e3);return u.toLocaleDateString()+" "+u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}if(a.toDate){const u=a.toDate();return u.toLocaleDateString()+" "+u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return a.toString()},I=i.reduce((a,u)=>a+(parseFloat(u.amount)||0),0),O=i.filter(a=>a.status==="pending").length,z=i.filter(a=>a.status==="accepted").length,l=i.filter(a=>a.status==="denied").length,D=i.filter(a=>a.status==="accepted").reduce((a,u)=>a+(parseFloat(u.amount)||0),0),t=i.filter(a=>a.status==="denied").reduce((a,u)=>a+(parseFloat(u.amount)||0),0),d=i.filter(a=>{const u=a.userName?.toLowerCase().includes(k.toLowerCase())||a.userId?.toLowerCase().includes(k.toLowerCase())||a.message?.toLowerCase().includes(k.toLowerCase()),w=x==="All"||a.status===x;return u&&w}),n=a=>{U(a),R(!0)},p=()=>{R(!1),U(null)};return h?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading deposits..."})]})}):v?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",v]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(console.log("DepositsPage: Rendering with deposits array length:",i.length),(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Deposits"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",I.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-indigo-100",children:(0,e.jsx)(ae,{className:"h-6 w-6 text-indigo-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Pending Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:O})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-yellow-100",children:(0,e.jsx)(Ae,{className:"h-6 w-6 text-yellow-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Approved Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:z})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(xe,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Denied Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:l})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(te,{className:"h-6 w-6 text-red-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Accepted Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",D.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(xe,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Declined Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",t.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(te,{className:"h-6 w-6 text-red-600"})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Deposit Records"}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ee,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by name, user ID or message...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:k,onChange:a=>c(a.target.value)})]}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsxs)("select",{className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg bg-gray-50",value:x,onChange:a=>F(a.target.value),children:[(0,e.jsx)("option",{value:"All",children:"All Statuses"}),(0,e.jsx)("option",{value:"pending",children:"Pending"}),(0,e.jsx)("option",{value:"accepted",children:"Accepted"}),(0,e.jsx)("option",{value:"denied",children:"Denied"})]}),(0,e.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,e.jsx)(Se,{className:"h-5 w-5 text-gray-400"})})]})]})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-scroll",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User Name"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proof"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:d.length>0?d.map(a=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:a.userName}),(0,e.jsxs)("div",{className:"text-xs text-gray-500 italic",children:["ID: ",a.userId]})]}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:["$",a.amount?parseFloat(a.amount).toFixed(2):"0.00"]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${b(a.status||"pending")}`,children:a.status||"pending"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:a.imageUrl?(0,e.jsxs)("button",{onClick:()=>n(a),className:"text-indigo-600 hover:text-indigo-900 flex items-center",children:[(0,e.jsx)(pe,{className:"h-4 w-4 mr-1"}),"View"]}):(0,e.jsx)("span",{className:"text-gray-400",children:"No proof"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:P(a.timestamp)}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,e.jsxs)("div",{className:"flex items-center space-x-3",children:[a.status==="pending"?(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("button",{disabled:!!o[a.id],onClick:async()=>{if(window.confirm("Mark this deposit as Accepted?")){y(u=>({...u,[a.id]:!0}));try{await S(a.id,"accepted"),console.log("Deposit accepted:",a.id)}finally{y(u=>{const w={...u};return delete w[a.id],w})}}},className:"px-3 py-1 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors duration-200 disabled:opacity-50",children:o[a.id]?"Processing...":"Approve"}),(0,e.jsx)("button",{disabled:!!o[a.id],onClick:async()=>{if(window.confirm("Mark this deposit as Denied?")){y(u=>({...u,[a.id]:!0}));try{await S(a.id,"denied"),console.log("Deposit denied:",a.id)}finally{y(u=>{const w={...u};return delete w[a.id],w})}}},className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors duration-200 disabled:opacity-50",children:o[a.id]?"Processing...":"Deny"})]}):(0,e.jsx)("span",{className:"text-sm text-gray-500",children:a.status||"No actions"}),a.imageUrl?(0,e.jsx)("button",{onClick:()=>window.open(a.imageUrl,"_blank"),className:"text-indigo-600 hover:text-indigo-900 flex items-center",title:"View proof in new tab",children:(0,e.jsx)(ve,{className:"h-4 w-4"})}):null]})})]},a.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No deposits found."})})})]})})}),T&&j&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,e.jsxs)("div",{className:"bg-white  rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-scroll",children:[(0,e.jsxs)("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Deposit Proof"}),(0,e.jsx)("button",{onClick:p,className:"text-gray-400 hover:text-gray-500",children:(0,e.jsx)(te,{className:"h-6 w-6"})})]}),(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"User Name"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:j.userName||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"User ID"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:j.userId||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Amount"}),(0,e.jsxs)("p",{className:"text-sm text-gray-900",children:["$",j.amount?parseFloat(j.amount).toFixed(2):"0.00"]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Status"}),(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${b(j.status||"pending")}`,children:j.status||"pending"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Date"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:P(j.timestamp)})]}),(0,e.jsxs)("div",{className:"md:col-span-2",children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Message"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:j.message||"No message"})]})]}),(0,e.jsxs)("div",{className:"mt-6",children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Proof Image"}),(0,e.jsx)("div",{className:"border border-gray-200 rounded-lg ",children:j.imageUrl?(0,e.jsx)("img",{src:j.imageUrl,alt:"Deposit Proof",className:"w-full h-auto max-h-[60vh] object-contain",onError:a=>{a.target.style.display="none"}}):(0,e.jsx)("div",{className:"flex items-center justify-center h-64 bg-gray-100 text-gray-500",children:"No image available"})})]}),(0,e.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,e.jsx)("button",{onClick:p,className:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50",children:"Close"}),j.status==="pending"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("button",{onClick:()=>{S(j.id,"accepted"),p()},className:"px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-green-600 hover:bg-green-700",children:"Approve"}),(0,e.jsx)("button",{onClick:()=>{S(j.id,"denied"),p()},className:"px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-red-600 hover:bg-red-700",children:"Deny"})]})]})]})]})})]}))},ws=bs;function vs(){const{currentUser:i}=J(),[g,E]=(0,s.useState)([]),[f,h]=(0,s.useState)(""),[m,v]=(0,s.useState)(!0),[N,k]=(0,s.useState)({}),[c,x]=(0,s.useState)({}),F=(0,s.useRef)(),j=(0,s.useRef)(),U=o=>{if(!o)return!1;const y=o.toDate?o.toDate():new Date(o);return(new Date-y)/(1e3*60)<2};(0,s.useEffect)(()=>{if(!i)return;(async()=>{try{const b=W(L,"users",i.uid);await X(b,{isOnline:!0,lastActive:Z()})}catch(b){console.error("Error setting user online:",b)}})(),j.current=setInterval(async()=>{try{const b=W(L,"users",i.uid);await X(b,{lastActive:Z()})}catch(b){console.error("Error updating lastActive:",b)}},3e4);const y=async()=>{try{const b=W(L,"users",i.uid);await X(b,{isOnline:!1,lastActive:Z()})}catch(b){console.error("Error setting user offline:",b)}};return window.addEventListener("beforeunload",y),()=>{clearInterval(j.current),window.removeEventListener("beforeunload",y),i&&(async()=>{try{const S=W(L,"users",i.uid);await X(S,{isOnline:!1,lastActive:Z()})}catch(S){console.error("Error setting user offline:",S)}})()}},[i]),(0,s.useEffect)(()=>{if(!i){v(!1);return}const o=K(_(L,"messages"),Y("timestamp","asc"));return q(o,y=>{E(y.docs.map(b=>({id:b.id,...b.data()}))),v(!1)})},[i]),(0,s.useEffect)(()=>{if(i)return q(_(L,"users"),o=>{const y={},b={};o.forEach(S=>{const P=S.data();y[S.id]=P,U(P.lastActive)&&(b[S.id]={displayName:P.displayName||P.email?.split("@")[0]||"Unknown",isOnline:P.isOnline||!1,lastActive:P.lastActive})}),x(y),k(b)})},[i]);const T=async o=>{if(o.preventDefault(),!(!i||!f.trim()))try{await Ke(_(L,"messages"),{text:f,userId:i.uid,userName:i.email?i.email.split("@")[0]:"Anonymous",timestamp:Z()}),h("")}catch(y){console.error("Error sending message:",y)}};(0,s.useEffect)(()=>{F.current?.scrollIntoView({behavior:"smooth"})},[g]);const R=o=>o?o.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";return i?(0,e.jsxs)("div",{className:"flex flex-col  h-screen bg-gradient-to-b from-gray-50 to-gray-100 font-sans text-gray-800 max-w-4xl mx-auto w-full",children:[(0,e.jsx)("div",{className:"mx-4 mb-2 bg-white/70 backdrop-blur-md rounded-xl shadow-sm p-3",children:(0,e.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,e.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,e.jsxs)("span",{className:"text-xs text-gray-600",children:[Object.keys(N).length," online"]}),(0,e.jsx)("br",{}),(0,e.jsxs)("p",{className:"text-sm text-gray-500",children:[g.length," Messages"]})]})}),(0,e.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 flex flex-col gap-4 max-w-full",children:[m?(0,e.jsx)("div",{className:"flex justify-center p-6",children:(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce"}),(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce",style:{animationDelay:"0.16s"}}),(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce",style:{animationDelay:"0.32s"}})]})}):g.length===0?(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center text-gray-500 p-10 bg-white rounded-2xl shadow-lg m-5",children:[(0,e.jsx)("div",{className:"text-4xl mb-3 opacity-70",children:"ðŸ’¬"}),(0,e.jsx)("div",{className:"text-sm text-center max-w-xs",children:"No messages yet. Start a conversation!"})]}):g.map(o=>(0,e.jsxs)("div",{className:`flex ${o.userId===i.uid?"justify-end":"justify-start"} animate-fade-in`,children:[o.userId!==i.uid&&(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center bg-white text-indigo-600 font-bold flex-shrink-0 shadow-sm mr-2",children:o.userName?o.userName.charAt(0).toUpperCase():"U"}),(0,e.jsx)("div",{className:`absolute bottom-[60px] right-7 w-3.5 h-3.5 rounded-full border-2 border-white ${N[o.userId]?"bg-green-500":"bg-gray-400"}`,title:N[o.userId]?"Online":"Offline"})]}),(0,e.jsxs)("div",{className:`max-w-[72%] p-3 rounded-2xl relative shadow-md transition-all duration-300 hover:shadow-lg ${o.userId===i.uid?"bg-gradient-to-br from-indigo-50 to-indigo-100 border border-indigo-100 rounded-br-md":"bg-white border border-gray-200 rounded-bl-md"}`,children:[(0,e.jsx)("div",{className:"text-sm text-gray-800 leading-relaxed",children:o.text}),(0,e.jsx)("div",{className:"text-xs text-gray-400 text-right mt-2",children:R(o.timestamp)})]}),o.userId===i.uid&&(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white font-bold flex-shrink-0 shadow-sm ml-2",children:o.userName?o.userName.charAt(0).toUpperCase():"U"}),(0,e.jsx)("div",{className:`absolute bottom-[60px] right-6 w-3.5 h-3.5 rounded-full border-2 border-white ${U(c[i?.uid]?.lastActive)?"bg-green-500":"bg-gray-400"}`,title:U(c[i?.uid]?.lastActive)?"Online":"Offline"})]})]},o.id)),(0,e.jsx)("div",{ref:F})]}),(0,e.jsxs)("form",{onSubmit:T,className:"flex items-center p-4 gap-3 sticky bottom-0 bg-white/70 backdrop-blur-md border-t border-gray-200",children:[(0,e.jsx)("div",{className:"flex-1 flex items-center bg-white p-2 pl-4 rounded-full shadow-md transition-all duration-300 focus-within:shadow-lg focus-within:border focus-within:border-indigo-500",children:(0,e.jsx)("input",{type:"text",className:"flex-1 border-0 outline-none p-2 bg-transparent text-sm text-gray-800",placeholder:"Type a message...",value:f,onChange:o=>h(o.target.value)})}),(0,e.jsx)("button",{type:"submit",className:"w-11 h-11 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white border-none cursor-pointer shadow-md transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",disabled:!f.trim(),children:(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4.5 h-4.5",children:(0,e.jsx)("path",{d:"M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"})})})]})]}):(0,e.jsx)("div",{className:"flex flex-col h-screen bg-gradient-to-b from-gray-50 to-gray-100 items-center justify-center font-sans text-gray-800",children:(0,e.jsxs)("div",{className:"text-center p-6 bg-white rounded-2xl shadow-lg max-w-md",children:[(0,e.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Please log in to use chat"}),(0,e.jsx)("p",{className:"text-gray-600",children:"You need to be logged in to send and receive messages."})]})})}var Ss=()=>(0,e.jsx)("div",{className:"",children:(0,e.jsx)("main",{children:(0,e.jsx)(vs,{})})}),Ds=Ss,As=()=>{const[i,g]=(0,s.useState)(!1),{currentUser:E}=J(),f=Te(),h=he(),{logout:m}=J(),v=async()=>{try{await m(),h("/login")}catch(c){console.error("Failed to log out",c)}};(0,s.useEffect)(()=>{const c=()=>{window.innerWidth>=1024&&g(!1)};return window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),(0,s.useEffect)(()=>{const c=x=>{i&&!x.target.closest(".sidebar-content")&&!x.target.closest(".sidebar-toggle")&&g(!1)};return document.addEventListener("click",c),()=>document.removeEventListener("click",c)},[i]),(0,s.useEffect)(()=>{g(!1)},[f.pathname]);const N=[{name:"Dashboard",href:"/dashboard",icon:rs},{name:"Deposits",href:"/deposits",icon:cs},{name:"loans",href:"/loans",icon:ns},{name:"Chat",href:"/chat",icon:as},{name:"Users",href:"/users",icon:De},{name:"Payback",href:"/payback",icon:ss},{name:"Settings",href:"/settings",icon:ts}],k=c=>f.pathname===c;return(0,e.jsxs)("div",{className:"flex h-screen w-screen max-w-full bg-gray-50",children:[(0,e.jsx)("div",{className:`fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform ${i?"translate-x-0":"-translate-x-full"} transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0 sidebar-content`,children:(0,e.jsxs)("div",{className:"flex flex-col h-full",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between h-16 px-6 border-b border-gray-200",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)("div",{className:"w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-white font-bold",children:"MB"})})}),(0,e.jsx)("div",{className:"ml-3",children:(0,e.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"MoneyBox"})})]}),(0,e.jsx)("button",{onClick:()=>g(!1),className:"lg:hidden text-gray-500 hover:text-gray-700",children:(0,e.jsx)(re,{size:20})})]}),(0,e.jsx)("nav",{className:"flex-1 px-4 py-6 overflow-y-auto",children:(0,e.jsx)("ul",{className:"space-y-1",children:N.map(c=>(0,e.jsx)("li",{children:(0,e.jsxs)(ge,{to:c.href,className:`flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-all duration-200 ${k(c.href)?"bg-indigo-50 text-indigo-700":"text-gray-700 hover:bg-gray-100"}`,children:[(0,e.jsx)(c.icon,{className:"mr-3 h-5 w-5"}),c.name]})},c.name))})}),(0,e.jsxs)("div",{className:"px-4 py-6 border-t border-gray-200",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:(0,e.jsx)("div",{className:"w-11 h-11 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white font-bold shadow-md",children:E?.email?.charAt(0).toUpperCase()||"U"})})}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Admin  is           ",E?.email?.slice(0,5).toUpperCase()||"U"]}),(0,e.jsx)("p",{className:"text-xs text-gray-500",children:E?.email?.slice(0,104).toLowerCase()||"U"})]})]}),(0,e.jsxs)("button",{onClick:v,className:"flex items-center w-full px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors duration-200",children:[(0,e.jsx)(je,{className:"mr-3 h-5 w-5"}),"Logout"]})]})]})}),(0,e.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,e.jsx)("header",{className:"bg-white shadow-sm z-10",children:(0,e.jsxs)("div",{className:"flex items-center justify-between h-16 px-6",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("button",{onClick:()=>g(!0),className:"lg:hidden text-gray-500 hover:text-gray-700 mr-4 sidebar-toggle",children:(0,e.jsx)(ls,{size:20})}),(0,e.jsxs)("h2",{className:"text-xl font-semibold text-gray-800",children:[f.pathname==="/dashboard"&&"ðŸ’° Dashboard",f.pathname==="/deposits"&&"ðŸ’° Deposits Overview",f.pathname==="/loans"&&"ðŸ’¸ loans Overview",f.pathname==="/users"&&"ðŸ‘¥ Users Overview",f.pathname==="/chat"&&"ðŸ‘¥ Users Overview"]})]}),(0,e.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ee,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search...",className:"block w-64 pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,e.jsxs)("button",{className:"p-1 text-gray-500 hover:text-gray-700 relative",children:[(0,e.jsx)(Qe,{className:"h-6 w-6"}),(0,e.jsx)("span",{className:"absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"})]}),(0,e.jsx)("div",{className:"flex items-center",children:(0,e.jsx)("div",{className:"w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center",children:(0,e.jsx)(is,{className:"h-5 w-5 text-indigo-600"})})}),(0,e.jsxs)("button",{onClick:v,className:"flex items-center text-sm font-medium text-gray-700 hover:text-gray-900",children:[(0,e.jsx)(je,{className:"mr-2 h-5 w-5"}),"Logout"]})]})]})}),(0,e.jsx)("main",{className:"flex-1 overflow-y-auto bg-gray-50 p-6",children:(0,e.jsx)("div",{className:"h-full w-full",children:(0,e.jsx)(Pe,{})})})]})]})},ks=As,Cs=()=>{const[i,g]=(0,s.useState)([]),[E,f]=(0,s.useState)([]),[h,m]=(0,s.useState)(!0),[v,N]=(0,s.useState)(null),[k,c]=(0,s.useState)(""),[x,F]=(0,s.useState)("All"),[j,U]=(0,s.useState)({});(0,s.useEffect)(()=>{const l=K(_(L,"users")),D=q(l,t=>{const d=t.docs.map(n=>({id:n.id,...n.data()}));f(d)},t=>{console.error("Error loading users:",t),N("Failed to load users: "+t.message)});return()=>D()},[]),(0,s.useEffect)(()=>{const l=K(_(L,"loans"),Y("timestamp","desc")),D=q(l,t=>{try{const d=t.docs.map(n=>({id:n.id,...n.data()})).map(n=>{const p=E.find(a=>a.uid===n.userId);return{...n,userName:p?p.fullName||"Unnamed User":"Unknown User"}});g(d),m(!1)}catch(d){console.error("Error merging loan data:",d),N("Error processing loan data: "+d.message),m(!1)}},t=>{console.error("Firestore error:",t),N("Failed to load loans: "+t.message),m(!1)});return()=>D()},[E]);const T=l=>{switch(l){case"accepted":return"bg-green-100 text-green-800";case"denied":return"bg-red-100 text-red-800";case"Pending":case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},R=async(l,D)=>{try{const t=W(L,"loans",l);await X(t,{status:D}),console.log(`Loan ${l} status updated to ${D}`)}catch(t){console.error("Error updating loan status:",t),N("Failed to update loan status: "+t.message)}},o=l=>{if(!l)return"N/A";if(l.seconds){const D=new Date(l.seconds*1e3);return D.toLocaleDateString()+" "+D.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}if(l.toDate){const D=l.toDate();return D.toLocaleDateString()+" "+D.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return l.toString()},y=i.reduce((l,D)=>l+(parseFloat(D.amount)||0),0),b=i.filter(l=>l.status==="pending").length,S=i.filter(l=>l.status==="accepted").length,P=i.filter(l=>l.status==="denied").length,I=i.filter(l=>l.status==="accepted").reduce((l,D)=>l+(parseFloat(D.amount)||0),0),O=i.filter(l=>l.status==="denied").reduce((l,D)=>l+(parseFloat(D.amount)||0),0),z=i.filter(l=>{const D=l.userName?.toLowerCase().includes(k.toLowerCase())||l.userId?.toLowerCase().includes(k.toLowerCase())||l.message?.toLowerCase().includes(k.toLowerCase()),t=x==="All"||l.status===x;return D&&t});return h?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading loans..."})]})}):v?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",v]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total loans"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",y.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-blue-100",children:(0,e.jsx)(me,{className:"h-6 w-6 text-blue-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Pending loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:b})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-yellow-100",children:(0,e.jsx)(Ae,{className:"h-6 w-6 text-yellow-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Paid loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:S})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(ms,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Declined loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:P})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(te,{className:"h-6 w-6 text-red-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Accepted Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",I.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(xe,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Declined Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",O.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(te,{className:"h-6 w-6 text-red-600"})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Loans Records"}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ee,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by name, user ID or message...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:k,onChange:l=>c(l.target.value)})]}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsxs)("select",{className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg bg-gray-50",value:x,onChange:l=>F(l.target.value),children:[(0,e.jsx)("option",{value:"All",children:"All Statuses"}),(0,e.jsx)("option",{value:"Pending",children:"Pending"}),(0,e.jsx)("option",{value:"accepted",children:"Paid"}),(0,e.jsx)("option",{value:"denied",children:"Declined"})]}),(0,e.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,e.jsx)(Se,{className:"h-5 w-5 text-gray-400"})})]})]})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User Name"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:z.length>0?z.map(l=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,e.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:l.userName}),(0,e.jsxs)("div",{className:"text-xs text-gray-500 italic",children:["ID: ",l.userId]})]}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:["$",l.amount?parseFloat(l.amount).toFixed(2):"0.00"]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${T(l.status)}`,children:l.status==="accepted"?"Paid":l.status||"Pending"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o(l.timestamp)}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,e.jsxs)("div",{className:"flex items-center space-x-3",children:[l.status==="pending"?(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("button",{disabled:!!j[l.id],onClick:async()=>{if(window.confirm("Mark this loan as Paid?")){U(D=>({...D,[l.id]:!0}));try{await R(l.id,"accepted")}finally{U(D=>{const t={...D};return delete t[l.id],t})}}},className:"px-3 py-1 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors duration-200 disabled:opacity-50",children:j[l.id]?"Processing...":"Pay"}),(0,e.jsx)("button",{disabled:!!j[l.id],onClick:async()=>{if(window.confirm("Mark this loan as Declined?")){U(D=>({...D,[l.id]:!0}));try{await R(l.id,"denied")}finally{U(D=>{const t={...D};return delete t[l.id],t})}}},className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors duration-200 disabled:opacity-50",children:j[l.id]?"Processing...":"Decline"})]}):(0,e.jsx)("span",{className:"text-sm text-gray-500",children:l.status==="accepted"?"Paid":l.status}),l.imageUrl&&(0,e.jsx)("button",{onClick:()=>window.open(l.imageUrl,"_blank"),className:"text-indigo-600 hover:text-indigo-900 flex items-center",title:"View proof",children:(0,e.jsx)(ds,{className:"h-4 w-4"})})]})})]},l.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"5",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No loans found."})})})]})})})]})},Es=Cs,Ls=()=>{const[i,g]=(0,s.useState)([]),[E,f]=(0,s.useState)(!0),[h,m]=(0,s.useState)(null),[v,N]=(0,s.useState)(""),[k,c]=(0,s.useState)(!1),[x,F]=(0,s.useState)(null),[j,U]=(0,s.useState)([]),[T,R]=(0,s.useState)([]),[o,y]=(0,s.useState)(!1),[b,S]=(0,s.useState)(!1),[P,I]=(0,s.useState)(null),[O,z]=(0,s.useState)(null),[l,D]=(0,s.useState)({}),t=(0,s.useRef)(null),d=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!L){m("Firestore instance not available"),f(!1);return}const r=K(_(L,"users"),Y("createdAt","desc")),A=q(r,C=>{try{const V=C.docs.map(G=>({id:G.id,...G.data()}));g(V),f(!1)}catch(V){console.error("Error processing users snapshot:",V),m("Failed to process users data"),f(!1)}},C=>{console.error("Error fetching users:",C),C.code==="permission-denied"?m("Permission denied. Check Firestore rules."):m("Failed to load users: "+(C.message||"Unknown error")),f(!1)});return()=>A()},[]),(0,s.useEffect)(()=>{if(t.current&&(t.current(),t.current=null),d.current&&(d.current(),d.current=null),!x){U([]),R([]);return}y(!0),I(null);const r=K(_(L,"deposits"),Y("timestamp","desc"));t.current=q(r,C=>{try{const V=C.docs.map(G=>({id:G.id,...G.data()})).filter(G=>G.userId===x.uid);U(V),y(!1)}catch(V){console.error("Error processing deposits snapshot:",V),I("Failed to process deposits data"),y(!1)}},C=>{console.error("Error fetching deposits:",C),I("Failed to load deposits: "+(C.message||"Unknown error")),y(!1)}),S(!0),z(null);const A=K(_(L,"loans"),Y("timestamp","desc"));return d.current=q(A,C=>{try{const V=C.docs.map(G=>({id:G.id,...G.data()})).filter(G=>G.userId===x.uid);R(V),S(!1)}catch(V){console.error("Error processing loans snapshot:",V),z("Failed to process loans data"),S(!1)}},C=>{console.error("Error fetching loans:",C),z("Failed to load loans: "+(C.message||"Unknown error")),S(!1)}),()=>{t.current&&(t.current(),t.current=null),d.current&&(d.current(),d.current=null)}},[x]);const n=r=>{if(!r)return"N/A";if(r.seconds)return new Date(r.seconds*1e3).toLocaleString();if(r.toDate)return r.toDate().toLocaleString();try{return new Date(r).toLocaleString()}catch{return String(r)}},p=r=>{switch(r?.toLowerCase()){case"accepted":return"bg-green-100 text-green-800";case"denied":case"rejected":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},a=r=>{F(r),c(!0)},u=()=>{c(!1)},w=r=>{window.open(r,"_blank")},M=(r,A)=>{const C=document.createElement("a");C.href=r,C.download=A||"proof-image.jpg",document.body.appendChild(C),C.click(),document.body.removeChild(C)},$=j.reduce((r,A)=>r+(A.amount||0),0),B=T.reduce((r,A)=>r+(A.amount||0),0);j.filter(r=>r.status==="pending").length,j.filter(r=>r.status==="accepted").length,j.filter(r=>r.status==="denied"||r.status==="rejected").length,T.filter(r=>r.status==="pending").length,T.filter(r=>r.status==="accepted").length,T.filter(r=>r.status==="denied"||r.status==="rejected").length;const Q=i.filter(r=>{const A=v.trim().toLowerCase();return A?(r.fullName||"").toLowerCase().includes(A)||(r.email||"").toLowerCase().includes(A)||(r.phoneNumber||"").toLowerCase().includes(A)||(r.uid||"").toLowerCase().includes(A):!0});return E?(0,e.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading users..."})]})}):h?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",h]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6 md:col-span-1",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Users"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:i.length})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a4 4 0 00-4-4h-1M9 20H4v-2a4 4 0 014-4h1m0-4a4 4 0 100-8 4 4 0 000 8z"})})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6 md:col-span-3",children:(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"User Records"}),(0,e.jsx)("div",{className:"flex items-center w-full sm:w-64",children:(0,e.jsxs)("div",{className:"relative w-full",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ee,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search users...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:v,onChange:r=>N(r.target.value)})]})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gender"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Age"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:Q.length>0?Q.map(r=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150 cursor-pointer",onClick:()=>a(r),children:[(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[r.imageUrl?(0,e.jsx)("img",{src:r.imageUrl,alt:r.fullName||"avatar",className:"h-10 w-10 rounded-full object-cover",onError:A=>{A.target.style.display="none"}}):(0,e.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-medium text-gray-700",children:(r.fullName||"U").split(" ").map(A=>A[0]).slice(0,2).join("").toUpperCase()}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:r.fullName||"No name"}),(0,e.jsx)("div",{className:"text-xs text-gray-500",children:r.uid||""})]})]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.email||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.phoneNumber||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize",children:r.gender||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.age||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:n(r.createdAt)})]},r.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No users found."})})})]})})}),k&&x&&(0,e.jsx)("div",{className:"fixed inset-0 z-50 overflow-auto bg-black bg-opacity-50 flex items-center justify-center p-4",children:(0,e.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-auto",children:[(0,e.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center",children:[(0,e.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:["User Details: ",x.fullName]}),(0,e.jsx)("button",{onClick:u,className:"p-1 rounded-full hover:bg-gray-100 transition-colors",children:(0,e.jsx)(re,{className:"h-5 w-5 text-gray-500"})})]}),(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[x.imageUrl?(0,e.jsx)("img",{src:x.imageUrl,alt:x.fullName||"avatar",className:"h-16 w-16 rounded-full object-cover mr-4"}):(0,e.jsx)("div",{className:"h-16 w-16 rounded-full bg-gray-200 flex items-center justify-center text-xl font-medium text-gray-700 mr-4",children:(x.fullName||"U").split(" ").map(r=>r[0]).slice(0,2).join("").toUpperCase()}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:x.fullName||"No name"}),(0,e.jsxs)("p",{className:"text-sm text-gray-500",children:["ID: ",x.uid||"N/A"]})]})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Email"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:x.email||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Phone Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:x.phoneNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"MoMo Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:x.momoNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Credit card Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:x.creditCardNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Gender"}),(0,e.jsx)("p",{className:"text-sm text-gray-900 capitalize",children:x.gender||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Age"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:x.age||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Joined Date"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:n(x.createdAt)})]})]})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"p-2 rounded-full bg-green-100 mr-3",children:(0,e.jsx)(ae,{className:"h-6 w-6 text-green-600"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Deposits Summary"})]}),(0,e.jsx)("div",{className:"space-y-3",children:(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Amount:"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",$.toFixed(2)]})]})})]}),(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"p-2 rounded-full bg-blue-100 mr-3",children:(0,e.jsx)(os,{className:"h-6 w-6 text-blue-600"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Loans Summary"})]}),(0,e.jsx)("div",{className:"space-y-3",children:(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Amount:"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",B.toFixed(2)]})]})})]})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Deposits"}),o?(0,e.jsx)("div",{className:"flex justify-center py-4",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):P?(0,e.jsx)("div",{className:"bg-red-50 p-4 rounded-md",children:(0,e.jsx)("p",{className:"text-sm text-red-800",children:P})}):j.length>0?(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Message"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proof"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(r=>(0,e.jsxs)("tr",{children:[(0,e.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",r.amount||"0"]}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${p(r.status)}`,children:r.status||"Unknown"})}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:n(r.timestamp)}),(0,e.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",title:r.message,children:r.message||"N/A"}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:r.proofImage?(0,e.jsxs)("div",{className:"flex space-x-2",children:[(0,e.jsx)("button",{onClick:()=>w(r.proofImage),className:"text-indigo-600 hover:text-indigo-900",title:"View",children:(0,e.jsx)(pe,{className:"h-5 w-5"})}),(0,e.jsx)("button",{onClick:()=>M(r.proofImage,`deposit-proof-${r.id}.jpg`),className:"text-indigo-600 hover:text-indigo-900",title:"Download",children:(0,e.jsx)(ve,{className:"h-5 w-5"})})]}):"N/A"})]},r.id))})]})}):(0,e.jsx)("div",{className:"text-center py-4 text-sm text-gray-500",children:"No deposits found."})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Loans"}),b?(0,e.jsx)("div",{className:"flex justify-center py-4",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):O?(0,e.jsx)("div",{className:"bg-red-50 p-4 rounded-md",children:(0,e.jsx)("p",{className:"text-sm text-red-800",children:O})}):T.length>0?(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Approved By"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:T.map(r=>(0,e.jsxs)("tr",{children:[(0,e.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",r.amount||"0"]}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${p(r.status)}`,children:r.status||"Unknown"})}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:n(r.timestamp)}),(0,e.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",title:r.reason,children:r.reason||"N/A"}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:r.approvedBy||"N/A"})]},r.id))})]})}):(0,e.jsx)("div",{className:"text-center py-4 text-sm text-gray-500",children:"No loans found."})]})]})]})})]})},Us=Ls,Ps=()=>{const[i,g]=(0,s.useState)("10.00"),[E,f]=(0,s.useState)(!0),[h,m]=(0,s.useState)(!1),[v,N]=(0,s.useState)(null),[k,c]=(0,s.useState)("success"),[x,F]=(0,s.useState)([]),[j,U]=(0,s.useState)(!1),[T,R]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{try{const b=K(_(L,"interest"),Y("timestamp","desc"),He(10)),S=await Me(b);if(S.empty)g("10.00");else{const P=S.docs[0];g(P.data().interest.toFixed(2)),R(P.id);const I=S.docs.map(O=>({date:new Date(O.data().timestamp?.toDate()||Date.now()).toLocaleDateString(),rate:parseFloat(O.data().interest)})).reverse();F(I)}}catch(b){console.error("Error fetching interest:",b),N("Failed to load interest rate"),c("error"),setTimeout(()=>N(null),3e3)}finally{f(!1)}})()},[]);const o=async()=>{if(isNaN(i)||i<1||i>100){N("Please enter a valid interest rate between 1% and 100%"),c("error"),setTimeout(()=>N(null),3e3);return}m(!0);try{const y=new Date;if(T){const b=W(L,"interest",T);await X(b,{interest:Number(i),timestamp:y})}else await Oe(W(L,"interest","globalRate"),{interest:Number(i),timestamp:y}),R("globalRate");N("Interest rate updated successfully!"),c("success"),F(b=>[...b.slice(-9),{date:y.toLocaleDateString(),rate:Number(i)}])}catch(y){console.error("Error updating interest:",y),N("Failed to update interest rate"),c("error")}finally{m(!1),setTimeout(()=>N(null),3e3)}};return E?(0,e.jsx)("div",{className:"flex justify-center items-center min-h-screen px-4",children:(0,e.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-10 w-full max-w-md text-center",children:[(0,e.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-300",children:"Loading interest rate..."})]})}):(0,e.jsxs)("div",{className:"flex justify-center items-center min-h-screen px-4 bg-gray-50 dark:bg-gray-900",children:[(0,e.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-6 md:p-10 w-full max-w-md",children:[(0,e.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100 mb-6 text-center",children:"Interest Rate Settings"}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{className:"block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2",children:"Current Interest Rate (%)"}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("input",{type:"number",step:"0.01",min:"1",max:"100",value:i,onChange:y=>g(y.target.value),className:"border border-gray-300 dark:border-gray-700 rounded-lg p-3 w-full focus:ring-2 focus:ring-blue-500 outline-none pr-12",disabled:h,placeholder:"Enter interest rate (1â€“100)"}),(0,e.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"%"})]}),(0,e.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Enter as a percentage (e.g., 5 for 5%)"})]}),(0,e.jsx)("button",{onClick:o,disabled:h,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 w-full disabled:opacity-50 flex items-center justify-center text-sm sm:text-base",children:h?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Saving..."]}):"Save Changes"}),(0,e.jsx)("div",{className:"mt-6 text-center",children:(0,e.jsxs)("button",{onClick:()=>U(!j),className:"text-blue-600 dark:text-blue-400 text-sm font-medium hover:underline",children:[j?"Hide":"Show"," Rate History"]})}),j&&x.length>0&&(0,e.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[(0,e.jsx)("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-4",children:"Interest Rate History"}),(0,e.jsx)("div",{className:"h-48",children:(0,e.jsx)(oe,{width:"100%",height:"100%",children:(0,e.jsxs)(be,{data:x,children:[(0,e.jsx)(de,{strokeDasharray:"3 3",stroke:"#e0e0e0"}),(0,e.jsx)(le,{dataKey:"date",tick:{fontSize:12}}),(0,e.jsx)(ce,{tick:{fontSize:12},domain:["dataMin - 0.5","dataMax + 0.5"]}),(0,e.jsx)(ie,{formatter:y=>`${y.toFixed(2)}%`,contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.9)",border:"1px solid #ccc",borderRadius:"4px"}}),(0,e.jsx)(ne,{type:"monotone",dataKey:"rate",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},activeDot:{r:6}})]})})})]})]}),v&&(0,e.jsx)("div",{className:`fixed top-5 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg text-white font-semibold shadow-md transition-all duration-300 ${k==="success"?"bg-green-500":"bg-red-500"}`,children:v})]})},Fs=Ps,Ts=({onAccessGranted:i})=>{const[g,E]=(0,s.useState)(""),[f,h]=(0,s.useState)(""),[m,v]=(0,s.useState)(""),[N,k]=(0,s.useState)(!1),[c,x]=(0,s.useState)(""),[F,j]=(0,s.useState)(!1),[U,T]=(0,s.useState)(!1),[R,o]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(f){T(!0);const S=setTimeout(()=>{T(!1),h("")},3e3);return()=>clearTimeout(S)}},[f]),(0,s.useEffect)(()=>{if(m){o(!0);const S=setTimeout(()=>{o(!1),v("")},3e3);return()=>clearTimeout(S)}},[m]);const y=async S=>{S.preventDefault(),j(!0);try{const P=W(L,"adminSettings","security"),I=await Be(P);if(I.exists()){const{password:O}=I.data();g===O?i():h("Incorrect password. Please try again.")}else h("Admin settings not found. Please contact support.")}catch(P){console.error("Error fetching admin password:",P),h("Failed to verify password. Please try again.")}finally{j(!1)}},b=async S=>{S.preventDefault(),j(!0);try{await Ie(se,c),v("Password reset email sent! Check your inbox."),setTimeout(()=>{k(!1),x("")},3e3)}catch(P){console.error("Error sending password reset email:",P),h("Failed to send reset email. Please try again.")}finally{j(!1)}};return(0,e.jsxs)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:[(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96",children:[(0,e.jsx)("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-800",children:"Admin Access"}),(0,e.jsxs)("form",{onSubmit:y,children:[(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",value:g,onChange:S=>E(S.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 w-full",required:!0})]}),(0,e.jsx)("button",{type:"submit",disabled:F,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-full mt-4 transition disabled:opacity-50",children:F?"Verifying...":"Access Admin Dashboard"})]}),f&&(0,e.jsx)("div",{className:`text-red-500 mt-2 transition-opacity duration-500 ${U?"opacity-100":"opacity-0"}`,children:f}),m&&(0,e.jsx)("div",{className:`text-green-500 mt-2 transition-opacity duration-500 ${R?"opacity-100":"opacity-0"}`,children:m}),(0,e.jsx)("div",{className:"text-blue-600 text-sm mt-3 hover:underline cursor-pointer",onClick:()=>k(!0),children:"Forgot password?"})]}),N&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96",children:[(0,e.jsx)("h2",{className:"text-xl font-bold text-center mb-4 text-gray-800",children:"Reset Password"}),(0,e.jsx)("p",{className:"text-gray-600 text-sm mb-4",children:"Enter your admin email to receive a password reset link."}),(0,e.jsxs)("form",{onSubmit:b,children:[(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"resetEmail",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,e.jsx)("input",{type:"email",id:"resetEmail",value:c,onChange:S=>x(S.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 w-full",required:!0})]}),(0,e.jsxs)("div",{className:"flex space-x-3",children:[(0,e.jsx)("button",{type:"button",onClick:()=>k(!1),className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md w-1/2 transition",children:"Cancel"}),(0,e.jsx)("button",{type:"submit",disabled:F,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-1/2 transition disabled:opacity-50",children:F?"Sending...":"Send Reset Link"})]})]}),f&&(0,e.jsx)("div",{className:`text-red-500 mt-2 transition-opacity duration-500 ${U?"opacity-100":"opacity-0"}`,children:f}),m&&(0,e.jsx)("div",{className:`text-green-500 mt-2 transition-opacity duration-500 ${R?"opacity-100":"opacity-0"}`,children:m})]})})]})},Rs=Ts;function Is({children:i}){const{currentUser:g}=J();return g?i:(0,e.jsx)(we,{to:"/login"})}function Ne({children:i}){const{currentUser:g}=J();return g?(0,e.jsx)(we,{to:"/dashboard"}):i}function Ms(){const[i,g]=(0,s.useState)(!1);return i?(0,e.jsxs)(Fe,{children:[(0,e.jsx)(H,{path:"/login",element:(0,e.jsx)(Ne,{children:(0,e.jsx)(hs,{})})}),(0,e.jsx)(H,{path:"/signup",element:(0,e.jsx)(Ne,{children:(0,e.jsx)(gs,{})})}),(0,e.jsxs)(H,{path:"/",element:(0,e.jsx)(Is,{children:(0,e.jsx)(ks,{})}),children:[(0,e.jsx)(H,{index:!0,element:(0,e.jsx)(ye,{})}),(0,e.jsx)(H,{path:"profile",element:(0,e.jsx)(fs,{})}),(0,e.jsx)(H,{path:"dashboard",element:(0,e.jsx)(ye,{})}),(0,e.jsx)(H,{path:"deposits",element:(0,e.jsx)(ws,{})}),(0,e.jsx)(H,{path:"loans",element:(0,e.jsx)(Es,{})}),(0,e.jsx)(H,{path:"payback",element:(0,e.jsx)(Ns,{})}),(0,e.jsx)(H,{path:"users",element:(0,e.jsx)(Us,{})}),(0,e.jsx)(H,{path:"settings",element:(0,e.jsx)(Fs,{})}),(0,e.jsx)(H,{path:"chat",element:(0,e.jsx)(Ds,{})})]})]}):(0,e.jsx)(Rs,{onAccessGranted:()=>g(!0)})}var $s=Ms;(0,xs.createRoot)(document.getElementById("root")).render((0,e.jsx)(s.StrictMode,{children:(0,e.jsx)(us,{children:(0,e.jsx)(Re,{children:(0,e.jsx)($s,{})})})}));
