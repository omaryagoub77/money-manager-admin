import{r as ue}from"./rolldown-runtime-CjiBMUN4.js";import{a as ne,c as ie,d as Pe,i as le,l as oe,n as we,o as de,r as ce,s as fe,t as Ue}from"./charting-mCjb7GWK.js";import{t as Fe}from"./react-dom-COd6vK1M.js";import{a as H,c as he,i as Te,n as ge,o as Re,r as ve,s as Ie,t as Me}from"./react-router-CShHLuBK.js";import{_ as $e,a as Oe,c as V,d as Z,f as Se,g as _e,h as ze,i as je,l as Q,m as Be,n as B,o as qe,p as Y,r as q,s as Ve,t as Ge,u as K,v as He,y as Ke}from"./firebase-DQPaLeaR.js";import{t as We}from"./react-xg8gCaOR.js";import{C as Ye,D as Qe,E as Xe,O as Je,S as Ze,T as es,_ as ae,a as ss,b as se,c as ts,d as as,f as rs,g as De,h as pe,i as ns,l as is,m as ls,n as os,o as ee,p as ke,r as Ae,s as ds,t as re,u as ye,v as me,w as cs,x as xe,y as Ce}from"./lucide-icons-DuvOX9XH.js";import{n as ms,t as xs}from"./vendor-BR9iRDep.js";(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))S(f);new MutationObserver(f=>{for(const h of f)if(h.type==="childList")for(const w of h.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&S(w)}).observe(document,{childList:!0,subtree:!0});function U(f){const h={};return f.integrity&&(h.integrity=f.integrity),f.referrerPolicy&&(h.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?h.credentials="include":f.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function S(f){if(f.ep)return;f.ep=!0;const h=U(f);fetch(f.href,h)}})();var us=ue(Fe()),s=ue(Pe()),Ee=Ke({apiKey:"AIzaSyAGm3bzsCxYSARcgVn41ta_EOut9fauWr0",authDomain:"ecommerce-74229.firebaseapp.com",projectId:"ecommerce-74229",storageBucket:"ecommerce-74229.firebasestorage.app",messagingSenderId:"47160479095",appId:"1:47160479095:web:0dd3a844d5d5c3847ea572",measurementId:"G-47FYXTR59Z"}),te=ze(Ee),k=qe(Ee),e=ue(We()),Le=(0,s.createContext)();const J=()=>(0,s.useContext)(Le),hs=({children:i})=>{const[g,U]=(0,s.useState)(null),[S,f]=(0,s.useState)(!0),h=(x,u)=>Be(te,x,u),w=(x,u)=>$e(te,x,u),b=()=>He(te);(0,s.useEffect)(()=>_e(te,x=>{U(x),f(!1)}),[]);const L={currentUser:g,signup:h,login:w,logout:b};return(0,e.jsx)(Le.Provider,{value:L,children:S?(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):i})};function gs(){const i=(0,s.useRef)(),g=(0,s.useRef)(),{login:U}=J(),S=he(),[f,h]=(0,s.useState)(""),[w,b]=(0,s.useState)(!1),L=async x=>{x.preventDefault();try{h(""),b(!0),await U(i.current.value,g.current.value),S("/dashboard")}catch{h("Failed to sign in. Please check your credentials and try again.")}b(!1)};return(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-400 to-gray-100 p-4",children:(0,e.jsx)("div",{className:"w-full max-w-md",children:(0,e.jsxs)("form",{onSubmit:L,className:"bg-white p-8 rounded-2xl shadow-lg border border-gray-100",children:[(0,e.jsxs)("div",{className:"text-center mb-8",children:[(0,e.jsx)("div",{className:"mx-auto w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mb-4",children:(0,e.jsx)("span",{className:"text-white font-bold text-xl",children:"MB"})}),(0,e.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Welcome Back"}),(0,e.jsx)("p",{className:"text-gray-600 mt-2",children:"Sign in to your account"})]}),f&&(0,e.jsx)("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg mb-6 text-sm",children:f}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,e.jsx)("input",{type:"email",id:"email",ref:i,placeholder:"Enter your email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",ref:g,placeholder:"Enter your password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsx)("button",{disabled:w,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-lg transition-colors duration-200 disabled:opacity-50",children:w?"Signing In...":"Sign In"}),(0,e.jsxs)("p",{className:"mt-6 text-center text-gray-600",children:["Don't have an account?"," ",(0,e.jsx)(ge,{to:"/signup",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"Sign Up"})]})]})})})}function ps(){const i=(0,s.useRef)(),g=(0,s.useRef)(),U=(0,s.useRef)(),{signup:S}=J(),f=he(),[h,w]=(0,s.useState)(""),[b,L]=(0,s.useState)(!1),x=async u=>{if(u.preventDefault(),g.current.value!==U.current.value)return w("Passwords do not match");if(g.current.value.length<6)return w("Password should be at least 6 characters");try{w(""),L(!0),await S(i.current.value,g.current.value),f("/dashboard")}catch{w("Failed to create an account. Please try again.")}L(!1)};return(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-400 to-gray-100 p-4",children:(0,e.jsx)("div",{className:"w-full max-w-md",children:(0,e.jsxs)("form",{onSubmit:x,className:"bg-white p-8 rounded-2xl shadow-lg border border-gray-100",children:[(0,e.jsxs)("div",{className:"text-center mb-8",children:[(0,e.jsx)("div",{className:"mx-auto w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mb-4",children:(0,e.jsx)("span",{className:"text-white font-bold text-xl",children:"MB"})}),(0,e.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Create Account"}),(0,e.jsx)("p",{className:"text-gray-600 mt-2",children:"Sign up to get started"})]}),h&&(0,e.jsx)("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg mb-6 text-sm",children:h}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,e.jsx)("input",{type:"email",id:"email",ref:i,placeholder:"Enter your email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",ref:g,placeholder:"Create a password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),(0,e.jsx)("input",{type:"password",id:"confirmPassword",ref:U,placeholder:"Confirm your password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsx)("button",{disabled:b,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-lg transition-colors duration-200 disabled:opacity-50",children:b?"Creating Account...":"Sign Up"}),(0,e.jsxs)("p",{className:"mt-6 text-center text-gray-600",children:["Already have an account?"," ",(0,e.jsx)(ge,{to:"/login",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"Sign In"})]})]})})})}var fs=()=>(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{children:[(0,e.jsx)("h1",{children:"Create your porfile"}),(0,e.jsxs)("form",{action:"",children:[(0,e.jsx)("input",{type:"text",placeholder:"Your full name "}),(0,e.jsx)("input",{type:"email",placeholder:"Your email",name:"",id:""}),(0,e.jsx)("input",{type:"number",placeholder:"You phone number ",name:"",id:""}),(0,e.jsx)("input",{type:"number",placeholder:"You Age  ",name:"",id:""}),(0,e.jsxs)("option",{value:"",children:[(0,e.jsx)("select",{name:"male",id:"",children:"Male"}),(0,e.jsx)("select",{name:"female",id:"",children:"Female"})]}),(0,e.jsx)("input",{type:"file",placeholder:"Upload your photo"}),(0,e.jsx)("button",{type:"submit",children:"Create account"})]})]})}),js=fs,ys=()=>{const[i,g]=(0,s.useState)(0),[U,S]=(0,s.useState)(0),[f,h]=(0,s.useState)(0),[w,b]=(0,s.useState)(0),[L,x]=(0,s.useState)(!1),[u,I]=(0,s.useState)(!1),[N,A]=(0,s.useState)(!1),[C,F]=(0,s.useState)([]),[c,p]=(0,s.useState)([]),[j,P]=(0,s.useState)([]),[T,$]=(0,s.useState)(!0),O=n=>new Date(n).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",hour12:!0});(0,s.useEffect)(()=>{if(!k){A("Firestore instance not available"),$(!1);return}const n=K(B(k,"users"),Q("createdAt","desc")),o=V(n,t=>{try{const d=t.docs.map(y=>({id:y.id,...y.data()}));P(d),b(d.length),$(!1),A(!1)}catch(d){console.error("Error processing users snapshot:",d),A("Failed to process users data"),$(!1)}},t=>{console.error("Error fetching users:",t),t.code==="permission-denied"?A("Permission denied. Check Firestore rules."):A("Failed to load users: "+(t.message||"Unknown error")),$(!1)});return()=>o()},[]);const _=({active:n,payload:o,label:t})=>{if(n&&o&&o.length){const d=o[0].payload;return(0,e.jsxs)("div",{className:"bg-white p-4 border border-gray-200 shadow-lg rounded-md",children:[(0,e.jsx)("p",{className:"font-medium text-gray-900",children:O(d.timestamp)}),(0,e.jsxs)("p",{className:"text-indigo-600",children:["Deposits: $",d.deposits.toFixed(2)]}),(0,e.jsxs)("p",{className:"text-red-600",children:["loans: $",d.loans.toFixed(2)]})]})}return null},l=(n,o,t=20)=>{const d=[];return n.forEach(y=>{const R=y.timestamp?.toDate?.()||new Date(y.timestamp);d.push({timestamp:R,name:R.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),deposits:Number(y.amount)||0,loans:0})}),o.forEach(y=>{const R=y.timestamp?.toDate?.()||new Date(y.timestamp);d.push({timestamp:R,name:R.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),deposits:0,loans:Number(y.amount)||0})}),d.sort((y,R)=>y.timestamp-R.timestamp),d.slice(-t)};(0,s.useEffect)(()=>{if(!k){console.error("Firestore database instance not available"),x(!0),I(!0);return}let n=[],o=[];const t=K(B(k,"deposits"),Q("timestamp","desc")),d=V(t,M=>{try{let z=0;n=[],M.forEach(r=>{const D=r.data();D.amount&&(z+=parseFloat(D.amount)),n.push({id:r.id,...D,timestamp:D.timestamp})}),g(z),x(!1);const X=l(n,o);F(X),p(r=>[...n.slice(0,3).map(D=>({id:D.id,type:"deposit",userId:D.userId,amount:D.amount,timestamp:D.timestamp?.toDate?.()||new Date})),...r].slice(0,6))}catch(z){console.error("Error processing deposits data:",z),x(!0)}},M=>{console.error("Error fetching deposits:",M),x(!0)}),y=K(B(k,"loans"),Q("timestamp","desc")),R=V(y,M=>{try{let z=0,X=0;o=[],M.forEach(D=>{const E=D.data();E.amount&&(z+=parseFloat(E.amount)),E.status==="pending"&&(X+=1),o.push({id:D.id,...E,timestamp:E.timestamp})}),S(z),h(X),I(!1);const r=l(n,o);F(r),p(D=>[...o.slice(0,3).map(E=>({id:E.id,type:"cashout",userId:E.userId,amount:E.amount,status:E.status,timestamp:E.timestamp?.toDate?.()||new Date})),...D].slice(0,6))}catch(z){console.error("Error processing loans data:",z),I(!0)}},M=>{console.error("Error fetching loans:",M),I(!0)});return()=>{d(),R()}},[]);const v=n=>`$${n.toFixed(2)}`,a=n=>new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),m=[{id:1,name:"Total Deposits",value:L?"N/A":v(i),change:"+12.5%",changeType:"positive",icon:ae,iconColor:"bg-indigo-500"},{id:2,name:"Total loans",value:u?"N/A":v(U),change:"+8.2%",changeType:"positive",icon:me,iconColor:"bg-red-500"},{id:3,name:"Pending loans",value:u?"N/A":f,change:"+3.1%",changeType:"negative",icon:Je,iconColor:"bg-yellow-500"},{id:4,name:"Total Users",value:N?"N/A":w,change:"+5.4%",changeType:"positive",icon:Ae,iconColor:"bg-green-500"}];return T?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading dashboard..."})]})}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6",children:m.map(n=>(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 transition-all duration-200 hover:shadow-md",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:n.name}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:n.value})]}),(0,e.jsx)("div",{className:`p-3 rounded-full ${n.iconColor}`,children:(0,e.jsx)(n.icon,{className:"h-6 w-6 text-white"})})]}),(0,e.jsxs)("div",{className:"mt-4 flex items-center",children:[n.changeType==="positive"?(0,e.jsx)(Xe,{className:"h-4 w-4 text-green-500"}):(0,e.jsx)(Qe,{className:"h-4 w-4 text-red-500"}),(0,e.jsx)("span",{className:`ml-1 text-sm font-medium ${n.changeType==="positive"?"text-green-500":"text-red-500"}`,children:n.change}),(0,e.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:"from last month"})]})]},n.id))}),(0,e.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Live Transactions"}),(0,e.jsx)("div",{className:"h-80 overflow-x-hidden",children:(0,e.jsx)(oe,{width:"100%",height:"100%",children:(0,e.jsxs)(Ue,{data:C,margin:{top:5,right:30,left:20,bottom:5},children:[(0,e.jsx)(de,{strokeDasharray:"3 3"}),(0,e.jsx)(le,{dataKey:"name",tick:{fontSize:10},interval:0,minTickGap:15}),(0,e.jsx)(ce,{}),(0,e.jsx)(ie,{content:(0,e.jsx)(_,{})}),(0,e.jsx)(fe,{dataKey:"deposits",fill:"#4f46e5",name:"Deposits",isAnimationActive:!0,animationDuration:800,animationEasing:"ease-in-out"}),(0,e.jsx)(fe,{dataKey:"loans",fill:"#ef4444",name:"loans",isAnimationActive:!0,animationDuration:800,animationEasing:"ease-in-out"})]})})})]}),(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Transaction Trend"}),(0,e.jsx)("div",{className:"h-80 overflow-x-hidden",children:(0,e.jsx)(oe,{width:"100%",height:"100%",children:(0,e.jsxs)(we,{data:C,margin:{top:5,right:30,left:20,bottom:5},children:[(0,e.jsx)(de,{strokeDasharray:"3 3"}),(0,e.jsx)(le,{dataKey:"name",tick:{fontSize:10},interval:0,minTickGap:15}),(0,e.jsx)(ce,{}),(0,e.jsx)(ie,{content:(0,e.jsx)(_,{})}),(0,e.jsx)(ne,{type:"monotone",dataKey:"deposits",stroke:"#4f46e5",activeDot:{r:8},name:"Deposits",isAnimationActive:!0,animationDuration:800,animationEasing:"ease-in-out"}),(0,e.jsx)(ne,{type:"monotone",dataKey:"loans",stroke:"#ef4444",name:"loans",isAnimationActive:!0,animationDuration:800,animationEasing:"ease-in-out"})]})})})]})]}),(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Recent Activity"}),(0,e.jsx)("button",{className:"text-sm font-medium text-indigo-600 hover:text-indigo-800",children:"View all"})]}),(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User ID"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:c.length>0?c.map(n=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[n.type==="deposit"?(0,e.jsx)("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center",children:(0,e.jsx)(ae,{className:"h-4 w-4 text-indigo-600"})}):(0,e.jsx)("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:(0,e.jsx)(me,{className:"h-4 w-4 text-red-600"})}),(0,e.jsx)("span",{className:"ml-3 text-sm font-medium text-gray-900 capitalize",children:n.type})]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:n.userId||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:v(n.amount||0)}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:n.type==="deposit"?(0,e.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"Completed"}):(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${n.status==="Pending"?"bg-yellow-100 text-yellow-800":n.status==="Accepted"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:n.status||"Pending"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a(n.timestamp)})]},n.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"5",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No recent activity"})})})]})})]})]})},be=ys,bs=()=>{const{currentUser:i}=J(),[g,U]=(0,s.useState)([]),[S,f]=(0,s.useState)([]),[h,w]=(0,s.useState)(!0),[b,L]=(0,s.useState)(null),[x,u]=(0,s.useState)(""),[I,N]=(0,s.useState)(null),[A,C]=(0,s.useState)(!1),[F,c]=(0,s.useState)(new Set);(0,s.useEffect)(()=>{if(!i)return;const a=V(B(k,"users"),m=>{const n=[];m.forEach(o=>{n.push({id:o.id,...o.data()})}),f(n)},m=>{console.error("Error fetching users:",m)});return()=>a()},[i]),(0,s.useEffect)(()=>{if(!i)return;const a=V(B(k,"loans"),m=>{const n=[];m.forEach(o=>{n.push({id:o.id,...o.data()})}),n.sort((o,t)=>{const d=o.paymentTimestamp?.toDate?.()||new Date(0);return(t.paymentTimestamp?.toDate?.()||new Date(0))-d}),U(n),w(!1)},m=>{console.error("Error fetching paybacks:",m),w(!1)});return()=>a()},[i]);const p=g.map(a=>{const m=S.find(n=>n.uid===a.userId);return{...a,userName:m?.fullName||"Unknown User",userEmail:m?.email||"No email provided"}}),j=(a,m)=>{L({message:a,type:m}),setTimeout(()=>{L(null)},3e3)},P=async a=>{try{c(m=>new Set(m).add(a)),setTimeout(async()=>{const m=q(k,"loans",a);await Y(m,{paymentStatus:"approved",adminReviewedAt:Z()}),setTimeout(()=>{c(n=>{const o=new Set(n);return o.delete(a),o})},300),j("Payment approved successfully!","success")},100)}catch(m){console.error("Error approving payment:",m),j("Failed to approve payment. Please try again.","error"),c(n=>{const o=new Set(n);return o.delete(a),o})}},T=async a=>{try{c(m=>new Set(m).add(a)),setTimeout(async()=>{const m=q(k,"loans",a);await Y(m,{paymentStatus:"denied",adminReviewedAt:Z()}),setTimeout(()=>{c(n=>{const o=new Set(n);return o.delete(a),o})},300),j("Payment denied.","error")},100)}catch(m){console.error("Error denying payment:",m),j("Failed to deny payment. Please try again.","error"),c(n=>{const o=new Set(n);return o.delete(a),o})}},$=a=>{N(a),C(!0)},O=()=>{C(!1),N(null)},_=a=>{if(!a)return"N/A";const m=a.toDate(),n=m.getDate().toString().padStart(2,"0"),o=(m.getMonth()+1).toString().padStart(2,"0"),t=m.getFullYear(),d=m.getHours().toString().padStart(2,"0"),y=m.getMinutes().toString().padStart(2,"0");return`${n}/${o}/${t} ${d}:${y}`},l=p.filter(a=>{if(a.status!=="accepted")return!1;const m=a.userName||"",n=x.toLowerCase();return m.toLowerCase().includes(n)}),v=p.filter(a=>a.status==="accepted"&&a.paymentStatus==="pending").length;return(0,e.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8",children:[b&&(0,e.jsx)("div",{className:`fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg transform transition-all duration-300 ${b.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:b.message}),(0,e.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,e.jsxs)("div",{className:"mb-8",children:[(0,e.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Loan Repayment Management"}),(0,e.jsx)("p",{className:"mt-2 text-gray-600",children:"Review and manage loan repayments for accepted loans"})]}),(0,e.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6",children:(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ee,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by user name...",value:x,onChange:a=>u(a.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]})}),(0,e.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,e.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Accepted Loan Repayments"}),(0,e.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:[v," pending"]})]}),h?(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"}),(0,e.jsx)("p",{className:"text-gray-600",children:"Loading loan repayments..."})]}):l.length===0?(0,e.jsxs)("div",{className:"text-center py-12",children:[(0,e.jsx)("div",{className:"mx-auto h-16 w-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:(0,e.jsx)(ee,{className:"h-8 w-8 text-gray-400"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No accepted loans found"}),(0,e.jsx)("p",{className:"text-gray-500",children:"There are no accepted loans at the moment."})]}):(0,e.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(a=>{const m=F.has(a.id),n=!a.paymentStatus||a.paymentStatus==="pending";return(0,e.jsx)("div",{className:`bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden transition-all duration-300 hover:shadow-md ${m?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-indigo-800 font-medium",children:a.userName?.charAt(0)?.toUpperCase()||"U"})}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:a.userName||"Unknown User"}),(0,e.jsx)("p",{className:"text-sm text-gray-500",children:a.userEmail||"No email provided"})]})]}),(0,e.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                            ${a.paymentStatus==="approved"?"bg-green-100 text-green-800":a.paymentStatus==="denied"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:a.paymentStatus?.charAt(0)?.toUpperCase()+a.paymentStatus?.slice(1)||"Pending"})]}),(0,e.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Loan Amount"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",a.amount]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Interest (10%)"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",(a.amount*.1).toFixed(2)]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Payable"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",a.totalPayable?.toFixed(2)||(a.amount*1.1).toFixed(2)]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Paid Amount"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",a.paidAmount]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Payment Date"}),(0,e.jsx)("span",{className:"text-sm font-medium text-gray-900",children:_(a.paymentTimestamp)})]}),a.adminReviewedAt&&(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Reviewed At"}),(0,e.jsx)("span",{className:"text-sm font-medium text-gray-900",children:_(a.adminReviewedAt)})]})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("span",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proof of Payment"}),a.proofImageUrl?(0,e.jsxs)("div",{className:"relative w-full h-32 rounded-lg overflow-hidden cursor-pointer border border-gray-200",onClick:()=>$(a.proofImageUrl),children:[(0,e.jsx)("img",{src:a.proofImageUrl,alt:"Proof of payment",className:"w-full h-full object-cover"}),(0,e.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:(0,e.jsx)(pe,{className:"h-6 w-6 text-white"})})]}):(0,e.jsx)("div",{className:"w-full h-32 rounded-lg bg-gray-100 flex items-center justify-center border border-gray-200",children:(0,e.jsx)("span",{className:"text-gray-500 text-sm",children:"No proof provided"})})]}),(0,e.jsxs)("div",{className:"flex space-x-3",children:[(0,e.jsxs)("button",{className:`flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg transition-colors ${n?"text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500":"text-gray-400 bg-gray-100 cursor-not-allowed"}`,onClick:()=>P(a.id),disabled:!n,children:[(0,e.jsx)(Ze,{className:"-ml-1 mr-2 h-4 w-4"}),"Approve"]}),(0,e.jsxs)("button",{className:`flex-1 inline-flex items-center justify-center px-4 py-2 border text-sm font-medium rounded-lg transition-colors ${n?"text-gray-700 bg-white border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500":"text-gray-400 bg-gray-100 border-gray-200 cursor-not-allowed"}`,onClick:()=>T(a.id),disabled:!n,children:[(0,e.jsx)(re,{className:"-ml-1 mr-2 h-4 w-4"}),"Deny"]})]})]})},a.id)})})]})]}),A&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:O,children:(0,e.jsxs)("div",{className:"relative max-w-4xl max-h-full",onClick:a=>a.stopPropagation(),children:[(0,e.jsx)("button",{className:"absolute -top-12 right-0 text-white hover:text-gray-300 focus:outline-none",onClick:O,children:(0,e.jsx)(re,{className:"h-8 w-8"})}),(0,e.jsx)("img",{src:I,alt:"Proof of payment",className:"max-w-full max-h-screen rounded-lg"})]})})]})},Ns=bs,ws=()=>{const[i,g]=(0,s.useState)([]),[U,S]=(0,s.useState)([]),[f,h]=(0,s.useState)(!0),[w,b]=(0,s.useState)(null),[L,x]=(0,s.useState)(""),[u,I]=(0,s.useState)("All"),[N,A]=(0,s.useState)(null),[C,F]=(0,s.useState)(!1),[c,p]=(0,s.useState)({});(0,s.useEffect)(()=>{const t=K(B(k,"users")),d=V(t,y=>{const R=y.docs.map(M=>({id:M.id,...M.data()}));S(R)},y=>{console.error("Error loading users:",y),b("Failed to load users: "+y.message)});return()=>d()},[]),(0,s.useEffect)(()=>{const t=K(B(k,"deposits"),Q("timestamp","desc")),d=V(t,y=>{try{const R=y.docs.map(M=>({id:M.id,...M.data()})).map(M=>{const z=U.find(X=>X.uid===M.userId);return{...M,userName:z?z.fullName||"Unnamed User":"Unknown User"}});g(R),h(!1)}catch(R){console.error("Error merging deposit data:",R),b("Error processing deposit data: "+R.message),h(!1)}},y=>{console.error("Firestore error:",y),b("Failed to load deposits: "+y.message),h(!1)});return()=>d()},[U]);const j=t=>{switch(t){case"accepted":return"bg-green-100 text-green-800";case"denied":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},P=async(t,d)=>{try{const y=q(k,"deposits",t);await Y(y,{status:d}),console.log(`Deposit ${t} status updated to ${d}`)}catch(y){console.error("Error updating deposit status:",y),b("Failed to update deposit status: "+y.message)}},T=t=>{if(!t)return"N/A";if(t.seconds){const d=new Date(t.seconds*1e3);return d.toLocaleDateString()+" "+d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}if(t.toDate){const d=t.toDate();return d.toLocaleDateString()+" "+d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return t.toString()},$=i.reduce((t,d)=>t+(parseFloat(d.amount)||0),0),O=i.filter(t=>t.status==="pending").length,_=i.filter(t=>t.status==="accepted").length,l=i.filter(t=>t.status==="denied").length,v=i.filter(t=>t.status==="accepted").reduce((t,d)=>t+(parseFloat(d.amount)||0),0),a=i.filter(t=>t.status==="denied").reduce((t,d)=>t+(parseFloat(d.amount)||0),0),m=i.filter(t=>{const d=t.userName?.toLowerCase().includes(L.toLowerCase())||t.userId?.toLowerCase().includes(L.toLowerCase())||t.message?.toLowerCase().includes(L.toLowerCase()),y=u==="All"||t.status===u;return d&&y}),n=t=>{A(t),F(!0)},o=()=>{F(!1),A(null)};return f?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading deposits..."})]})}):w?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",w]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(console.log("DepositsPage: Rendering with deposits array length:",i.length),(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Deposits"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",$.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-indigo-100",children:(0,e.jsx)(ae,{className:"h-6 w-6 text-indigo-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Pending Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:O})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-yellow-100",children:(0,e.jsx)(Ce,{className:"h-6 w-6 text-yellow-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Approved Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:_})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(xe,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Denied Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:l})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(se,{className:"h-6 w-6 text-red-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Accepted Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",v.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(xe,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Declined Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",a.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(se,{className:"h-6 w-6 text-red-600"})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Deposit Records"}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ee,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by name, user ID or message...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:L,onChange:t=>x(t.target.value)})]}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsxs)("select",{className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg bg-gray-50",value:u,onChange:t=>I(t.target.value),children:[(0,e.jsx)("option",{value:"All",children:"All Statuses"}),(0,e.jsx)("option",{value:"pending",children:"Pending"}),(0,e.jsx)("option",{value:"accepted",children:"Accepted"}),(0,e.jsx)("option",{value:"denied",children:"Denied"})]}),(0,e.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,e.jsx)(ke,{className:"h-5 w-5 text-gray-400"})})]})]})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-scroll",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User Name"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proof"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:m.length>0?m.map(t=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:t.userName}),(0,e.jsxs)("div",{className:"text-xs text-gray-500 italic",children:["ID: ",t.userId]})]}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:["$",t.amount?parseFloat(t.amount).toFixed(2):"0.00"]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${j(t.status||"pending")}`,children:t.status||"pending"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:t.imageUrl?(0,e.jsxs)("button",{onClick:()=>n(t),className:"text-indigo-600 hover:text-indigo-900 flex items-center",children:[(0,e.jsx)(pe,{className:"h-4 w-4 mr-1"}),"View"]}):(0,e.jsx)("span",{className:"text-gray-400",children:"No proof"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:T(t.timestamp)}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,e.jsxs)("div",{className:"flex items-center space-x-3",children:[t.status==="pending"?(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("button",{disabled:!!c[t.id],onClick:async()=>{if(window.confirm("Mark this deposit as Accepted?")){p(d=>({...d,[t.id]:!0}));try{await P(t.id,"accepted"),console.log("Deposit accepted:",t.id)}finally{p(d=>{const y={...d};return delete y[t.id],y})}}},className:"px-3 py-1 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors duration-200 disabled:opacity-50",children:c[t.id]?"Processing...":"Approve"}),(0,e.jsx)("button",{disabled:!!c[t.id],onClick:async()=>{if(window.confirm("Mark this deposit as Denied?")){p(d=>({...d,[t.id]:!0}));try{await P(t.id,"denied"),console.log("Deposit denied:",t.id)}finally{p(d=>{const y={...d};return delete y[t.id],y})}}},className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors duration-200 disabled:opacity-50",children:c[t.id]?"Processing...":"Deny"})]}):(0,e.jsx)("span",{className:"text-sm text-gray-500",children:t.status||"No actions"}),t.imageUrl?(0,e.jsx)("button",{onClick:()=>window.open(t.imageUrl,"_blank"),className:"text-indigo-600 hover:text-indigo-900 flex items-center",title:"View proof in new tab",children:(0,e.jsx)(De,{className:"h-4 w-4"})}):null]})})]},t.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No deposits found."})})})]})})}),C&&N&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,e.jsxs)("div",{className:"bg-white  rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-scroll",children:[(0,e.jsxs)("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Deposit Proof"}),(0,e.jsx)("button",{onClick:o,className:"text-gray-400 hover:text-gray-500",children:(0,e.jsx)(se,{className:"h-6 w-6"})})]}),(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"User Name"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:N.userName||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"User ID"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:N.userId||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Amount"}),(0,e.jsxs)("p",{className:"text-sm text-gray-900",children:["$",N.amount?parseFloat(N.amount).toFixed(2):"0.00"]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Status"}),(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${j(N.status||"pending")}`,children:N.status||"pending"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Date"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:T(N.timestamp)})]}),(0,e.jsxs)("div",{className:"md:col-span-2",children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Message"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:N.message||"No message"})]})]}),(0,e.jsxs)("div",{className:"mt-6",children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Proof Image"}),(0,e.jsx)("div",{className:"border border-gray-200 rounded-lg ",children:N.imageUrl?(0,e.jsx)("img",{src:N.imageUrl,alt:"Deposit Proof",className:"w-full h-auto max-h-[60vh] object-contain",onError:t=>{t.target.style.display="none"}}):(0,e.jsx)("div",{className:"flex items-center justify-center h-64 bg-gray-100 text-gray-500",children:"No image available"})})]}),(0,e.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,e.jsx)("button",{onClick:o,className:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50",children:"Close"}),N.status==="pending"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("button",{onClick:()=>{P(N.id,"accepted"),o()},className:"px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-green-600 hover:bg-green-700",children:"Approve"}),(0,e.jsx)("button",{onClick:()=>{P(N.id,"denied"),o()},className:"px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-red-600 hover:bg-red-700",children:"Deny"})]})]})]})]})})]}))},vs=ws;function Ss(){const{currentUser:i}=J(),[g,U]=(0,s.useState)([]),[S,f]=(0,s.useState)(""),[h,w]=(0,s.useState)(!0),[b,L]=(0,s.useState)({}),[x,u]=(0,s.useState)({}),I=(0,s.useRef)(),N=(0,s.useRef)(),A=c=>{if(!c)return!1;const p=c.toDate?c.toDate():new Date(c);return(new Date-p)/(1e3*60)<2};(0,s.useEffect)(()=>{if(!i)return;(async()=>{try{const j=q(k,"users",i.uid);await Y(j,{isOnline:!0,lastActive:Z()})}catch(j){console.error("Error setting user online:",j)}})(),N.current=setInterval(async()=>{try{const j=q(k,"users",i.uid);await Y(j,{lastActive:Z()})}catch(j){console.error("Error updating lastActive:",j)}},3e4);const p=async()=>{try{const j=q(k,"users",i.uid);await Y(j,{isOnline:!1,lastActive:Z()})}catch(j){console.error("Error setting user offline:",j)}};return window.addEventListener("beforeunload",p),()=>{clearInterval(N.current),window.removeEventListener("beforeunload",p),i&&(async()=>{try{const P=q(k,"users",i.uid);await Y(P,{isOnline:!1,lastActive:Z()})}catch(P){console.error("Error setting user offline:",P)}})()}},[i]),(0,s.useEffect)(()=>{if(!i){w(!1);return}const c=K(B(k,"messages"),Q("timestamp","asc"));return V(c,p=>{U(p.docs.map(j=>({id:j.id,...j.data()}))),w(!1)})},[i]),(0,s.useEffect)(()=>{if(i)return V(B(k,"users"),c=>{const p={},j={};c.forEach(P=>{const T=P.data();p[P.id]=T,A(T.lastActive)&&(j[P.id]={displayName:T.displayName||T.email?.split("@")[0]||"Unknown",isOnline:T.isOnline||!1,lastActive:T.lastActive})}),u(p),L(j)})},[i]);const C=async c=>{if(c.preventDefault(),!(!i||!S.trim()))try{await Ge(B(k,"messages"),{text:S,userId:i.uid,userName:i.email?i.email.split("@")[0]:"Anonymous",timestamp:Z()}),f("")}catch(p){console.error("Error sending message:",p)}};(0,s.useEffect)(()=>{I.current?.scrollIntoView({behavior:"smooth"})},[g]);const F=c=>c?c.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";return i?(0,e.jsxs)("div",{className:"flex flex-col  h-screen bg-gradient-to-b from-gray-50 to-gray-100 font-sans text-gray-800 max-w-4xl mx-auto w-full",children:[(0,e.jsx)("div",{className:"mx-4 mb-2 bg-white/70 backdrop-blur-md rounded-xl shadow-sm p-3",children:(0,e.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,e.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,e.jsxs)("span",{className:"text-xs text-gray-600",children:[Object.keys(b).length," online"]}),(0,e.jsx)("br",{}),(0,e.jsxs)("p",{className:"text-sm text-gray-500",children:[g.length," Messages"]})]})}),(0,e.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 flex flex-col gap-4 max-w-full",children:[h?(0,e.jsx)("div",{className:"flex justify-center p-6",children:(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce"}),(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce",style:{animationDelay:"0.16s"}}),(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce",style:{animationDelay:"0.32s"}})]})}):g.length===0?(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center text-gray-500 p-10 bg-white rounded-2xl shadow-lg m-5",children:[(0,e.jsx)("div",{className:"text-4xl mb-3 opacity-70",children:"ðŸ’¬"}),(0,e.jsx)("div",{className:"text-sm text-center max-w-xs",children:"No messages yet. Start a conversation!"})]}):g.map(c=>(0,e.jsxs)("div",{className:`flex ${c.userId===i.uid?"justify-end":"justify-start"} animate-fade-in`,children:[c.userId!==i.uid&&(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center bg-white text-indigo-600 font-bold flex-shrink-0 shadow-sm mr-2",children:c.userName?c.userName.charAt(0).toUpperCase():"U"}),(0,e.jsx)("div",{className:`absolute bottom-[60px] right-7 w-3.5 h-3.5 rounded-full border-2 border-white ${b[c.userId]?"bg-green-500":"bg-gray-400"}`,title:b[c.userId]?"Online":"Offline"})]}),(0,e.jsxs)("div",{className:`max-w-[72%] p-3 rounded-2xl relative shadow-md transition-all duration-300 hover:shadow-lg ${c.userId===i.uid?"bg-gradient-to-br from-indigo-50 to-indigo-100 border border-indigo-100 rounded-br-md":"bg-white border border-gray-200 rounded-bl-md"}`,children:[(0,e.jsx)("div",{className:"text-sm text-gray-800 leading-relaxed",children:c.text}),(0,e.jsx)("div",{className:"text-xs text-gray-400 text-right mt-2",children:F(c.timestamp)})]}),c.userId===i.uid&&(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white font-bold flex-shrink-0 shadow-sm ml-2",children:c.userName?c.userName.charAt(0).toUpperCase():"U"}),(0,e.jsx)("div",{className:`absolute bottom-[60px] right-6 w-3.5 h-3.5 rounded-full border-2 border-white ${A(x[i?.uid]?.lastActive)?"bg-green-500":"bg-gray-400"}`,title:A(x[i?.uid]?.lastActive)?"Online":"Offline"})]})]},c.id)),(0,e.jsx)("div",{ref:I})]}),(0,e.jsxs)("form",{onSubmit:C,className:"flex items-center p-4 gap-3 sticky bottom-0 bg-white/70 backdrop-blur-md border-t border-gray-200",children:[(0,e.jsx)("div",{className:"flex-1 flex items-center bg-white p-2 pl-4 rounded-full shadow-md transition-all duration-300 focus-within:shadow-lg focus-within:border focus-within:border-indigo-500",children:(0,e.jsx)("input",{type:"text",className:"flex-1 border-0 outline-none p-2 bg-transparent text-sm text-gray-800",placeholder:"Type a message...",value:S,onChange:c=>f(c.target.value)})}),(0,e.jsx)("button",{type:"submit",className:"w-11 h-11 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white border-none cursor-pointer shadow-md transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",disabled:!S.trim(),children:(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4.5 h-4.5",children:(0,e.jsx)("path",{d:"M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"})})})]})]}):(0,e.jsx)("div",{className:"flex flex-col h-screen bg-gradient-to-b from-gray-50 to-gray-100 items-center justify-center font-sans text-gray-800",children:(0,e.jsxs)("div",{className:"text-center p-6 bg-white rounded-2xl shadow-lg max-w-md",children:[(0,e.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Please log in to use chat"}),(0,e.jsx)("p",{className:"text-gray-600",children:"You need to be logged in to send and receive messages."})]})})}var Ds=()=>(0,e.jsx)("div",{className:"",children:(0,e.jsx)("main",{children:(0,e.jsx)(Ss,{})})}),ks=Ds,As=()=>{const[i,g]=(0,s.useState)(!1),{currentUser:U}=J(),S=Ie(),f=he(),{logout:h}=J(),w=async()=>{try{await h(),f("/login")}catch(x){console.error("Failed to log out",x)}};(0,s.useEffect)(()=>{const x=()=>{window.innerWidth>=1024&&g(!1)};return window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[]),(0,s.useEffect)(()=>{const x=u=>{i&&!u.target.closest(".sidebar-content")&&!u.target.closest(".sidebar-toggle")&&g(!1)};return document.addEventListener("click",x),()=>document.removeEventListener("click",x)},[i]),(0,s.useEffect)(()=>{g(!1)},[S.pathname]);const b=[{name:"Dashboard",href:"/dashboard",icon:as},{name:"Deposits",href:"/deposits",icon:ds},{name:"loans",href:"/loans",icon:rs},{name:"Chat",href:"/chat",icon:ts},{name:"Users",href:"/users",icon:Ae},{name:"Payback",href:"/payback",icon:es},{name:"Settings",href:"/settings",icon:ss}],L=x=>S.pathname===x;return(0,e.jsxs)("div",{className:"flex h-screen w-screen max-w-full bg-gray-50",children:[(0,e.jsx)("div",{className:`fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform ${i?"translate-x-0":"-translate-x-full"} transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0 sidebar-content`,children:(0,e.jsxs)("div",{className:"flex flex-col h-full",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between h-16 px-6 border-b border-gray-200",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)("div",{className:"w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-white font-bold",children:"MB"})})}),(0,e.jsx)("div",{className:"ml-3",children:(0,e.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"MoneyBox"})})]}),(0,e.jsx)("button",{onClick:()=>g(!1),className:"lg:hidden text-gray-500 hover:text-gray-700",children:(0,e.jsx)(re,{size:20})})]}),(0,e.jsx)("nav",{className:"flex-1 px-4 py-6 overflow-y-auto",children:(0,e.jsx)("ul",{className:"space-y-1",children:b.map(x=>(0,e.jsx)("li",{children:(0,e.jsxs)(ge,{to:x.href,className:`flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-all duration-200 ${L(x.href)?"bg-indigo-50 text-indigo-700":"text-gray-700 hover:bg-gray-100"}`,children:[(0,e.jsx)(x.icon,{className:"mr-3 h-5 w-5"}),x.name]})},x.name))})}),(0,e.jsxs)("div",{className:"px-4 py-6 border-t border-gray-200",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:(0,e.jsx)("div",{className:"w-11 h-11 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white font-bold shadow-md",children:U?.email?.charAt(0).toUpperCase()||"U"})})}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Admin  is           ",U?.email?.slice(0,5).toUpperCase()||"U"]}),(0,e.jsx)("p",{className:"text-xs text-gray-500",children:U?.email?.slice(0,104).toLowerCase()||"U"})]})]}),(0,e.jsxs)("button",{onClick:w,className:"flex items-center w-full px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors duration-200",children:[(0,e.jsx)(ye,{className:"mr-3 h-5 w-5"}),"Logout"]})]})]})}),(0,e.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,e.jsx)("header",{className:"bg-white shadow-sm z-10",children:(0,e.jsxs)("div",{className:"flex items-center justify-between h-16 px-6",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("button",{onClick:()=>g(!0),className:"lg:hidden text-gray-500 hover:text-gray-700 mr-4 sidebar-toggle",children:(0,e.jsx)(is,{size:20})}),(0,e.jsxs)("h2",{className:"text-xl font-semibold text-gray-800",children:[S.pathname==="/dashboard"&&"ðŸ’° Dashboard",S.pathname==="/deposits"&&"ðŸ’° Deposits Overview",S.pathname==="/loans"&&"ðŸ’¸ loans Overview",S.pathname==="/users"&&"ðŸ‘¥ Users Overview",S.pathname==="/chat"&&"ðŸ‘¥ Users Overview"]})]}),(0,e.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ee,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search...",className:"block w-64 pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,e.jsxs)("button",{className:"p-1 text-gray-500 hover:text-gray-700 relative",children:[(0,e.jsx)(Ye,{className:"h-6 w-6"}),(0,e.jsx)("span",{className:"absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"})]}),(0,e.jsx)("div",{className:"flex items-center",children:(0,e.jsx)("div",{className:"w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center",children:(0,e.jsx)(ns,{className:"h-5 w-5 text-indigo-600"})})}),(0,e.jsxs)("button",{onClick:w,className:"flex items-center text-sm font-medium text-gray-700 hover:text-gray-900",children:[(0,e.jsx)(ye,{className:"mr-2 h-5 w-5"}),"Logout"]})]})]})}),(0,e.jsx)("main",{className:"flex-1 overflow-y-auto bg-gray-50 p-6",children:(0,e.jsx)("div",{className:"h-full w-full",children:(0,e.jsx)(Te,{})})})]})]})},Cs=As,Es=()=>{const[i,g]=(0,s.useState)([]),[U,S]=(0,s.useState)([]),[f,h]=(0,s.useState)(!0),[w,b]=(0,s.useState)(null),[L,x]=(0,s.useState)(""),[u,I]=(0,s.useState)("All"),[N,A]=(0,s.useState)({});(0,s.useEffect)(()=>{const l=K(B(k,"users")),v=V(l,a=>{const m=a.docs.map(n=>({id:n.id,...n.data()}));S(m)},a=>{console.error("Error loading users:",a),b("Failed to load users: "+a.message)});return()=>v()},[]),(0,s.useEffect)(()=>{const l=K(B(k,"loans"),Q("timestamp","desc")),v=V(l,a=>{try{const m=a.docs.map(n=>({id:n.id,...n.data()})).map(n=>{const o=U.find(t=>t.uid===n.userId);return{...n,userName:o?o.fullName||"Unnamed User":"Unknown User"}});g(m),h(!1)}catch(m){console.error("Error merging loan data:",m),b("Error processing loan data: "+m.message),h(!1)}},a=>{console.error("Firestore error:",a),b("Failed to load loans: "+a.message),h(!1)});return()=>v()},[U]);const C=l=>{switch(l){case"accepted":return"bg-green-100 text-green-800";case"denied":return"bg-red-100 text-red-800";case"Pending":case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},F=async(l,v)=>{try{const a=q(k,"loans",l);await Y(a,{status:v}),console.log(`Loan ${l} status updated to ${v}`)}catch(a){console.error("Error updating loan status:",a),b("Failed to update loan status: "+a.message)}},c=l=>{if(!l)return"N/A";if(l.seconds){const v=new Date(l.seconds*1e3);return v.toLocaleDateString()+" "+v.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}if(l.toDate){const v=l.toDate();return v.toLocaleDateString()+" "+v.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return l.toString()},p=i.reduce((l,v)=>l+(parseFloat(v.amount)||0),0),j=i.filter(l=>l.status==="pending").length,P=i.filter(l=>l.status==="accepted").length,T=i.filter(l=>l.status==="denied").length,$=i.filter(l=>l.status==="accepted").reduce((l,v)=>l+(parseFloat(v.amount)||0),0),O=i.filter(l=>l.status==="denied").reduce((l,v)=>l+(parseFloat(v.amount)||0),0),_=i.filter(l=>{const v=l.userName?.toLowerCase().includes(L.toLowerCase())||l.userId?.toLowerCase().includes(L.toLowerCase())||l.message?.toLowerCase().includes(L.toLowerCase()),a=u==="All"||l.status===u;return v&&a});return f?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading loans..."})]})}):w?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",w]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total loans"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",p.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-blue-100",children:(0,e.jsx)(me,{className:"h-6 w-6 text-blue-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Pending loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:j})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-yellow-100",children:(0,e.jsx)(Ce,{className:"h-6 w-6 text-yellow-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Paid loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:P})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(cs,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Declined loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:T})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(se,{className:"h-6 w-6 text-red-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Accepted Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",$.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(xe,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Declined Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",O.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(se,{className:"h-6 w-6 text-red-600"})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Loans Records"}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ee,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by name, user ID or message...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:L,onChange:l=>x(l.target.value)})]}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsxs)("select",{className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg bg-gray-50",value:u,onChange:l=>I(l.target.value),children:[(0,e.jsx)("option",{value:"All",children:"All Statuses"}),(0,e.jsx)("option",{value:"Pending",children:"Pending"}),(0,e.jsx)("option",{value:"accepted",children:"Paid"}),(0,e.jsx)("option",{value:"denied",children:"Declined"})]}),(0,e.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,e.jsx)(ke,{className:"h-5 w-5 text-gray-400"})})]})]})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User Name"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:_.length>0?_.map(l=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,e.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:l.userName}),(0,e.jsxs)("div",{className:"text-xs text-gray-500 italic",children:["ID: ",l.userId]})]}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:["$",l.amount?parseFloat(l.amount).toFixed(2):"0.00"]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${C(l.status)}`,children:l.status==="accepted"?"Paid":l.status||"Pending"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:c(l.timestamp)}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,e.jsxs)("div",{className:"flex items-center space-x-3",children:[l.status==="pending"?(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("button",{disabled:!!N[l.id],onClick:async()=>{if(window.confirm("Mark this loan as Paid?")){A(v=>({...v,[l.id]:!0}));try{await F(l.id,"accepted")}finally{A(v=>{const a={...v};return delete a[l.id],a})}}},className:"px-3 py-1 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors duration-200 disabled:opacity-50",children:N[l.id]?"Processing...":"Pay"}),(0,e.jsx)("button",{disabled:!!N[l.id],onClick:async()=>{if(window.confirm("Mark this loan as Declined?")){A(v=>({...v,[l.id]:!0}));try{await F(l.id,"denied")}finally{A(v=>{const a={...v};return delete a[l.id],a})}}},className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors duration-200 disabled:opacity-50",children:N[l.id]?"Processing...":"Decline"})]}):(0,e.jsx)("span",{className:"text-sm text-gray-500",children:l.status==="accepted"?"Paid":l.status}),l.imageUrl&&(0,e.jsx)("button",{onClick:()=>window.open(l.imageUrl,"_blank"),className:"text-indigo-600 hover:text-indigo-900 flex items-center",title:"View proof",children:(0,e.jsx)(os,{className:"h-4 w-4"})})]})})]},l.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"5",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No loans found."})})})]})})})]})},Ls=Es,Ps=()=>{const[i,g]=(0,s.useState)([]),[U,S]=(0,s.useState)(!0),[f,h]=(0,s.useState)(null),[w,b]=(0,s.useState)(""),[L,x]=(0,s.useState)(!1),[u,I]=(0,s.useState)(null),[N,A]=(0,s.useState)([]),[C,F]=(0,s.useState)([]),[c,p]=(0,s.useState)(!1),[j,P]=(0,s.useState)(!1),[T,$]=(0,s.useState)(null),[O,_]=(0,s.useState)(null),[l,v]=(0,s.useState)({}),a=(0,s.useRef)(null),m=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!k){h("Firestore instance not available"),S(!1);return}const r=K(B(k,"users"),Q("createdAt","desc")),D=V(r,E=>{try{const W=E.docs.map(G=>({id:G.id,...G.data()}));g(W),S(!1)}catch(W){console.error("Error processing users snapshot:",W),h("Failed to process users data"),S(!1)}},E=>{console.error("Error fetching users:",E),E.code==="permission-denied"?h("Permission denied. Check Firestore rules."):h("Failed to load users: "+(E.message||"Unknown error")),S(!1)});return()=>D()},[]),(0,s.useEffect)(()=>{if(a.current&&(a.current(),a.current=null),m.current&&(m.current(),m.current=null),!u){A([]),F([]);return}p(!0),$(null);const r=K(B(k,"deposits"),Q("timestamp","desc"));a.current=V(r,E=>{try{const W=E.docs.map(G=>({id:G.id,...G.data()})).filter(G=>G.userId===u.uid);A(W),p(!1)}catch(W){console.error("Error processing deposits snapshot:",W),$("Failed to process deposits data"),p(!1)}},E=>{console.error("Error fetching deposits:",E),$("Failed to load deposits: "+(E.message||"Unknown error")),p(!1)}),P(!0),_(null);const D=K(B(k,"loans"),Q("timestamp","desc"));return m.current=V(D,E=>{try{const W=E.docs.map(G=>({id:G.id,...G.data()})).filter(G=>G.userId===u.uid);F(W),P(!1)}catch(W){console.error("Error processing loans snapshot:",W),_("Failed to process loans data"),P(!1)}},E=>{console.error("Error fetching loans:",E),_("Failed to load loans: "+(E.message||"Unknown error")),P(!1)}),()=>{a.current&&(a.current(),a.current=null),m.current&&(m.current(),m.current=null)}},[u]);const n=r=>{if(!r)return"N/A";if(r.seconds)return new Date(r.seconds*1e3).toLocaleString();if(r.toDate)return r.toDate().toLocaleString();try{return new Date(r).toLocaleString()}catch{return String(r)}},o=r=>{switch(r?.toLowerCase()){case"accepted":return"bg-green-100 text-green-800";case"denied":case"rejected":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},t=r=>{I(r),x(!0)},d=()=>{x(!1)},y=r=>{window.open(r,"_blank")},R=(r,D)=>{const E=document.createElement("a");E.href=r,E.download=D||"proof-image.jpg",document.body.appendChild(E),E.click(),document.body.removeChild(E)},M=N.reduce((r,D)=>r+(D.amount||0),0),z=C.reduce((r,D)=>r+(D.amount||0),0);N.filter(r=>r.status==="pending").length,N.filter(r=>r.status==="accepted").length,N.filter(r=>r.status==="denied"||r.status==="rejected").length,C.filter(r=>r.status==="pending").length,C.filter(r=>r.status==="accepted").length,C.filter(r=>r.status==="denied"||r.status==="rejected").length;const X=i.filter(r=>{const D=w.trim().toLowerCase();return D?(r.fullName||"").toLowerCase().includes(D)||(r.email||"").toLowerCase().includes(D)||(r.phoneNumber||"").toLowerCase().includes(D)||(r.uid||"").toLowerCase().includes(D):!0});return U?(0,e.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading users..."})]})}):f?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",f]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6 md:col-span-1",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Users"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:i.length})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a4 4 0 00-4-4h-1M9 20H4v-2a4 4 0 014-4h1m0-4a4 4 0 100-8 4 4 0 000 8z"})})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6 md:col-span-3",children:(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"User Records"}),(0,e.jsx)("div",{className:"flex items-center w-full sm:w-64",children:(0,e.jsxs)("div",{className:"relative w-full",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ee,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search users...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:w,onChange:r=>b(r.target.value)})]})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gender"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Age"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:X.length>0?X.map(r=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150 cursor-pointer",onClick:()=>t(r),children:[(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[r.imageUrl?(0,e.jsx)("img",{src:r.imageUrl,alt:r.fullName||"avatar",className:"h-10 w-10 rounded-full object-cover",onError:D=>{D.target.style.display="none"}}):(0,e.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-medium text-gray-700",children:(r.fullName||"U").split(" ").map(D=>D[0]).slice(0,2).join("").toUpperCase()}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:r.fullName||"No name"}),(0,e.jsx)("div",{className:"text-xs text-gray-500",children:r.uid||""})]})]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.email||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.phoneNumber||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize",children:r.gender||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.age||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:n(r.createdAt)})]},r.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No users found."})})})]})})}),L&&u&&(0,e.jsx)("div",{className:"fixed inset-0 z-50 overflow-auto bg-black bg-opacity-50 flex items-center justify-center p-4",children:(0,e.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-auto",children:[(0,e.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center",children:[(0,e.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:["User Details: ",u.fullName]}),(0,e.jsx)("button",{onClick:d,className:"p-1 rounded-full hover:bg-gray-100 transition-colors",children:(0,e.jsx)(re,{className:"h-5 w-5 text-gray-500"})})]}),(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[u.imageUrl?(0,e.jsx)("img",{src:u.imageUrl,alt:u.fullName||"avatar",className:"h-16 w-16 rounded-full object-cover mr-4"}):(0,e.jsx)("div",{className:"h-16 w-16 rounded-full bg-gray-200 flex items-center justify-center text-xl font-medium text-gray-700 mr-4",children:(u.fullName||"U").split(" ").map(r=>r[0]).slice(0,2).join("").toUpperCase()}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:u.fullName||"No name"}),(0,e.jsxs)("p",{className:"text-sm text-gray-500",children:["ID: ",u.uid||"N/A"]})]})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Email"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:u.email||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Phone Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:u.phoneNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"MoMo Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:u.momoNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Credit card Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:u.creditCardNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Gender"}),(0,e.jsx)("p",{className:"text-sm text-gray-900 capitalize",children:u.gender||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Age"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:u.age||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Joined Date"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:n(u.createdAt)})]})]})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"p-2 rounded-full bg-green-100 mr-3",children:(0,e.jsx)(ae,{className:"h-6 w-6 text-green-600"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Deposits Summary"})]}),(0,e.jsx)("div",{className:"space-y-3",children:(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Amount:"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",M.toFixed(2)]})]})})]}),(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"p-2 rounded-full bg-blue-100 mr-3",children:(0,e.jsx)(ls,{className:"h-6 w-6 text-blue-600"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Loans Summary"})]}),(0,e.jsx)("div",{className:"space-y-3",children:(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Amount:"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",z.toFixed(2)]})]})})]})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Deposits"}),c?(0,e.jsx)("div",{className:"flex justify-center py-4",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):T?(0,e.jsx)("div",{className:"bg-red-50 p-4 rounded-md",children:(0,e.jsx)("p",{className:"text-sm text-red-800",children:T})}):N.length>0?(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Message"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proof"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(r=>(0,e.jsxs)("tr",{children:[(0,e.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",r.amount||"0"]}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${o(r.status)}`,children:r.status||"Unknown"})}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:n(r.timestamp)}),(0,e.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",title:r.message,children:r.message||"N/A"}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:r.proofImage?(0,e.jsxs)("div",{className:"flex space-x-2",children:[(0,e.jsx)("button",{onClick:()=>y(r.proofImage),className:"text-indigo-600 hover:text-indigo-900",title:"View",children:(0,e.jsx)(pe,{className:"h-5 w-5"})}),(0,e.jsx)("button",{onClick:()=>R(r.proofImage,`deposit-proof-${r.id}.jpg`),className:"text-indigo-600 hover:text-indigo-900",title:"Download",children:(0,e.jsx)(De,{className:"h-5 w-5"})})]}):"N/A"})]},r.id))})]})}):(0,e.jsx)("div",{className:"text-center py-4 text-sm text-gray-500",children:"No deposits found."})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Loans"}),j?(0,e.jsx)("div",{className:"flex justify-center py-4",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):O?(0,e.jsx)("div",{className:"bg-red-50 p-4 rounded-md",children:(0,e.jsx)("p",{className:"text-sm text-red-800",children:O})}):C.length>0?(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Approved By"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:C.map(r=>(0,e.jsxs)("tr",{children:[(0,e.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",r.amount||"0"]}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${o(r.status)}`,children:r.status||"Unknown"})}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:n(r.timestamp)}),(0,e.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",title:r.reason,children:r.reason||"N/A"}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:r.approvedBy||"N/A"})]},r.id))})]})}):(0,e.jsx)("div",{className:"text-center py-4 text-sm text-gray-500",children:"No loans found."})]})]})]})})]})},Us=Ps,Fs=()=>{const[i,g]=(0,s.useState)("10.00"),[U,S]=(0,s.useState)(!0),[f,h]=(0,s.useState)(!1),[w,b]=(0,s.useState)(null),[L,x]=(0,s.useState)("success"),[u,I]=(0,s.useState)([]),[N,A]=(0,s.useState)(!1),[C,F]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{try{const j=K(B(k,"interest"),Q("timestamp","desc"),Ve(10)),P=await Oe(j);if(P.empty)g("10.00");else{const T=P.docs[0];g(T.data().interest.toFixed(2)),F(T.id);const $=P.docs.map(O=>({date:new Date(O.data().timestamp?.toDate()||Date.now()).toLocaleDateString(),rate:parseFloat(O.data().interest)})).reverse();I($)}}catch(j){console.error("Error fetching interest:",j),b("Failed to load interest rate"),x("error"),setTimeout(()=>b(null),3e3)}finally{S(!1)}})()},[]);const c=async()=>{if(isNaN(i)||i<1||i>100){b("Please enter a valid interest rate between 1% and 100%"),x("error"),setTimeout(()=>b(null),3e3);return}h(!0);try{const p=new Date;if(C){const j=q(k,"interest",C);await Y(j,{interest:Number(i),timestamp:p})}else await Se(q(k,"interest","globalRate"),{interest:Number(i),timestamp:p}),F("globalRate");b("Interest rate updated successfully!"),x("success"),I(j=>[...j.slice(-9),{date:p.toLocaleDateString(),rate:Number(i)}])}catch(p){console.error("Error updating interest:",p),b("Failed to update interest rate"),x("error")}finally{h(!1),setTimeout(()=>b(null),3e3)}};return U?(0,e.jsx)("div",{className:"flex justify-center items-center min-h-screen px-4",children:(0,e.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-10 w-full max-w-md text-center",children:[(0,e.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-300",children:"Loading interest rate..."})]})}):(0,e.jsxs)("div",{className:"flex justify-center items-center min-h-screen px-4 bg-gray-50 dark:bg-gray-900",children:[(0,e.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-6 md:p-10 w-full max-w-md",children:[(0,e.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100 mb-6 text-center",children:"Interest Rate Settings"}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{className:"block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2",children:"Current Interest Rate (%)"}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("input",{type:"number",step:"0.01",min:"1",max:"100",value:i,onChange:p=>g(p.target.value),className:"border border-gray-300 dark:border-gray-700 rounded-lg p-3 w-full focus:ring-2 focus:ring-blue-500 outline-none pr-12",disabled:f,placeholder:"Enter interest rate (1â€“100)"}),(0,e.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"%"})]}),(0,e.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Enter as a percentage (e.g., 5 for 5%)"})]}),(0,e.jsx)("button",{onClick:c,disabled:f,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 w-full disabled:opacity-50 flex items-center justify-center text-sm sm:text-base",children:f?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Saving..."]}):"Save Changes"}),(0,e.jsx)("div",{className:"mt-6 text-center",children:(0,e.jsxs)("button",{onClick:()=>A(!N),className:"text-blue-600 dark:text-blue-400 text-sm font-medium hover:underline",children:[N?"Hide":"Show"," Rate History"]})}),N&&u.length>0&&(0,e.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[(0,e.jsx)("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-4",children:"Interest Rate History"}),(0,e.jsx)("div",{className:"h-48",children:(0,e.jsx)(oe,{width:"100%",height:"100%",children:(0,e.jsxs)(we,{data:u,children:[(0,e.jsx)(de,{strokeDasharray:"3 3",stroke:"#e0e0e0"}),(0,e.jsx)(le,{dataKey:"date",tick:{fontSize:12}}),(0,e.jsx)(ce,{tick:{fontSize:12},domain:["dataMin - 0.5","dataMax + 0.5"]}),(0,e.jsx)(ie,{formatter:p=>`${p.toFixed(2)}%`,contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.9)",border:"1px solid #ccc",borderRadius:"4px"}}),(0,e.jsx)(ne,{type:"monotone",dataKey:"rate",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},activeDot:{r:6}})]})})})]})]}),w&&(0,e.jsx)("div",{className:`fixed top-5 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg text-white font-semibold shadow-md transition-all duration-300 ${L==="success"?"bg-green-500":"bg-red-500"}`,children:w})]})},Ts=Fs,Rs=({onAccessGranted:i})=>{const[g,U]=(0,s.useState)(""),[S,f]=(0,s.useState)(!1),[h,w]=(0,s.useState)(""),[b,L]=(0,s.useState)(""),[x,u]=(0,s.useState)(!1),[I,N]=(0,s.useState)(""),[A,C]=(0,s.useState)(""),[F,c]=(0,s.useState)(""),[p,j]=(0,s.useState)(!1),[P,T]=(0,s.useState)(!1),[$,O]=(0,s.useState)(!1),_="omaryagoub77@gmail.com";(0,s.useEffect)(()=>{if(A){T(!0);const o=setTimeout(()=>{T(!1),setTimeout(()=>C(""),500)},3e3);return()=>clearTimeout(o)}},[A]),(0,s.useEffect)(()=>{if(F){O(!0);const o=setTimeout(()=>{O(!1),setTimeout(()=>{c(""),x&&u(!1)},500)},3e3);return()=>clearTimeout(o)}},[F,x]);const l=async o=>{o.preventDefault(),j(!0);try{const t=q(k,"adminSettings","security"),d=await je(t);if(d.exists()){const{password:y}=d.data();g===y?i():C("Incorrect password. Please try again.")}else C("Admin settings not found. Please contact support.")}catch(t){console.error("Error fetching admin password:",t),C("Failed to verify password. Please try again.")}finally{j(!1)}},v=async o=>{o.preventDefault(),j(!0);try{const t=xs(),d=new Date;d.setMinutes(d.getMinutes()+15),await Se(q(k,"passwordResets",t),{token:t,expiresAt:d,used:!1});const y=`${window.location.origin}/admin-login?reset=true&token=${t}`;await ms.send("service_rbtk5y8","template_i85brpa",{to_email:_,reset_link:y},"zcAI9wNXtOd3ooJ67"),c("Password reset email sent! Check your inbox."),setTimeout(()=>{f(!1)},3e3)}catch(t){console.error("Error sending password reset email:",t),C("Failed to send reset email. Please try again.")}finally{j(!1)}},a=async o=>{if(o.preventDefault(),h!==b){C("Passwords do not match.");return}if(h.length<6){C("Password must be at least 6 characters long.");return}j(!0);try{const t=q(k,"adminSettings","security");await Y(t,{password:h});const d=q(k,"passwordResets",I);await Y(d,{used:!0}),c("Password updated successfully!"),w(""),L(""),setTimeout(()=>{window.location.href="/admin-login"},3e3)}catch(t){console.error("Error updating password:",t),C("Failed to update password. Please try again.")}finally{j(!1)}};return(0,s.useEffect)(()=>{const o=new URLSearchParams(window.location.search),t=o.get("reset"),d=o.get("token");t==="true"&&d&&(async()=>{try{const R=q(k,"passwordResets",d),M=await je(R);if(!M.exists()){C("Invalid or expired reset link.");return}const z=M.data();if(z.used||new Date>z.expiresAt.toDate()){C("This reset link has expired.");return}u(!0),N(d)}catch(R){console.error("Error verifying reset token:",R),C("Failed to verify reset link.")}})()},[]),x?(0,e.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96 max-w-md",children:[(0,e.jsx)("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-800",children:"Reset Admin Password"}),(0,e.jsxs)("form",{onSubmit:a,children:[(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),(0,e.jsx)("input",{type:"password",id:"newPassword",value:h,onChange:o=>w(o.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full transition-colors",required:!0})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),(0,e.jsx)("input",{type:"password",id:"confirmPassword",value:b,onChange:o=>L(o.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full transition-colors",required:!0})]}),(0,e.jsx)("button",{type:"submit",disabled:p,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Updating...":"Reset Password"})]}),(0,e.jsx)("div",{className:"mt-4 text-center",children:(0,e.jsx)("button",{onClick:()=>u(!1),className:"text-blue-600 text-sm hover:underline",children:"Back to login"})}),A&&(0,e.jsx)("div",{className:`text-red-500 mt-4 transition-opacity duration-500 ${P?"opacity-100":"opacity-0"}`,children:A}),F&&(0,e.jsx)("div",{className:`text-green-500 mt-4 transition-opacity duration-500 ${$?"opacity-100":"opacity-0"}`,children:F})]})}):(0,e.jsxs)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:[(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96 max-w-md",children:[(0,e.jsx)("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-800",children:"Admin Access"}),(0,e.jsxs)("form",{onSubmit:l,children:[(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",value:g,onChange:o=>U(o.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full transition-colors",required:!0})]}),(0,e.jsx)("button",{type:"submit",disabled:p,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-full mt-4 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Verifying...":"Access Admin Dashboard"})]}),A&&(0,e.jsx)("div",{className:`text-red-500 mt-2 transition-opacity duration-500 ${P?"opacity-100":"opacity-0"}`,children:A}),F&&(0,e.jsx)("div",{className:`text-green-500 mt-2 transition-opacity duration-500 ${$?"opacity-100":"opacity-0"}`,children:F}),(0,e.jsx)("div",{className:"text-blue-600 text-sm mt-3 hover:underline cursor-pointer text-center",onClick:()=>f(!0),children:"Forgot password?"})]}),S&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96 max-w-md",children:[(0,e.jsx)("h2",{className:"text-xl font-bold text-center mb-4 text-gray-800",children:"Reset Password"}),(0,e.jsx)("p",{className:"text-gray-600 text-sm mb-6",children:"A reset link will be sent to the admin email."}),(0,e.jsx)("div",{className:"mb-6 p-3 bg-gray-100 rounded-md",children:(0,e.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,e.jsx)("span",{className:"font-medium",children:"Email:"})," ",_]})}),(0,e.jsx)("form",{onSubmit:v,children:(0,e.jsxs)("div",{className:"flex space-x-3",children:[(0,e.jsx)("button",{type:"button",onClick:()=>f(!1),className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md w-1/2 transition-colors",children:"Cancel"}),(0,e.jsx)("button",{type:"submit",disabled:p,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-1/2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Sending...":"Send Reset Link"})]})}),A&&(0,e.jsx)("div",{className:`text-red-500 mt-4 transition-opacity duration-500 ${P?"opacity-100":"opacity-0"}`,children:A}),F&&(0,e.jsx)("div",{className:`text-green-500 mt-4 transition-opacity duration-500 ${$?"opacity-100":"opacity-0"}`,children:F})]})})]})},Is=Rs;function Ms({children:i}){const{currentUser:g}=J();return g?i:(0,e.jsx)(ve,{to:"/login"})}function Ne({children:i}){const{currentUser:g}=J();return g?(0,e.jsx)(ve,{to:"/dashboard"}):i}function $s(){const[i,g]=(0,s.useState)(!1);return i?(0,e.jsxs)(Re,{children:[(0,e.jsx)(H,{path:"/login",element:(0,e.jsx)(Ne,{children:(0,e.jsx)(gs,{})})}),(0,e.jsx)(H,{path:"/signup",element:(0,e.jsx)(Ne,{children:(0,e.jsx)(ps,{})})}),(0,e.jsxs)(H,{path:"/",element:(0,e.jsx)(Ms,{children:(0,e.jsx)(Cs,{})}),children:[(0,e.jsx)(H,{index:!0,element:(0,e.jsx)(be,{})}),(0,e.jsx)(H,{path:"profile",element:(0,e.jsx)(js,{})}),(0,e.jsx)(H,{path:"dashboard",element:(0,e.jsx)(be,{})}),(0,e.jsx)(H,{path:"deposits",element:(0,e.jsx)(vs,{})}),(0,e.jsx)(H,{path:"loans",element:(0,e.jsx)(Ls,{})}),(0,e.jsx)(H,{path:"payback",element:(0,e.jsx)(Ns,{})}),(0,e.jsx)(H,{path:"users",element:(0,e.jsx)(Us,{})}),(0,e.jsx)(H,{path:"settings",element:(0,e.jsx)(Ts,{})}),(0,e.jsx)(H,{path:"chat",element:(0,e.jsx)(ks,{})})]})]}):(0,e.jsx)(Is,{onAccessGranted:()=>g(!0)})}var Os=$s;(0,us.createRoot)(document.getElementById("root")).render((0,e.jsx)(s.StrictMode,{children:(0,e.jsx)(hs,{children:(0,e.jsx)(Me,{children:(0,e.jsx)(Os,{})})})}));
