import{r as ge}from"./rolldown-runtime-CjiBMUN4.js";import{a as le,c as oe,d as Fe,i as de,l as ce,n as Se,o as me,r as xe,s as je,t as Te}from"./charting-mCjb7GWK.js";import{t as Re}from"./react-dom-COd6vK1M.js";import{a as Y,c as pe,i as Ie,n as fe,o as Me,r as De,s as $e,t as ze}from"./react-router-CShHLuBK.js";import{_ as Oe,a as _e,c as K,d as se,f as ke,g as Be,h as qe,i as be,l as Z,m as Ge,n as V,o as Ve,p as J,r as W,s as We,t as He,u as Q,v as Ke,y as Ye}from"./firebase-DQPaLeaR.js";import{t as Qe}from"./react-xg8gCaOR.js";import{C as Xe,E as Je,S as Ze,T as es,_ as ue,a as ae,b as he,c as ss,d as ts,f as Ae,g as ne,h as Ce,i as as,l as we,m as ye,n as rs,o as ns,p as is,r as Ee,s as ls,t as ie,u as os,v as Pe,w as ds,x as cs,y as te}from"./lucide-icons-NKzM_I9k.js";import{n as ms,t as xs}from"./vendor-BR9iRDep.js";(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))v(f);new MutationObserver(f=>{for(const h of f)if(h.type==="childList")for(const N of h.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&v(N)}).observe(document,{childList:!0,subtree:!0});function L(f){const h={};return f.integrity&&(h.integrity=f.integrity),f.referrerPolicy&&(h.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?h.credentials="include":f.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function v(f){if(f.ep)return;f.ep=!0;const h=L(f);fetch(f.href,h)}})();var us=ge(Re()),s=ge(Fe()),Le=Ye({apiKey:"AIzaSyAGm3bzsCxYSARcgVn41ta_EOut9fauWr0",authDomain:"ecommerce-74229.firebaseapp.com",projectId:"ecommerce-74229",storageBucket:"ecommerce-74229.firebasestorage.app",messagingSenderId:"47160479095",appId:"1:47160479095:web:0dd3a844d5d5c3847ea572",measurementId:"G-47FYXTR59Z"}),re=qe(Le),D=Ve(Le),e=ge(Qe()),Ue=(0,s.createContext)();const ee=()=>(0,s.useContext)(Ue),hs=({children:i})=>{const[g,L]=(0,s.useState)(null),[v,f]=(0,s.useState)(!0),h=(x,u)=>Ge(re,x,u),N=(x,u)=>Oe(re,x,u),b=()=>Ke(re);(0,s.useEffect)(()=>Be(re,x=>{L(x),f(!1)}),[]);const C={currentUser:g,signup:h,login:N,logout:b};return(0,e.jsx)(Ue.Provider,{value:C,children:v?(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):i})};function gs(){const i=(0,s.useRef)(),g=(0,s.useRef)(),{login:L}=ee(),v=pe(),[f,h]=(0,s.useState)(""),[N,b]=(0,s.useState)(!1),C=async x=>{x.preventDefault();try{h(""),b(!0),await L(i.current.value,g.current.value),v("/dashboard")}catch{h("Failed to sign in. Please check your credentials and try again.")}b(!1)};return(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-400 to-gray-100 p-4",children:(0,e.jsx)("div",{className:"w-full max-w-md",children:(0,e.jsxs)("form",{onSubmit:C,className:"bg-white p-8 rounded-2xl shadow-lg border border-gray-100",children:[(0,e.jsxs)("div",{className:"text-center mb-8",children:[(0,e.jsx)("div",{className:"mx-auto w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mb-4",children:(0,e.jsx)("span",{className:"text-white font-bold text-xl",children:"MB"})}),(0,e.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Welcome Back"}),(0,e.jsx)("p",{className:"text-gray-600 mt-2",children:"Sign in to your account"})]}),f&&(0,e.jsx)("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg mb-6 text-sm",children:f}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,e.jsx)("input",{type:"email",id:"email",ref:i,placeholder:"Enter your email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",ref:g,placeholder:"Enter your password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsx)("button",{disabled:N,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-lg transition-colors duration-200 disabled:opacity-50",children:N?"Signing In...":"Sign In"}),(0,e.jsxs)("p",{className:"mt-6 text-center text-gray-600",children:["Don't have an account?"," ",(0,e.jsx)(fe,{to:"/signup",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"Sign Up"})]})]})})})}function ps(){const i=(0,s.useRef)(),g=(0,s.useRef)(),L=(0,s.useRef)(),{signup:v}=ee(),f=pe(),[h,N]=(0,s.useState)(""),[b,C]=(0,s.useState)(!1),x=async u=>{if(u.preventDefault(),g.current.value!==L.current.value)return N("Passwords do not match");if(g.current.value.length<6)return N("Password should be at least 6 characters");try{N(""),C(!0),await v(i.current.value,g.current.value),f("/dashboard")}catch{N("Failed to create an account. Please try again.")}C(!1)};return(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-400 to-gray-100 p-4",children:(0,e.jsx)("div",{className:"w-full max-w-md",children:(0,e.jsxs)("form",{onSubmit:x,className:"bg-white p-8 rounded-2xl shadow-lg border border-gray-100",children:[(0,e.jsxs)("div",{className:"text-center mb-8",children:[(0,e.jsx)("div",{className:"mx-auto w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mb-4",children:(0,e.jsx)("span",{className:"text-white font-bold text-xl",children:"MB"})}),(0,e.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Create Account"}),(0,e.jsx)("p",{className:"text-gray-600 mt-2",children:"Sign up to get started"})]}),h&&(0,e.jsx)("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg mb-6 text-sm",children:h}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,e.jsx)("input",{type:"email",id:"email",ref:i,placeholder:"Enter your email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",ref:g,placeholder:"Create a password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),(0,e.jsx)("input",{type:"password",id:"confirmPassword",ref:L,placeholder:"Confirm your password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsx)("button",{disabled:b,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-lg transition-colors duration-200 disabled:opacity-50",children:b?"Creating Account...":"Sign Up"}),(0,e.jsxs)("p",{className:"mt-6 text-center text-gray-600",children:["Already have an account?"," ",(0,e.jsx)(fe,{to:"/login",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"Sign In"})]})]})})})}var fs=()=>(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{children:[(0,e.jsx)("h1",{children:"Create your porfile"}),(0,e.jsxs)("form",{action:"",children:[(0,e.jsx)("input",{type:"text",placeholder:"Your full name "}),(0,e.jsx)("input",{type:"email",placeholder:"Your email",name:"",id:""}),(0,e.jsx)("input",{type:"number",placeholder:"You phone number ",name:"",id:""}),(0,e.jsx)("input",{type:"number",placeholder:"You Age  ",name:"",id:""}),(0,e.jsxs)("option",{value:"",children:[(0,e.jsx)("select",{name:"male",id:"",children:"Male"}),(0,e.jsx)("select",{name:"female",id:"",children:"Female"})]}),(0,e.jsx)("input",{type:"file",placeholder:"Upload your photo"}),(0,e.jsx)("button",{type:"submit",children:"Create account"})]})]})}),ys=fs,js=()=>{const[i,g]=(0,s.useState)(0),[L,v]=(0,s.useState)(0),[f,h]=(0,s.useState)(0),[N,b]=(0,s.useState)(0),[C,x]=(0,s.useState)(!1),[u,O]=(0,s.useState)(!1),[w,k]=(0,s.useState)(!1),[A,F]=(0,s.useState)([]),[c,p]=(0,s.useState)([]),[y,E]=(0,s.useState)([]),[R,_]=(0,s.useState)(!0),[$,q]=(0,s.useState)({width:window.innerWidth,height:window.innerHeight});(0,s.useEffect)(()=>{const n=()=>{q({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const l=n=>new Date(n).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",hour12:!0});(0,s.useEffect)(()=>{if(!D){k("Firestore instance not available"),_(!1);return}const n=Q(V(D,"users"),Z("createdAt","desc")),U=K(n,I=>{try{const z=I.docs.map(M=>({id:M.id,...M.data()}));E(z),b(z.length),_(!1),k(!1)}catch(z){console.error("Error processing users snapshot:",z),k("Failed to process users data"),_(!1)}},I=>{console.error("Error fetching users:",I),I.code==="permission-denied"?k("Permission denied. Check Firestore rules."):k("Failed to load users: "+(I.message||"Unknown error")),_(!1)});return()=>U()},[]);const S=({active:n,payload:U,label:I})=>{if(n&&U&&U.length){const z=U[0].payload,M=$.width<768;return(0,e.jsxs)("div",{className:`bg-white border border-gray-200 shadow-lg rounded-md ${M?"p-2":"p-4"}`,children:[(0,e.jsx)("p",{className:`font-medium text-gray-900 ${M?"text-xs":"text-sm"}`,children:l(z.timestamp)}),(0,e.jsxs)("p",{className:`text-indigo-600 ${M?"text-xs":"text-sm"}`,children:["Deposits: $",z.deposits.toFixed(2)]}),(0,e.jsxs)("p",{className:`text-red-600 ${M?"text-xs":"text-sm"}`,children:["loans: $",z.loans.toFixed(2)]})]})}return null},t=(n,U,I=20)=>{const z=[];return n.forEach(M=>{const r=M.timestamp?.toDate?.()||new Date(M.timestamp);z.push({timestamp:r,name:r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),deposits:Number(M.amount)||0,loans:0})}),U.forEach(M=>{const r=M.timestamp?.toDate?.()||new Date(M.timestamp);z.push({timestamp:r,name:r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),deposits:0,loans:Number(M.amount)||0})}),z.sort((M,r)=>M.timestamp-r.timestamp),z.slice(-I)};(0,s.useEffect)(()=>{if(!D){console.error("Firestore database instance not available"),x(!0),O(!0);return}let n=[],U=[];const I=Q(V(D,"deposits"),Z("timestamp","desc")),z=K(I,T=>{try{let P=0;n=[],T.forEach(B=>{const H=B.data();H.amount&&(P+=parseFloat(H.amount)),n.push({id:B.id,...H,timestamp:H.timestamp})}),g(P),x(!1);const G=t(n,U);F(G),p(B=>[...n.slice(0,3).map(H=>({id:H.id,type:"deposit",userId:H.userId,amount:H.amount,timestamp:H.timestamp?.toDate?.()||new Date})),...B].slice(0,6))}catch(P){console.error("Error processing deposits data:",P),x(!0)}},T=>{console.error("Error fetching deposits:",T),x(!0)}),M=Q(V(D,"loans"),Z("timestamp","desc")),r=K(M,T=>{try{let P=0,G=0;U=[],T.forEach(H=>{const X=H.data();X.amount&&(P+=parseFloat(X.amount)),X.status==="pending"&&(G+=1),U.push({id:H.id,...X,timestamp:X.timestamp})}),v(P),h(G),O(!1);const B=t(n,U);F(B),p(H=>[...U.slice(0,3).map(X=>({id:X.id,type:"cashout",userId:X.userId,amount:X.amount,status:X.status,timestamp:X.timestamp?.toDate?.()||new Date})),...H].slice(0,6))}catch(P){console.error("Error processing loans data:",P),O(!0)}},T=>{console.error("Error fetching loans:",T),O(!0)});return()=>{z(),r()}},[]);const d=n=>`$${n.toFixed(2)}`,j=n=>new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),m=[{id:1,name:"Total Deposits",value:C?"N/A":d(i),change:"+12.5%",changeType:"positive",icon:ne,iconColor:"bg-indigo-500"},{id:2,name:"Total loans",value:u?"N/A":d(L),change:"+8.2%",changeType:"positive",icon:ue,iconColor:"bg-red-500"},{id:3,name:"Pending loans",value:u?"N/A":f,change:"+3.1%",changeType:"negative",icon:Je,iconColor:"bg-yellow-500"},{id:4,name:"Total Users",value:w?"N/A":N,change:"+5.4%",changeType:"positive",icon:Ee,iconColor:"bg-green-500"}],o=(()=>{const n=$.width<768,U=$.width>=768&&$.width<1024;return{margin:{top:n?5:10,right:n?10:30,left:n?5:20,bottom:n?10:5},tickFontSize:n?8:U?10:12,interval:n?"preserveStartEnd":0,minTickGap:n?10:15,barSize:n?10:15,animationDuration:n?500:800,gridStrokeDasharray:n?"2 2":"3 3"}})();return R?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading dashboard..."})]})}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:m.map(n=>(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6 transition-all duration-200 hover:shadow-md",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-xs sm:text-sm font-medium text-gray-500",children:n.name}),(0,e.jsx)("p",{className:"mt-1 sm:mt-2 text-2xl sm:text-3xl font-bold text-gray-900",children:n.value})]}),(0,e.jsx)("div",{className:`p-2 sm:p-3 rounded-full ${n.iconColor}`,children:(0,e.jsx)(n.icon,{className:"h-5 w-5 sm:h-6 sm:w-6 text-white"})})]}),(0,e.jsxs)("div",{className:"mt-3 sm:mt-4 flex items-center",children:[n.changeType==="positive"?(0,e.jsx)(ds,{className:"h-3 w-3 sm:h-4 sm:w-4 text-green-500"}):(0,e.jsx)(es,{className:"h-3 w-3 sm:h-4 sm:w-4 text-red-500"}),(0,e.jsx)("span",{className:`ml-1 text-xs sm:text-sm font-medium ${n.changeType==="positive"?"text-green-500":"text-red-500"}`,children:n.change}),(0,e.jsx)("span",{className:"ml-1 sm:ml-2 text-xs sm:text-sm text-gray-500",children:"from last month"})]})]},n.id))}),(0,e.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6",children:[(0,e.jsx)("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Live Transactions"}),(0,e.jsx)("div",{className:"h-64 sm:h-80 overflow-x-auto",children:(0,e.jsx)(ce,{width:"100%",height:"100%",minWidth:300,children:(0,e.jsxs)(Te,{data:A,margin:o.margin,children:[(0,e.jsx)(me,{strokeDasharray:o.gridStrokeDasharray}),(0,e.jsx)(de,{dataKey:"name",tick:{fontSize:o.tickFontSize},interval:o.interval,minTickGap:o.minTickGap}),(0,e.jsx)(xe,{tick:{fontSize:o.tickFontSize}}),(0,e.jsx)(oe,{content:(0,e.jsx)(S,{})}),(0,e.jsx)(je,{dataKey:"deposits",fill:"#4f46e5",name:"Deposits",barSize:o.barSize,isAnimationActive:!0,animationDuration:o.animationDuration,animationEasing:"ease-in-out"}),(0,e.jsx)(je,{dataKey:"loans",fill:"#ef4444",name:"loans",barSize:o.barSize,isAnimationActive:!0,animationDuration:o.animationDuration,animationEasing:"ease-in-out"})]})})})]}),(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6",children:[(0,e.jsx)("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Transaction Trend"}),(0,e.jsx)("div",{className:"h-64 sm:h-80 overflow-x-auto",children:(0,e.jsx)(ce,{width:"100%",height:"100%",minWidth:300,children:(0,e.jsxs)(Se,{data:A,margin:o.margin,children:[(0,e.jsx)(me,{strokeDasharray:o.gridStrokeDasharray}),(0,e.jsx)(de,{dataKey:"name",tick:{fontSize:o.tickFontSize},interval:o.interval,minTickGap:o.minTickGap}),(0,e.jsx)(xe,{tick:{fontSize:o.tickFontSize}}),(0,e.jsx)(oe,{content:(0,e.jsx)(S,{})}),(0,e.jsx)(le,{type:"monotone",dataKey:"deposits",stroke:"#4f46e5",activeDot:{r:$.width<768?4:8},name:"Deposits",strokeWidth:$.width<768?1.5:2,isAnimationActive:!0,animationDuration:o.animationDuration,animationEasing:"ease-in-out"}),(0,e.jsx)(le,{type:"monotone",dataKey:"loans",stroke:"#ef4444",name:"loans",strokeWidth:$.width<768?1.5:2,isAnimationActive:!0,animationDuration:o.animationDuration,animationEasing:"ease-in-out"})]})})})]})]}),(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[(0,e.jsx)("h3",{className:"text-base sm:text-lg font-medium text-gray-900",children:"Recent Activity"}),(0,e.jsx)("button",{className:"text-sm font-medium text-indigo-600 hover:text-indigo-800",children:"View all"})]}),(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User ID"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:c.length>0?c.map(n=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[n.type==="deposit"?(0,e.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-indigo-100 flex items-center justify-center",children:(0,e.jsx)(ne,{className:"h-3 w-3 sm:h-4 sm:w-4 text-indigo-600"})}):(0,e.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-red-100 flex items-center justify-center",children:(0,e.jsx)(ue,{className:"h-3 w-3 sm:h-4 sm:w-4 text-red-600"})}),(0,e.jsx)("span",{className:"ml-2 sm:ml-3 text-xs sm:text-sm font-medium text-gray-900 capitalize",children:n.type})]})}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500",children:n.userId||"N/A"}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-medium text-gray-900",children:d(n.amount||0)}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:n.type==="deposit"?(0,e.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"Completed"}):(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${n.status==="Pending"?"bg-yellow-100 text-yellow-800":n.status==="Accepted"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:n.status||"Pending"})}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500",children:j(n.timestamp)})]},n.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"5",className:"px-3 sm:px-6 py-3 sm:py-4 text-center text-xs sm:text-sm text-gray-500",children:"No recent activity"})})})]})})]})]})},Ne=js,bs=()=>{const{currentUser:i}=ee(),[g,L]=(0,s.useState)([]),[v,f]=(0,s.useState)([]),[h,N]=(0,s.useState)(!0),[b,C]=(0,s.useState)(null),[x,u]=(0,s.useState)(""),[O,w]=(0,s.useState)(null),[k,A]=(0,s.useState)(!1),[F,c]=(0,s.useState)(new Set);(0,s.useEffect)(()=>{if(!i)return;const t=K(V(D,"users"),d=>{const j=[];d.forEach(m=>{j.push({id:m.id,...m.data()})}),f(j)},d=>{console.error("Error fetching users:",d)});return()=>t()},[i]),(0,s.useEffect)(()=>{if(!i)return;const t=K(V(D,"loans"),d=>{const j=[];d.forEach(m=>{j.push({id:m.id,...m.data()})}),j.sort((m,a)=>{const o=m.paymentTimestamp?.toDate?.()||new Date(0);return(a.paymentTimestamp?.toDate?.()||new Date(0))-o}),L(j),N(!1)},d=>{console.error("Error fetching paybacks:",d),N(!1)});return()=>t()},[i]);const p=g.map(t=>{const d=v.find(j=>j.uid===t.userId);return{...t,userName:d?.fullName||"Unknown User",userEmail:d?.email||"No email provided"}}),y=(t,d)=>{C({message:t,type:d}),setTimeout(()=>{C(null)},3e3)},E=async t=>{try{c(d=>new Set(d).add(t)),setTimeout(async()=>{const d=W(D,"loans",t);await J(d,{paymentStatus:"approved",adminReviewedAt:se()}),setTimeout(()=>{c(j=>{const m=new Set(j);return m.delete(t),m})},300),y("Payment approved successfully!","success")},100)}catch(d){console.error("Error approving payment:",d),y("Failed to approve payment. Please try again.","error"),c(j=>{const m=new Set(j);return m.delete(t),m})}},R=async t=>{try{c(d=>new Set(d).add(t)),setTimeout(async()=>{const d=W(D,"loans",t);await J(d,{paymentStatus:"denied",adminReviewedAt:se()}),setTimeout(()=>{c(j=>{const m=new Set(j);return m.delete(t),m})},300),y("Payment denied.","error")},100)}catch(d){console.error("Error denying payment:",d),y("Failed to deny payment. Please try again.","error"),c(j=>{const m=new Set(j);return m.delete(t),m})}},_=t=>{w(t),A(!0)},$=()=>{A(!1),w(null)},q=t=>{if(!t)return"N/A";const d=t.toDate(),j=d.getDate().toString().padStart(2,"0"),m=(d.getMonth()+1).toString().padStart(2,"0"),a=d.getFullYear(),o=d.getHours().toString().padStart(2,"0"),n=d.getMinutes().toString().padStart(2,"0");return`${j}/${m}/${a} ${o}:${n}`},l=p.filter(t=>{if(t.status!=="accepted")return!1;const d=t.userName||"",j=x.toLowerCase();return d.toLowerCase().includes(j)}),S=p.filter(t=>t.status==="accepted"&&t.paymentStatus==="pending").length;return(0,e.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8",children:[b&&(0,e.jsx)("div",{className:`fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg transform transition-all duration-300 ${b.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:b.message}),(0,e.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,e.jsxs)("div",{className:"mb-8",children:[(0,e.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Loan Repayment Management"}),(0,e.jsx)("p",{className:"mt-2 text-gray-600",children:"Review and manage loan repayments for accepted loans"})]}),(0,e.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6",children:(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ae,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by user name...",value:x,onChange:t=>u(t.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]})}),(0,e.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,e.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Accepted Loan Repayments"}),(0,e.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:[S," pending"]})]}),h?(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"}),(0,e.jsx)("p",{className:"text-gray-600",children:"Loading loan repayments..."})]}):l.length===0?(0,e.jsxs)("div",{className:"text-center py-12",children:[(0,e.jsx)("div",{className:"mx-auto h-16 w-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:(0,e.jsx)(ae,{className:"h-8 w-8 text-gray-400"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No accepted loans found"}),(0,e.jsx)("p",{className:"text-gray-500",children:"There are no accepted loans at the moment."})]}):(0,e.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(t=>{const d=F.has(t.id),j=!t.paymentStatus||t.paymentStatus==="pending";return(0,e.jsx)("div",{className:`bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden transition-all duration-300 hover:shadow-md ${d?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-indigo-800 font-medium",children:t.userName?.charAt(0)?.toUpperCase()||"U"})}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:t.userName||"Unknown User"}),(0,e.jsx)("p",{className:"text-sm text-gray-500",children:t.userEmail||"No email provided"})]})]}),(0,e.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                            ${t.paymentStatus==="approved"?"bg-green-100 text-green-800":t.paymentStatus==="denied"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.paymentStatus?.charAt(0)?.toUpperCase()+t.paymentStatus?.slice(1)||"Pending"})]}),(0,e.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Loan Amount"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",t.amount]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Interest (10%)"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",(t.amount*.1).toFixed(2)]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Payable"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",t.totalPayable?.toFixed(2)||(t.amount*1.1).toFixed(2)]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Paid Amount"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",t.paidAmount]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Payment Date"}),(0,e.jsx)("span",{className:"text-sm font-medium text-gray-900",children:q(t.paymentTimestamp)})]}),t.adminReviewedAt&&(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Reviewed At"}),(0,e.jsx)("span",{className:"text-sm font-medium text-gray-900",children:q(t.adminReviewedAt)})]})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("span",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proof of Payment"}),t.proofImageUrl?(0,e.jsxs)("div",{className:"relative w-full h-32 rounded-lg overflow-hidden cursor-pointer border border-gray-200",onClick:()=>_(t.proofImageUrl),children:[(0,e.jsx)("img",{src:t.proofImageUrl,alt:"Proof of payment",className:"w-full h-full object-cover"}),(0,e.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:(0,e.jsx)(ye,{className:"h-6 w-6 text-white"})})]}):(0,e.jsx)("div",{className:"w-full h-32 rounded-lg bg-gray-100 flex items-center justify-center border border-gray-200",children:(0,e.jsx)("span",{className:"text-gray-500 text-sm",children:"No proof provided"})})]}),(0,e.jsxs)("div",{className:"flex space-x-3",children:[(0,e.jsxs)("button",{className:`flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg transition-colors ${j?"text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500":"text-gray-400 bg-gray-100 cursor-not-allowed"}`,onClick:()=>E(t.id),disabled:!j,children:[(0,e.jsx)(cs,{className:"-ml-1 mr-2 h-4 w-4"}),"Approve"]}),(0,e.jsxs)("button",{className:`flex-1 inline-flex items-center justify-center px-4 py-2 border text-sm font-medium rounded-lg transition-colors ${j?"text-gray-700 bg-white border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500":"text-gray-400 bg-gray-100 border-gray-200 cursor-not-allowed"}`,onClick:()=>R(t.id),disabled:!j,children:[(0,e.jsx)(ie,{className:"-ml-1 mr-2 h-4 w-4"}),"Deny"]})]})]})},t.id)})})]})]}),k&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:$,children:(0,e.jsxs)("div",{className:"relative max-w-4xl max-h-full",onClick:t=>t.stopPropagation(),children:[(0,e.jsx)("button",{className:"absolute -top-12 right-0 text-white hover:text-gray-300 focus:outline-none",onClick:$,children:(0,e.jsx)(ie,{className:"h-8 w-8"})}),(0,e.jsx)("img",{src:O,alt:"Proof of payment",className:"max-w-full max-h-screen rounded-lg"})]})})]})},ws=bs,Ns=()=>{const[i,g]=(0,s.useState)([]),[L,v]=(0,s.useState)([]),[f,h]=(0,s.useState)(!0),[N,b]=(0,s.useState)(null),[C,x]=(0,s.useState)(""),[u,O]=(0,s.useState)("All"),[w,k]=(0,s.useState)(null),[A,F]=(0,s.useState)(!1),[c,p]=(0,s.useState)({});(0,s.useEffect)(()=>{const a=Q(V(D,"users")),o=K(a,n=>{const U=n.docs.map(I=>({id:I.id,...I.data()}));v(U)},n=>{console.error("Error loading users:",n),b("Failed to load users: "+n.message)});return()=>o()},[]),(0,s.useEffect)(()=>{const a=Q(V(D,"deposits"),Z("timestamp","desc")),o=K(a,n=>{try{const U=n.docs.map(I=>({id:I.id,...I.data()})).map(I=>{const z=L.find(M=>M.uid===I.userId);return{...I,userName:z?z.fullName||"Unnamed User":"Unknown User"}});g(U),h(!1)}catch(U){console.error("Error merging deposit data:",U),b("Error processing deposit data: "+U.message),h(!1)}},n=>{console.error("Firestore error:",n),b("Failed to load deposits: "+n.message),h(!1)});return()=>o()},[L]);const y=a=>{switch(a){case"accepted":return"bg-green-100 text-green-800";case"denied":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},E=async(a,o)=>{try{const n=W(D,"deposits",a);await J(n,{status:o}),console.log(`Deposit ${a} status updated to ${o}`)}catch(n){console.error("Error updating deposit status:",n),b("Failed to update deposit status: "+n.message)}},R=a=>{if(!a)return"N/A";if(a.seconds){const o=new Date(a.seconds*1e3);return o.toLocaleDateString()+" "+o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}if(a.toDate){const o=a.toDate();return o.toLocaleDateString()+" "+o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return a.toString()},_=i.reduce((a,o)=>a+(parseFloat(o.amount)||0),0),$=i.filter(a=>a.status==="pending").length,q=i.filter(a=>a.status==="accepted").length,l=i.filter(a=>a.status==="denied").length,S=i.filter(a=>a.status==="accepted").reduce((a,o)=>a+(parseFloat(o.amount)||0),0),t=i.filter(a=>a.status==="denied").reduce((a,o)=>a+(parseFloat(o.amount)||0),0),d=i.filter(a=>{const o=a.userName?.toLowerCase().includes(C.toLowerCase())||a.userId?.toLowerCase().includes(C.toLowerCase())||a.message?.toLowerCase().includes(C.toLowerCase()),n=u==="All"||a.status===u;return o&&n}),j=a=>{k(a),F(!0)},m=()=>{F(!1),k(null)};return f?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading deposits..."})]})}):N?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",N]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(console.log("DepositsPage: Rendering with deposits array length:",i.length),(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Deposits"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",_.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-indigo-100",children:(0,e.jsx)(ne,{className:"h-6 w-6 text-indigo-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Pending Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:$})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-yellow-100",children:(0,e.jsx)(Pe,{className:"h-6 w-6 text-yellow-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Approved Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:q})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(he,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Denied Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:l})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(te,{className:"h-6 w-6 text-red-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Accepted Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",S.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(he,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Declined Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",t.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(te,{className:"h-6 w-6 text-red-600"})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Deposit Records"}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ae,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by name, user ID or message...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:C,onChange:a=>x(a.target.value)})]}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsxs)("select",{className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg bg-gray-50",value:u,onChange:a=>O(a.target.value),children:[(0,e.jsx)("option",{value:"All",children:"All Statuses"}),(0,e.jsx)("option",{value:"pending",children:"Pending"}),(0,e.jsx)("option",{value:"accepted",children:"Accepted"}),(0,e.jsx)("option",{value:"denied",children:"Denied"})]}),(0,e.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,e.jsx)(Ae,{className:"h-5 w-5 text-gray-400"})})]})]})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-scroll",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User Name"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proof"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:d.length>0?d.map(a=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:a.userName}),(0,e.jsxs)("div",{className:"text-xs text-gray-500 italic",children:["ID: ",a.userId]})]}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:["$",a.amount?parseFloat(a.amount).toFixed(2):"0.00"]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${y(a.status||"pending")}`,children:a.status||"pending"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:a.imageUrl?(0,e.jsxs)("button",{onClick:()=>j(a),className:"text-indigo-600 hover:text-indigo-900 flex items-center",children:[(0,e.jsx)(ye,{className:"h-4 w-4 mr-1"}),"View"]}):(0,e.jsx)("span",{className:"text-gray-400",children:"No proof"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:R(a.timestamp)}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,e.jsxs)("div",{className:"flex items-center space-x-3",children:[a.status==="pending"?(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("button",{disabled:!!c[a.id],onClick:async()=>{if(window.confirm("Mark this deposit as Accepted?")){p(o=>({...o,[a.id]:!0}));try{await E(a.id,"accepted"),console.log("Deposit accepted:",a.id)}finally{p(o=>{const n={...o};return delete n[a.id],n})}}},className:"px-3 py-1 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors duration-200 disabled:opacity-50",children:c[a.id]?"Processing...":"Approve"}),(0,e.jsx)("button",{disabled:!!c[a.id],onClick:async()=>{if(window.confirm("Mark this deposit as Denied?")){p(o=>({...o,[a.id]:!0}));try{await E(a.id,"denied"),console.log("Deposit denied:",a.id)}finally{p(o=>{const n={...o};return delete n[a.id],n})}}},className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors duration-200 disabled:opacity-50",children:c[a.id]?"Processing...":"Deny"})]}):(0,e.jsx)("span",{className:"text-sm text-gray-500",children:a.status||"No actions"}),a.imageUrl?(0,e.jsx)("button",{onClick:()=>window.open(a.imageUrl,"_blank"),className:"text-indigo-600 hover:text-indigo-900 flex items-center",title:"View proof in new tab",children:(0,e.jsx)(Ce,{className:"h-4 w-4"})}):null]})})]},a.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No deposits found."})})})]})})}),A&&w&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,e.jsxs)("div",{className:"bg-white  rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-scroll",children:[(0,e.jsxs)("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Deposit Proof"}),(0,e.jsx)("button",{onClick:m,className:"text-gray-400 hover:text-gray-500",children:(0,e.jsx)(te,{className:"h-6 w-6"})})]}),(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"User Name"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:w.userName||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"User ID"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:w.userId||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Amount"}),(0,e.jsxs)("p",{className:"text-sm text-gray-900",children:["$",w.amount?parseFloat(w.amount).toFixed(2):"0.00"]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Status"}),(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${y(w.status||"pending")}`,children:w.status||"pending"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Date"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:R(w.timestamp)})]}),(0,e.jsxs)("div",{className:"md:col-span-2",children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Message"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:w.message||"No message"})]})]}),(0,e.jsxs)("div",{className:"mt-6",children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Proof Image"}),(0,e.jsx)("div",{className:"border border-gray-200 rounded-lg ",children:w.imageUrl?(0,e.jsx)("img",{src:w.imageUrl,alt:"Deposit Proof",className:"w-full h-auto max-h-[60vh] object-contain",onError:a=>{a.target.style.display="none"}}):(0,e.jsx)("div",{className:"flex items-center justify-center h-64 bg-gray-100 text-gray-500",children:"No image available"})})]}),(0,e.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,e.jsx)("button",{onClick:m,className:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50",children:"Close"}),w.status==="pending"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("button",{onClick:()=>{E(w.id,"accepted"),m()},className:"px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-green-600 hover:bg-green-700",children:"Approve"}),(0,e.jsx)("button",{onClick:()=>{E(w.id,"denied"),m()},className:"px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-red-600 hover:bg-red-700",children:"Deny"})]})]})]})]})})]}))},vs=Ns;function Ss(){const{currentUser:i}=ee(),[g,L]=(0,s.useState)([]),[v,f]=(0,s.useState)(""),[h,N]=(0,s.useState)(!0),[b,C]=(0,s.useState)({}),[x,u]=(0,s.useState)({}),O=(0,s.useRef)(),w=(0,s.useRef)(),k=c=>{if(!c)return!1;const p=c.toDate?c.toDate():new Date(c);return(new Date-p)/(1e3*60)<2};(0,s.useEffect)(()=>{if(!i)return;(async()=>{try{const y=W(D,"users",i.uid);await J(y,{isOnline:!0,lastActive:se()})}catch(y){console.error("Error setting user online:",y)}})(),w.current=setInterval(async()=>{try{const y=W(D,"users",i.uid);await J(y,{lastActive:se()})}catch(y){console.error("Error updating lastActive:",y)}},3e4);const p=async()=>{try{const y=W(D,"users",i.uid);await J(y,{isOnline:!1,lastActive:se()})}catch(y){console.error("Error setting user offline:",y)}};return window.addEventListener("beforeunload",p),()=>{clearInterval(w.current),window.removeEventListener("beforeunload",p),i&&(async()=>{try{const E=W(D,"users",i.uid);await J(E,{isOnline:!1,lastActive:se()})}catch(E){console.error("Error setting user offline:",E)}})()}},[i]),(0,s.useEffect)(()=>{if(!i){N(!1);return}const c=Q(V(D,"messages"),Z("timestamp","asc"));return K(c,p=>{L(p.docs.map(y=>({id:y.id,...y.data()}))),N(!1)})},[i]),(0,s.useEffect)(()=>{if(i)return K(V(D,"users"),c=>{const p={},y={};c.forEach(E=>{const R=E.data();p[E.id]=R,k(R.lastActive)&&(y[E.id]={displayName:R.displayName||R.email?.split("@")[0]||"Unknown",isOnline:R.isOnline||!1,lastActive:R.lastActive})}),u(p),C(y)})},[i]);const A=async c=>{if(c.preventDefault(),!(!i||!v.trim()))try{await He(V(D,"messages"),{text:v,userId:i.uid,userName:i.email?i.email.split("@")[0]:"Anonymous",timestamp:se()}),f("")}catch(p){console.error("Error sending message:",p)}};(0,s.useEffect)(()=>{O.current?.scrollIntoView({behavior:"smooth"})},[g]);const F=c=>c?c.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";return i?(0,e.jsxs)("div",{className:"flex flex-col  h-screen bg-gradient-to-b from-gray-50 to-gray-100 font-sans text-gray-800 max-w-4xl mx-auto w-full",children:[(0,e.jsx)("div",{className:"mx-4 mb-2 bg-white/70 backdrop-blur-md rounded-xl shadow-sm p-3",children:(0,e.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,e.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,e.jsxs)("span",{className:"text-xs text-gray-600",children:[Object.keys(b).length," online"]}),(0,e.jsx)("br",{}),(0,e.jsxs)("p",{className:"text-sm text-gray-500",children:[g.length," Messages"]})]})}),(0,e.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 flex flex-col gap-4 max-w-full",children:[h?(0,e.jsx)("div",{className:"flex justify-center p-6",children:(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce"}),(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce",style:{animationDelay:"0.16s"}}),(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce",style:{animationDelay:"0.32s"}})]})}):g.length===0?(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center text-gray-500 p-10 bg-white rounded-2xl shadow-lg m-5",children:[(0,e.jsx)("div",{className:"text-4xl mb-3 opacity-70",children:"ðŸ’¬"}),(0,e.jsx)("div",{className:"text-sm text-center max-w-xs",children:"No messages yet. Start a conversation!"})]}):g.map(c=>(0,e.jsxs)("div",{className:`flex ${c.userId===i.uid?"justify-end":"justify-start"} animate-fade-in`,children:[c.userId!==i.uid&&(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center bg-white text-indigo-600 font-bold flex-shrink-0 shadow-sm mr-2",children:c.userName?c.userName.charAt(0).toUpperCase():"U"}),(0,e.jsx)("div",{className:`absolute bottom-[60px] right-7 w-3.5 h-3.5 rounded-full border-2 border-white ${b[c.userId]?"bg-green-500":"bg-gray-400"}`,title:b[c.userId]?"Online":"Offline"})]}),(0,e.jsxs)("div",{className:`max-w-[72%] p-3 rounded-2xl relative shadow-md transition-all duration-300 hover:shadow-lg ${c.userId===i.uid?"bg-gradient-to-br from-indigo-50 to-indigo-100 border border-indigo-100 rounded-br-md":"bg-white border border-gray-200 rounded-bl-md"}`,children:[(0,e.jsx)("div",{className:"text-sm text-gray-800 leading-relaxed",children:c.text}),(0,e.jsx)("div",{className:"text-xs text-gray-400 text-right mt-2",children:F(c.timestamp)})]}),c.userId===i.uid&&(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white font-bold flex-shrink-0 shadow-sm ml-2",children:c.userName?c.userName.charAt(0).toUpperCase():"U"}),(0,e.jsx)("div",{className:`absolute bottom-[60px] right-6 w-3.5 h-3.5 rounded-full border-2 border-white ${k(x[i?.uid]?.lastActive)?"bg-green-500":"bg-gray-400"}`,title:k(x[i?.uid]?.lastActive)?"Online":"Offline"})]})]},c.id)),(0,e.jsx)("div",{ref:O})]}),(0,e.jsxs)("form",{onSubmit:A,className:"flex items-center p-4 gap-3 sticky bottom-0 bg-white/70 backdrop-blur-md border-t border-gray-200",children:[(0,e.jsx)("div",{className:"flex-1 flex items-center bg-white p-2 pl-4 rounded-full shadow-md transition-all duration-300 focus-within:shadow-lg focus-within:border focus-within:border-indigo-500",children:(0,e.jsx)("input",{type:"text",className:"flex-1 border-0 outline-none p-2 bg-transparent text-sm text-gray-800",placeholder:"Type a message...",value:v,onChange:c=>f(c.target.value)})}),(0,e.jsx)("button",{type:"submit",className:"w-11 h-11 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white border-none cursor-pointer shadow-md transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",disabled:!v.trim(),children:(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4.5 h-4.5",children:(0,e.jsx)("path",{d:"M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"})})})]})]}):(0,e.jsx)("div",{className:"flex flex-col h-screen bg-gradient-to-b from-gray-50 to-gray-100 items-center justify-center font-sans text-gray-800",children:(0,e.jsxs)("div",{className:"text-center p-6 bg-white rounded-2xl shadow-lg max-w-md",children:[(0,e.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Please log in to use chat"}),(0,e.jsx)("p",{className:"text-gray-600",children:"You need to be logged in to send and receive messages."})]})})}var Ds=()=>(0,e.jsx)("div",{className:"",children:(0,e.jsx)("main",{children:(0,e.jsx)(Ss,{})})}),ks=Ds,As=()=>{const[i,g]=(0,s.useState)(!1),{currentUser:L}=ee(),v=$e(),f=pe(),{logout:h}=ee(),N=async()=>{try{await h(),f("/login")}catch(x){console.error("Failed to log out",x)}};(0,s.useEffect)(()=>{const x=()=>{window.innerWidth>=1024&&g(!1)};return window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[]),(0,s.useEffect)(()=>{const x=u=>{i&&!u.target.closest(".sidebar-content")&&!u.target.closest(".sidebar-toggle")&&g(!1)};return document.addEventListener("click",x),()=>document.removeEventListener("click",x)},[i]),(0,s.useEffect)(()=>{g(!1)},[v.pathname]);const b=[{name:"Dashboard",href:"/dashboard",icon:os},{name:"Deposits",href:"/deposits",icon:ns},{name:"loans",href:"/loans",icon:ts},{name:"Chat",href:"/chat",icon:ls},{name:"Users",href:"/users",icon:Ee},{name:"Payback",href:"/payback",icon:Xe},{name:"Settings",href:"/settings",icon:as}],C=x=>v.pathname===x;return(0,e.jsxs)("div",{className:"flex h-screen w-screen max-w-full bg-gray-50",children:[(0,e.jsx)("div",{className:`fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform ${i?"translate-x-0":"-translate-x-full"} transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0 sidebar-content`,children:(0,e.jsxs)("div",{className:"flex flex-col h-full",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between h-16 px-6 border-b border-gray-200",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)("div",{className:"w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-white font-bold",children:"MB"})})}),(0,e.jsx)("div",{className:"ml-3",children:(0,e.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"MoneyBox"})})]}),(0,e.jsx)("button",{onClick:()=>g(!1),className:"lg:hidden text-gray-500 hover:text-gray-700",children:(0,e.jsx)(ie,{size:20})})]}),(0,e.jsx)("nav",{className:"flex-1 px-4 py-6 overflow-y-auto",children:(0,e.jsx)("ul",{className:"space-y-1",children:b.map(x=>(0,e.jsx)("li",{children:(0,e.jsxs)(fe,{to:x.href,className:`flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-all duration-200 ${C(x.href)?"bg-indigo-50 text-indigo-700":"text-gray-700 hover:bg-gray-100"}`,children:[(0,e.jsx)(x.icon,{className:"mr-3 h-5 w-5"}),x.name]})},x.name))})}),(0,e.jsxs)("div",{className:"px-4 py-6 border-t border-gray-200",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:(0,e.jsx)("div",{className:"w-11 h-11 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white font-bold shadow-md",children:L?.email?.charAt(0).toUpperCase()||"U"})})}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Admin  is           ",L?.email?.slice(0,5).toUpperCase()||"U"]}),(0,e.jsx)("p",{className:"text-xs text-gray-500",children:L?.email?.slice(0,104).toLowerCase()||"U"})]})]}),(0,e.jsxs)("button",{onClick:N,className:"flex items-center w-full px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors duration-200",children:[(0,e.jsx)(we,{className:"mr-3 h-5 w-5"}),"Logout"]})]})]})}),(0,e.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,e.jsx)("header",{className:"bg-white shadow-sm z-10",children:(0,e.jsxs)("div",{className:"flex items-center justify-between h-16 px-6",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("button",{onClick:()=>g(!0),className:"lg:hidden text-gray-500 hover:text-gray-700 mr-4 sidebar-toggle",children:(0,e.jsx)(ss,{size:20})}),(0,e.jsxs)("h2",{className:"text-xl font-semibold text-gray-800",children:[v.pathname==="/dashboard"&&"ðŸ’° Dashboard",v.pathname==="/deposits"&&"ðŸ’° Deposits Overview",v.pathname==="/loans"&&"ðŸ’¸ loans Overview",v.pathname==="/users"&&"ðŸ‘¥ Users Overview",v.pathname==="/chat"&&"ðŸ‘¥ Users Overview"]})]}),(0,e.jsx)("div",{className:"flex items-center space-x-4",children:(0,e.jsxs)("button",{onClick:N,className:"flex items-center text-sm font-medium text-gray-700 hover:text-gray-900",children:[(0,e.jsx)(we,{className:"mr-2 h-5 w-5"}),"Logout"]})})]})}),(0,e.jsx)("main",{className:"flex-1 overflow-y-auto bg-gray-50 p-6",children:(0,e.jsx)("div",{className:"h-full w-full",children:(0,e.jsx)(Ie,{})})})]})]})},Cs=As,Es=()=>{const[i,g]=(0,s.useState)([]),[L,v]=(0,s.useState)([]),[f,h]=(0,s.useState)(!0),[N,b]=(0,s.useState)(null),[C,x]=(0,s.useState)(""),[u,O]=(0,s.useState)("All"),[w,k]=(0,s.useState)({});(0,s.useEffect)(()=>{const l=Q(V(D,"users")),S=K(l,t=>{const d=t.docs.map(j=>({id:j.id,...j.data()}));v(d)},t=>{console.error("Error loading users:",t),b("Failed to load users: "+t.message)});return()=>S()},[]),(0,s.useEffect)(()=>{const l=Q(V(D,"loans"),Z("timestamp","desc")),S=K(l,t=>{try{const d=t.docs.map(j=>({id:j.id,...j.data()})).map(j=>{const m=L.find(a=>a.uid===j.userId);return{...j,userName:m?m.fullName||"Unnamed User":"Unknown User"}});g(d),h(!1)}catch(d){console.error("Error merging loan data:",d),b("Error processing loan data: "+d.message),h(!1)}},t=>{console.error("Firestore error:",t),b("Failed to load loans: "+t.message),h(!1)});return()=>S()},[L]);const A=l=>{switch(l){case"accepted":return"bg-green-100 text-green-800";case"denied":return"bg-red-100 text-red-800";case"Pending":case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},F=async(l,S)=>{try{const t=W(D,"loans",l);await J(t,{status:S}),console.log(`Loan ${l} status updated to ${S}`)}catch(t){console.error("Error updating loan status:",t),b("Failed to update loan status: "+t.message)}},c=l=>{if(!l)return"N/A";if(l.seconds){const S=new Date(l.seconds*1e3);return S.toLocaleDateString()+" "+S.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}if(l.toDate){const S=l.toDate();return S.toLocaleDateString()+" "+S.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return l.toString()},p=i.reduce((l,S)=>l+(parseFloat(S.amount)||0),0),y=i.filter(l=>l.status==="pending").length,E=i.filter(l=>l.status==="accepted").length,R=i.filter(l=>l.status==="denied").length,_=i.filter(l=>l.status==="accepted").reduce((l,S)=>l+(parseFloat(S.amount)||0),0),$=i.filter(l=>l.status==="denied").reduce((l,S)=>l+(parseFloat(S.amount)||0),0),q=i.filter(l=>{const S=l.userName?.toLowerCase().includes(C.toLowerCase())||l.userId?.toLowerCase().includes(C.toLowerCase())||l.message?.toLowerCase().includes(C.toLowerCase()),t=u==="All"||l.status===u;return S&&t});return f?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading loans..."})]})}):N?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",N]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total loans"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",p.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-blue-100",children:(0,e.jsx)(ue,{className:"h-6 w-6 text-blue-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Pending loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:y})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-yellow-100",children:(0,e.jsx)(Pe,{className:"h-6 w-6 text-yellow-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Paid loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:E})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(Ze,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Declined loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:R})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(te,{className:"h-6 w-6 text-red-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Accepted Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",_.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(he,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Declined Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",$.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(te,{className:"h-6 w-6 text-red-600"})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Loans Records"}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ae,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by name, user ID or message...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:C,onChange:l=>x(l.target.value)})]}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsxs)("select",{className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg bg-gray-50",value:u,onChange:l=>O(l.target.value),children:[(0,e.jsx)("option",{value:"All",children:"All Statuses"}),(0,e.jsx)("option",{value:"Pending",children:"Pending"}),(0,e.jsx)("option",{value:"accepted",children:"Paid"}),(0,e.jsx)("option",{value:"denied",children:"Declined"})]}),(0,e.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,e.jsx)(Ae,{className:"h-5 w-5 text-gray-400"})})]})]})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User Name"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:q.length>0?q.map(l=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,e.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:l.userName}),(0,e.jsxs)("div",{className:"text-xs text-gray-500 italic",children:["ID: ",l.userId]})]}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:["$",l.amount?parseFloat(l.amount).toFixed(2):"0.00"]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${A(l.status)}`,children:l.status==="accepted"?"Paid":l.status||"Pending"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:c(l.timestamp)}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,e.jsxs)("div",{className:"flex items-center space-x-3",children:[l.status==="pending"?(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("button",{disabled:!!w[l.id],onClick:async()=>{if(window.confirm("Mark this loan as Paid?")){k(S=>({...S,[l.id]:!0}));try{await F(l.id,"accepted")}finally{k(S=>{const t={...S};return delete t[l.id],t})}}},className:"px-3 py-1 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors duration-200 disabled:opacity-50",children:w[l.id]?"Processing...":"Pay"}),(0,e.jsx)("button",{disabled:!!w[l.id],onClick:async()=>{if(window.confirm("Mark this loan as Declined?")){k(S=>({...S,[l.id]:!0}));try{await F(l.id,"denied")}finally{k(S=>{const t={...S};return delete t[l.id],t})}}},className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors duration-200 disabled:opacity-50",children:w[l.id]?"Processing...":"Decline"})]}):(0,e.jsx)("span",{className:"text-sm text-gray-500",children:l.status==="accepted"?"Paid":l.status}),l.imageUrl&&(0,e.jsx)("button",{onClick:()=>window.open(l.imageUrl,"_blank"),className:"text-indigo-600 hover:text-indigo-900 flex items-center",title:"View proof",children:(0,e.jsx)(rs,{className:"h-4 w-4"})})]})})]},l.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"5",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No loans found."})})})]})})})]})},Ps=Es,Ls=()=>{const[i,g]=(0,s.useState)([]),[L,v]=(0,s.useState)(!0),[f,h]=(0,s.useState)(null),[N,b]=(0,s.useState)(""),[C,x]=(0,s.useState)(!1),[u,O]=(0,s.useState)(null),[w,k]=(0,s.useState)([]),[A,F]=(0,s.useState)([]),[c,p]=(0,s.useState)(!1),[y,E]=(0,s.useState)(!1),[R,_]=(0,s.useState)(null),[$,q]=(0,s.useState)(null),[l,S]=(0,s.useState)({}),t=(0,s.useRef)(null),d=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!D){h("Firestore instance not available"),v(!1);return}const r=Q(V(D,"users"),Z("createdAt","desc")),T=K(r,P=>{try{const G=P.docs.map(B=>({id:B.id,...B.data()}));g(G),v(!1)}catch(G){console.error("Error processing users snapshot:",G),h("Failed to process users data"),v(!1)}},P=>{console.error("Error fetching users:",P),P.code==="permission-denied"?h("Permission denied. Check Firestore rules."):h("Failed to load users: "+(P.message||"Unknown error")),v(!1)});return()=>T()},[]),(0,s.useEffect)(()=>{if(t.current&&(t.current(),t.current=null),d.current&&(d.current(),d.current=null),!u){k([]),F([]);return}p(!0),_(null);const r=Q(V(D,"deposits"),Z("timestamp","desc"));t.current=K(r,P=>{try{const G=P.docs.map(B=>({id:B.id,...B.data()})).filter(B=>B.userId===u.uid);k(G),p(!1)}catch(G){console.error("Error processing deposits snapshot:",G),_("Failed to process deposits data"),p(!1)}},P=>{console.error("Error fetching deposits:",P),_("Failed to load deposits: "+(P.message||"Unknown error")),p(!1)}),E(!0),q(null);const T=Q(V(D,"loans"),Z("timestamp","desc"));return d.current=K(T,P=>{try{const G=P.docs.map(B=>({id:B.id,...B.data()})).filter(B=>B.userId===u.uid);F(G),E(!1)}catch(G){console.error("Error processing loans snapshot:",G),q("Failed to process loans data"),E(!1)}},P=>{console.error("Error fetching loans:",P),q("Failed to load loans: "+(P.message||"Unknown error")),E(!1)}),()=>{t.current&&(t.current(),t.current=null),d.current&&(d.current(),d.current=null)}},[u]);const j=r=>{if(!r)return"N/A";if(r.seconds)return new Date(r.seconds*1e3).toLocaleString();if(r.toDate)return r.toDate().toLocaleString();try{return new Date(r).toLocaleString()}catch{return String(r)}},m=r=>{switch(r?.toLowerCase()){case"accepted":return"bg-green-100 text-green-800";case"denied":case"rejected":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},a=r=>{O(r),x(!0)},o=()=>{x(!1)},n=r=>{window.open(r,"_blank")},U=(r,T)=>{const P=document.createElement("a");P.href=r,P.download=T||"proof-image.jpg",document.body.appendChild(P),P.click(),document.body.removeChild(P)},I=w.reduce((r,T)=>r+(T.amount||0),0),z=A.reduce((r,T)=>r+(T.amount||0),0);w.filter(r=>r.status==="pending").length,w.filter(r=>r.status==="accepted").length,w.filter(r=>r.status==="denied"||r.status==="rejected").length,A.filter(r=>r.status==="pending").length,A.filter(r=>r.status==="accepted").length,A.filter(r=>r.status==="denied"||r.status==="rejected").length;const M=i.filter(r=>{const T=N.trim().toLowerCase();return T?(r.fullName||"").toLowerCase().includes(T)||(r.email||"").toLowerCase().includes(T)||(r.phoneNumber||"").toLowerCase().includes(T)||(r.uid||"").toLowerCase().includes(T):!0});return L?(0,e.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading users..."})]})}):f?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",f]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6 md:col-span-1",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Users"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:i.length})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a4 4 0 00-4-4h-1M9 20H4v-2a4 4 0 014-4h1m0-4a4 4 0 100-8 4 4 0 000 8z"})})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6 md:col-span-3",children:(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"User Records"}),(0,e.jsx)("div",{className:"flex items-center w-full sm:w-64",children:(0,e.jsxs)("div",{className:"relative w-full",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ae,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search users...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:N,onChange:r=>b(r.target.value)})]})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gender"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Age"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:M.length>0?M.map(r=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150 cursor-pointer",onClick:()=>a(r),children:[(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[r.imageUrl?(0,e.jsx)("img",{src:r.imageUrl,alt:r.fullName||"avatar",className:"h-10 w-10 rounded-full object-cover",onError:T=>{T.target.style.display="none"}}):(0,e.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-medium text-gray-700",children:(r.fullName||"U").split(" ").map(T=>T[0]).slice(0,2).join("").toUpperCase()}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:r.fullName||"No name"}),(0,e.jsx)("div",{className:"text-xs text-gray-500",children:r.uid||""})]})]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.email||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.phoneNumber||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize",children:r.gender||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.age||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:j(r.createdAt)})]},r.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No users found."})})})]})})}),C&&u&&(0,e.jsx)("div",{className:"fixed inset-0 z-50 overflow-auto bg-black bg-opacity-50 flex items-center justify-center p-4",children:(0,e.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-auto",children:[(0,e.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center",children:[(0,e.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:["User Details: ",u.fullName]}),(0,e.jsx)("button",{onClick:o,className:"p-1 rounded-full hover:bg-gray-100 transition-colors",children:(0,e.jsx)(ie,{className:"h-5 w-5 text-gray-500"})})]}),(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[u.imageUrl?(0,e.jsx)("img",{src:u.imageUrl,alt:u.fullName||"avatar",className:"h-16 w-16 rounded-full object-cover mr-4"}):(0,e.jsx)("div",{className:"h-16 w-16 rounded-full bg-gray-200 flex items-center justify-center text-xl font-medium text-gray-700 mr-4",children:(u.fullName||"U").split(" ").map(r=>r[0]).slice(0,2).join("").toUpperCase()}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:u.fullName||"No name"}),(0,e.jsxs)("p",{className:"text-sm text-gray-500",children:["ID: ",u.uid||"N/A"]})]})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Email"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:u.email||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Phone Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:u.phoneNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"MoMo Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:u.momoNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Credit card Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:u.creditCardNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Gender"}),(0,e.jsx)("p",{className:"text-sm text-gray-900 capitalize",children:u.gender||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Age"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:u.age||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Joined Date"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:j(u.createdAt)})]})]})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"p-2 rounded-full bg-green-100 mr-3",children:(0,e.jsx)(ne,{className:"h-6 w-6 text-green-600"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Deposits Summary"})]}),(0,e.jsx)("div",{className:"space-y-3",children:(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Amount:"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",I.toFixed(2)]})]})})]}),(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"p-2 rounded-full bg-blue-100 mr-3",children:(0,e.jsx)(is,{className:"h-6 w-6 text-blue-600"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Loans Summary"})]}),(0,e.jsx)("div",{className:"space-y-3",children:(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Amount:"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",z.toFixed(2)]})]})})]})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Deposits"}),c?(0,e.jsx)("div",{className:"flex justify-center py-4",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):R?(0,e.jsx)("div",{className:"bg-red-50 p-4 rounded-md",children:(0,e.jsx)("p",{className:"text-sm text-red-800",children:R})}):w.length>0?(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Message"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proof"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(r=>(0,e.jsxs)("tr",{children:[(0,e.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",r.amount||"0"]}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${m(r.status)}`,children:r.status||"Unknown"})}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:j(r.timestamp)}),(0,e.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",title:r.message,children:r.message||"N/A"}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:r.proofImage?(0,e.jsxs)("div",{className:"flex space-x-2",children:[(0,e.jsx)("button",{onClick:()=>n(r.proofImage),className:"text-indigo-600 hover:text-indigo-900",title:"View",children:(0,e.jsx)(ye,{className:"h-5 w-5"})}),(0,e.jsx)("button",{onClick:()=>U(r.proofImage,`deposit-proof-${r.id}.jpg`),className:"text-indigo-600 hover:text-indigo-900",title:"Download",children:(0,e.jsx)(Ce,{className:"h-5 w-5"})})]}):"N/A"})]},r.id))})]})}):(0,e.jsx)("div",{className:"text-center py-4 text-sm text-gray-500",children:"No deposits found."})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Loans"}),y?(0,e.jsx)("div",{className:"flex justify-center py-4",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):$?(0,e.jsx)("div",{className:"bg-red-50 p-4 rounded-md",children:(0,e.jsx)("p",{className:"text-sm text-red-800",children:$})}):A.length>0?(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Approved By"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:A.map(r=>(0,e.jsxs)("tr",{children:[(0,e.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",r.amount||"0"]}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${m(r.status)}`,children:r.status||"Unknown"})}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:j(r.timestamp)}),(0,e.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",title:r.reason,children:r.reason||"N/A"}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:r.approvedBy||"N/A"})]},r.id))})]})}):(0,e.jsx)("div",{className:"text-center py-4 text-sm text-gray-500",children:"No loans found."})]})]})]})})]})},Us=Ls,Fs=()=>{const[i,g]=(0,s.useState)("10.00"),[L,v]=(0,s.useState)(!0),[f,h]=(0,s.useState)(!1),[N,b]=(0,s.useState)(null),[C,x]=(0,s.useState)("success"),[u,O]=(0,s.useState)([]),[w,k]=(0,s.useState)(!1),[A,F]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{try{const y=Q(V(D,"interest"),Z("timestamp","desc"),We(10)),E=await _e(y);if(E.empty)g("10.00");else{const R=E.docs[0];g(R.data().interest.toFixed(2)),F(R.id);const _=E.docs.map($=>({date:new Date($.data().timestamp?.toDate()||Date.now()).toLocaleDateString(),rate:parseFloat($.data().interest)})).reverse();O(_)}}catch(y){console.error("Error fetching interest:",y),b("Failed to load interest rate"),x("error"),setTimeout(()=>b(null),3e3)}finally{v(!1)}})()},[]);const c=async()=>{if(isNaN(i)||i<1||i>100){b("Please enter a valid interest rate between 1% and 100%"),x("error"),setTimeout(()=>b(null),3e3);return}h(!0);try{const p=new Date;if(A){const y=W(D,"interest",A);await J(y,{interest:Number(i),timestamp:p})}else await ke(W(D,"interest","globalRate"),{interest:Number(i),timestamp:p}),F("globalRate");b("Interest rate updated successfully!"),x("success"),O(y=>[...y.slice(-9),{date:p.toLocaleDateString(),rate:Number(i)}])}catch(p){console.error("Error updating interest:",p),b("Failed to update interest rate"),x("error")}finally{h(!1),setTimeout(()=>b(null),3e3)}};return L?(0,e.jsx)("div",{className:"flex justify-center items-center min-h-screen px-4",children:(0,e.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-10 w-full max-w-md text-center",children:[(0,e.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-300",children:"Loading interest rate..."})]})}):(0,e.jsxs)("div",{className:"flex justify-center items-center min-h-screen px-4 bg-gray-50 dark:bg-gray-900",children:[(0,e.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-6 md:p-10 w-full max-w-md",children:[(0,e.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100 mb-6 text-center",children:"Interest Rate Settings"}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{className:"block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2",children:"Current Interest Rate (%)"}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("input",{type:"number",step:"0.01",min:"1",max:"100",value:i,onChange:p=>g(p.target.value),className:"border border-gray-300 dark:border-gray-700 rounded-lg p-3 w-full focus:ring-2 focus:ring-blue-500 outline-none pr-12",disabled:f,placeholder:"Enter interest rate (1â€“100)"}),(0,e.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"%"})]}),(0,e.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Enter as a percentage (e.g., 5 for 5%)"})]}),(0,e.jsx)("button",{onClick:c,disabled:f,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 w-full disabled:opacity-50 flex items-center justify-center text-sm sm:text-base",children:f?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Saving..."]}):"Save Changes"}),(0,e.jsx)("div",{className:"mt-6 text-center",children:(0,e.jsxs)("button",{onClick:()=>k(!w),className:"text-blue-600 dark:text-blue-400 text-sm font-medium hover:underline",children:[w?"Hide":"Show"," Rate History"]})}),w&&u.length>0&&(0,e.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[(0,e.jsx)("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-4",children:"Interest Rate History"}),(0,e.jsx)("div",{className:"h-48",children:(0,e.jsx)(ce,{width:"100%",height:"100%",children:(0,e.jsxs)(Se,{data:u,children:[(0,e.jsx)(me,{strokeDasharray:"3 3",stroke:"#e0e0e0"}),(0,e.jsx)(de,{dataKey:"date",tick:{fontSize:12}}),(0,e.jsx)(xe,{tick:{fontSize:12},domain:["dataMin - 0.5","dataMax + 0.5"]}),(0,e.jsx)(oe,{formatter:p=>`${p.toFixed(2)}%`,contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.9)",border:"1px solid #ccc",borderRadius:"4px"}}),(0,e.jsx)(le,{type:"monotone",dataKey:"rate",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},activeDot:{r:6}})]})})})]})]}),N&&(0,e.jsx)("div",{className:`fixed top-5 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg text-white font-semibold shadow-md transition-all duration-300 ${C==="success"?"bg-green-500":"bg-red-500"}`,children:N})]})},Ts=Fs,Rs=({onAccessGranted:i})=>{const[g,L]=(0,s.useState)(""),[v,f]=(0,s.useState)(!1),[h,N]=(0,s.useState)(""),[b,C]=(0,s.useState)(""),[x,u]=(0,s.useState)(!1),[O,w]=(0,s.useState)(""),[k,A]=(0,s.useState)(""),[F,c]=(0,s.useState)(""),[p,y]=(0,s.useState)(!1),[E,R]=(0,s.useState)(!1),[_,$]=(0,s.useState)(!1),q="omaryagoub77@gmail.com";(0,s.useEffect)(()=>{if(k){R(!0);const m=setTimeout(()=>{R(!1),setTimeout(()=>A(""),500)},3e3);return()=>clearTimeout(m)}},[k]),(0,s.useEffect)(()=>{if(F){$(!0);const m=setTimeout(()=>{$(!1),setTimeout(()=>{c(""),x&&u(!1)},500)},3e3);return()=>clearTimeout(m)}},[F,x]);const l=async m=>{m.preventDefault(),y(!0);try{const a=W(D,"adminSettings","security"),o=await be(a);if(o.exists()){const{password:n}=o.data();g===n?i():A("Incorrect password. Please try again.")}else A("Admin settings not found. Please contact support.")}catch(a){console.error("Error fetching admin password:",a),A("Failed to verify password. Please try again.")}finally{y(!1)}},S=async m=>{m.preventDefault(),y(!0);try{const a=xs(),o=new Date;o.setMinutes(o.getMinutes()+15),await ke(W(D,"passwordResets",a),{token:a,expiresAt:o,used:!1});const n=`${window.location.origin}/admin-login?reset=true&token=${a}`;await ms.send("service_rbtk5y8","template_i85brpa",{to_email:q,reset_link:n},"zcAI9wNXtOd3ooJ67"),c("Password reset email sent! Check your inbox."),setTimeout(()=>{f(!1)},3e3)}catch(a){console.error("Error sending password reset email:",a),A("Failed to send reset email. Please try again.")}finally{y(!1)}},t=async m=>{if(m.preventDefault(),h!==b){A("Passwords do not match.");return}if(h.length<6){A("Password must be at least 6 characters long.");return}y(!0);try{const a=W(D,"adminSettings","security");await J(a,{password:h});const o=W(D,"passwordResets",O);await J(o,{used:!0}),c("Password updated successfully!"),N(""),C(""),setTimeout(()=>{window.location.href="/admin-login"},3e3)}catch(a){console.error("Error updating password:",a),A("Failed to update password. Please try again.")}finally{y(!1)}};return(0,s.useEffect)(()=>{const m=new URLSearchParams(window.location.search),a=m.get("reset"),o=m.get("token");a==="true"&&o&&(async()=>{try{const U=W(D,"passwordResets",o),I=await be(U);if(!I.exists()){A("Invalid or expired reset link.");return}const z=I.data();if(z.used||new Date>z.expiresAt.toDate()){A("This reset link has expired.");return}u(!0),w(o)}catch(U){console.error("Error verifying reset token:",U),A("Failed to verify reset link.")}})()},[]),x?(0,e.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96 max-w-md",children:[(0,e.jsx)("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-800",children:"Reset Admin Password"}),(0,e.jsxs)("form",{onSubmit:t,children:[(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),(0,e.jsx)("input",{type:"password",id:"newPassword",value:h,onChange:m=>N(m.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full transition-colors",required:!0})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),(0,e.jsx)("input",{type:"password",id:"confirmPassword",value:b,onChange:m=>C(m.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full transition-colors",required:!0})]}),(0,e.jsx)("button",{type:"submit",disabled:p,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Updating...":"Reset Password"})]}),(0,e.jsx)("div",{className:"mt-4 text-center",children:(0,e.jsx)("button",{onClick:()=>u(!1),className:"text-blue-600 text-sm hover:underline",children:"Back to login"})}),k&&(0,e.jsx)("div",{className:`text-red-500 mt-4 transition-opacity duration-500 ${E?"opacity-100":"opacity-0"}`,children:k}),F&&(0,e.jsx)("div",{className:`text-green-500 mt-4 transition-opacity duration-500 ${_?"opacity-100":"opacity-0"}`,children:F})]})}):(0,e.jsxs)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:[(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96 max-w-md",children:[(0,e.jsx)("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-800",children:"Admin Access"}),(0,e.jsxs)("form",{onSubmit:l,children:[(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",value:g,onChange:m=>L(m.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full transition-colors",required:!0})]}),(0,e.jsx)("button",{type:"submit",disabled:p,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-full mt-4 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Verifying...":"Access Admin Dashboard"})]}),k&&(0,e.jsx)("div",{className:`text-red-500 mt-2 transition-opacity duration-500 ${E?"opacity-100":"opacity-0"}`,children:k}),F&&(0,e.jsx)("div",{className:`text-green-500 mt-2 transition-opacity duration-500 ${_?"opacity-100":"opacity-0"}`,children:F}),(0,e.jsx)("div",{className:"text-blue-600 text-sm mt-3 hover:underline cursor-pointer text-center",onClick:()=>f(!0),children:"Forgot password?"})]}),v&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96 max-w-md",children:[(0,e.jsx)("h2",{className:"text-xl font-bold text-center mb-4 text-gray-800",children:"Reset Password"}),(0,e.jsx)("p",{className:"text-gray-600 text-sm mb-6",children:"A reset link will be sent to the admin email."}),(0,e.jsx)("div",{className:"mb-6 p-3 bg-gray-100 rounded-md",children:(0,e.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,e.jsx)("span",{className:"font-medium",children:"Email:"})," ",q]})}),(0,e.jsx)("form",{onSubmit:S,children:(0,e.jsxs)("div",{className:"flex space-x-3",children:[(0,e.jsx)("button",{type:"button",onClick:()=>f(!1),className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md w-1/2 transition-colors",children:"Cancel"}),(0,e.jsx)("button",{type:"submit",disabled:p,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-1/2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Sending...":"Send Reset Link"})]})}),k&&(0,e.jsx)("div",{className:`text-red-500 mt-4 transition-opacity duration-500 ${E?"opacity-100":"opacity-0"}`,children:k}),F&&(0,e.jsx)("div",{className:`text-green-500 mt-4 transition-opacity duration-500 ${_?"opacity-100":"opacity-0"}`,children:F})]})})]})},Is=Rs;function Ms({children:i}){const{currentUser:g}=ee();return g?i:(0,e.jsx)(De,{to:"/login"})}function ve({children:i}){const{currentUser:g}=ee();return g?(0,e.jsx)(De,{to:"/dashboard"}):i}function $s(){const[i,g]=(0,s.useState)(!1);return i?(0,e.jsxs)(Me,{children:[(0,e.jsx)(Y,{path:"/login",element:(0,e.jsx)(ve,{children:(0,e.jsx)(gs,{})})}),(0,e.jsx)(Y,{path:"/signup",element:(0,e.jsx)(ve,{children:(0,e.jsx)(ps,{})})}),(0,e.jsxs)(Y,{path:"/",element:(0,e.jsx)(Ms,{children:(0,e.jsx)(Cs,{})}),children:[(0,e.jsx)(Y,{index:!0,element:(0,e.jsx)(Ne,{})}),(0,e.jsx)(Y,{path:"profile",element:(0,e.jsx)(ys,{})}),(0,e.jsx)(Y,{path:"dashboard",element:(0,e.jsx)(Ne,{})}),(0,e.jsx)(Y,{path:"deposits",element:(0,e.jsx)(vs,{})}),(0,e.jsx)(Y,{path:"loans",element:(0,e.jsx)(Ps,{})}),(0,e.jsx)(Y,{path:"payback",element:(0,e.jsx)(ws,{})}),(0,e.jsx)(Y,{path:"users",element:(0,e.jsx)(Us,{})}),(0,e.jsx)(Y,{path:"settings",element:(0,e.jsx)(Ts,{})}),(0,e.jsx)(Y,{path:"chat",element:(0,e.jsx)(ks,{})})]})]}):(0,e.jsx)(Is,{onAccessGranted:()=>g(!0)})}var zs=$s;(0,us.createRoot)(document.getElementById("root")).render((0,e.jsx)(s.StrictMode,{children:(0,e.jsx)(hs,{children:(0,e.jsx)(ze,{children:(0,e.jsx)(zs,{})})})}));
